[{"id":"00e30bbeb7ce30522f4b80e6bd22ac09","title":"MySQL æ•°æ®åº“å¼€å‘çš„ä¸‰åå…­æ¡å†›è§„","content":"MySQL æ•°æ®åº“å¼€å‘çš„ä¸‰åå…­æ¡å†›è§„ä¸€ã€æ ¸å¿ƒå†›è§„(5)1.1 å°½é‡ä¸åœ¨æ•°æ®åº“åšè¿ç®—\nåˆ«è®©è„šè¶¾å¤´æƒ³äº‹æƒ…ï¼Œé‚£æ˜¯è„‘ç“œå­çš„èŒè´£\n\nè®©æ•°æ®åº“å¤šåšå¥¹æ“…é•¿çš„äº‹:\n\nå°½é‡ä¸åœ¨æ•°æ®åº“åšè¿ç®—\nå¤æ‚è¿ç®—ç§±åˆ°ç¨‹åºç«¯ CPU\nå°½å¯èƒ½ç®€å•åº”ç”¨ MySQL\n\n\nä¸¾ä¾‹: md5() &#x2F; Order by Rand()\n\n\n1.2 æ§åˆ¶å•è¡¨æ•°æ®é‡\nä¸€å¹´å†…çš„å•è¡¨æ•°æ®é‡é¢„ä¼°\n\nçº¯ INT ä¸è¶… 1000W\nå« CHAR ä¸è¶… 500W\n\n\nåˆç†åˆ†è¡¨ä¸è¶…è½½\n\nUSERID\nDATE\nAREA\nâ€¦â€¦\n\n\nå»ºè®®å•åº“ä¸è¶…è¿‡ 300-400 ä¸ªè¡¨\n\n\n1.3 ä¿æŒè¡¨èº«æ®µè‹—æ¡\nè¡¨å­—æ®µæ•°å°‘è€Œç²¾\n\nIO é«˜æ•ˆ\nå…¨è¡¨éå†\nè¡¨ä¿®å¤å¿«\næé«˜å¹µå‘\nalter table å¿«\n\n\nå•è¡¨å¤šå°‘å­—æ®µåˆé€‚?\n\nå•è¡¨ 1G ä½“ç§¯ 500W è¡Œè¯„ä¼°\n\né¡ºåºè¯» 1G æ–‡ä»¶éœ€ N ç§’\nå•è¡Œä¸è¶…è¿‡ 200Byte\nå•è¡¨ä¸è¶…è¿‡ 50 ä¸ªçº¯ INT å­—æ®µ\nå•è¡¨ä¸è¶…è¿‡ 20 ä¸ª CHAR(10)å­—æ®µ\n\n\nå•è¡¨å­—æ®µæ•°ä¸Šé™æ§åˆ¶åœ¨ 20~50 ä¸ª\n\n\n1.4 å¹³è¡¡èŒƒå¼ä¸å†—ä½™\nä¸¥æ ¼éµå¾ªä¸‰å¤§èŒƒå¼?\næ•ˆç‡ä¼˜å…ˆã€æå‡æ€§èƒ½\næ²¡æœ‰ç»å¯¹çš„å¯¹ä¸é”™\né€‚å½“æ—¶ç‰ºç‰²èŒƒå¼ã€åŠ å…¥å†—ä½™\nä½†ä¼šå¢åŠ ä»£ç å¤æ‚åº¦\n\n1.5 æ‹’ç» 3B\næ•°æ®åº“å¹µå‘åƒåŸå¸‚äº¤é€š\n\néçº¿æ€§å¢é•¿\n\n\næ‹’ç» 3B\n\nå¤§ SQL (BIG SQL)\nå¤§äº‹åŠ¡ (BIG Transaction)\nå¤§æ‰¹é‡ (BIG Batch)\n\n\nè¯¦ç»†è§£æè§å\n\n\n1.6 æ ¸å¿ƒå†›è§„å°ç»“\nå°½é‡ä¸åœ¨æ•°æ®åº“åšè¿ç®—\næ§åˆ¶å•è¡¨æ•°æ®é‡\nä¿æŒè¡¨èº«æ®µè‹—æ¡\nå¹³è¡¡èŒƒå¼ä¸å†—ä½™\næ‹’ç» 3B\n\näºŒã€å­—æ®µç±»å†›è§„(6)2.1 ç”¨å¥½æ•°å€¼å­—æ®µç±»å‹\nä¸‰ç±»æ•°å€¼ç±»å‹:\n\nTINYINT(1Byte)\nSMALLINT(2B)\nMEDIUMINT(3B)\nINT(4B)ã€BIGINT(8B)\nFLOAT(4B)ã€DOUBLE(8B)\nDECIMAL(M,D)\n\n\nBAD CASE:\n\nINT(1) VS INT(11)\nBIGINT AUTO_INCREMENT\nDECIMAL(18,0)\n\n\n\n2.2 å°†å­—ç¬¦è½¬åŒ–ä¸ºæ•°å­—\næ•°å­—å‹ VS å­—ç¬¦ä¸²å‹ç´¢å¼•\n\næ›´é«˜æ•ˆ\næŸ¥è¯¢æ›´å¿«\nå ç”¨ç©ºé—´æ›´å°\n\n\nä¸¾ä¾‹:ç”¨æ— ç¬¦å· INT å­˜å‚¨ IPï¼Œè€Œé CHAR(15)\n\nINT UNSIGNED\nINET_ATON()\nINET_NTOA()\n\n\n\n2.3 ä¼˜å…ˆä½¿ç”¨ ENUM æˆ– SET\nä¼˜å…ˆä½¿ç”¨ ENUM æˆ– SET\n\nå­—ç¬¦ä¸²\nå¯èƒ½å€¼å·²çŸ¥ä¸”æœ‰é™\n\n\nå­˜å‚¨\n\nENUM å ç”¨ 1 å­—èŠ‚ï¼Œè½¬ä¸ºæ•°å€¼è¿ç®—\nSET è§†èŠ‚ç‚¹å®šï¼Œæœ€å¤šå ç”¨ 8 å­—èŠ‚\næ¯”è¾ƒæ—¶éœ€è¦åŠ â€™ å•å¼•å·(å³ä½¿æ˜¯æ•°å€¼)\n\n\nä¸¾ä¾‹\n\nsex enum(â€˜Fâ€™,â€™Mâ€™) COMMENT â€˜æ€§åˆ«â€™\nc1 enum(â€˜0â€™,â€™1â€™,â€™2â€™,â€™3â€™) COMMENT â€˜èŒä»‹å®¡æ ¸â€™\n\n\n\n2.4 é¿å…ä½¿ç”¨ NULL å­—æ®µ\né¿å…ä½¿ç”¨ NULL å­—æ®µ\n\nå¾ˆéš¾è¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ–\nNULL åˆ—åŠ ç´¢å¼•ï¼Œéœ€è¦é¢å¤–ç©ºé—´\nå« NULL å¤åˆç´¢å¼•æ— æ•ˆ\n\n\nä¸¾ä¾‹\n\na char(32) DEFAULT NULL\nb int(10) NOT NULL\nc int(10) NOT NULL DEFAULT 0\n\n\n\n2.5 å°‘ç”¨å¹¶æ‹†åˆ† TEXT&#x2F;BLOB\nTEXT ç±»å‹å¤„ç†æ€§èƒ½è¿œä½äº VARCHAR\n\nå¼ºåˆ¶ç”Ÿæˆç¡¬ç›˜ä¸´æ—¶è¡¨\næµªè´¹æ›´å¤šç©ºé—´\nVARCHAR(65535)&#x3D;&#x3D;&gt;64K (æ³¨æ„ UTF-8)\n\n\nå°½é‡ä¸ç”¨ TEXT&#x2F;BLOB æ•°æ®ç±»å‹\n\nè‹¥å¿…é¡»ä½¿ç”¨åˆ™æ‹†åˆ†åˆ°å•ç‹¬çš„è¡¨\n\nä¸¾ä¾‹:\n\n\nCREATE TABLE t1 (\nid INT NOT NULL AUTO_INCREMENT, data text NOT NULL,\nâ€PRIMARY KEY id\n) ENGINE=InnoDB;\n\n2.6 ä¸åœ¨æ•°æ®åº“é‡Œå­˜å›¾ç‰‡2.7 å­—æ®µç±»å†›è§„å°ç»“\nç”¨å¥½æ•°å€¼å­—æ®µç±»å‹\nå°†å­—ç¬¦è½¬åŒ–ä¸ºæ•°å­—\nä¼˜å…ˆä½¿ç”¨æšä¸¾ ENUM&#x2F;SET\né¿å…ä½¿ç”¨ NULL å­—æ®µ\nå°‘ç”¨å¹µæ‹†åˆ† TEXT&#x2F;BLOB\nä¸åœ¨æ•°æ®åº“é‡Œå­˜å›¾ç‰‡\n\nä¸‰ã€ç´¢å¼•ç±»å†›è§„(5)3.1 è°¨æ…åˆç†æ·»åŠ ç´¢å¼•\nè°¨æ…åˆç†æ·»åŠ ç´¢å¼•\n\næ”¹å–„æŸ¥è¯¢\nå‡æ…¢æ›´æ–°\nç´¢å¼•ä¸æ˜¯èµ¹å¤šèµ¹å¥½\n\n\nèƒ½ä¸åŠ çš„ç´¢å¼•å°½é‡ä¸åŠ \n\nç»¼åˆè¯„ä¼°æ•°æ®å¯†åº¦å’Œæ•°æ®åˆ†å¸ƒ\næœ€å¥½ä¸èµ¸è¿‡å­—æ®µæ•° 20%\n\n\nç»“åˆæ ¸å¿ƒ SQL ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼•\n\nä¸¾ä¾‹\n\nä¸è¦ç»™â€œæ€§åˆ«â€åˆ—åˆ›å»ºç´¢å¼•\n\n\n\n3.2 å­—ç¬¦å­—æ®µå¿…é¡»å»ºå‰ç¼€ç´¢å¼•\nåŒºåˆ†åº¦\n\nå•å­—æ¯åŒºåˆ†åº¦:26\n4 å­—æ¯åŒºåˆ†åº¦:26_26_26*26&#x3D;456,976\n5 å­—æ¯åŒºåˆ†åº¦:26_26_26_26_26&#x3D;11,881,376\n6 å­—æ¯åŒºåˆ†åº¦:26_26_26_26_26*26&#x3D;308,915,776\n\n\nå­—ç¬¦å­—æ®µå¿…é¡»å»ºå‰ç¼€ç´¢å¼•:\n\n\n(\n`pinyin` varchar(100) DEFAULT NULL COMMENT 'å°åŒºæ‹¼éŸ³', KEY `idx_pinyin` (`pinyin`(8)),\n) ENGINE=InnoDB\n\n3.3 ä¸åœ¨ç´¢å¼•åˆ—åšè¿ç®—\nä¸åœ¨ç´¢å¼•åˆ—è¿›è¡Œæ•°å­¦è¿ç®—æˆ–å‡¼æ•°è¿ç®—\n\næ— æ³•ä½¿ç”¨ç´¢å¼•\nå¯¼è‡´å…¨è¡¨æ‰«æ\n\n\nä¸¾ä¾‹:\n\n\nBAD: SELECT * from table WHERE to_days(current_date) â€“ to_days(date_col) &lt;= 10\nGOOD: SELECT * from table WHERE date_col >= DATE_SUB('2011-10- 22',INTERVAL 10 DAY);\n\n3.4 è‡ªå¢åˆ—æˆ–å…¨å±€ ID åš INNODB ä¸»é”®\nå¯¹ä¸»é”®å»ºç«‹èšç°‡ç´¢å¼•\näºŒçº§ç´¢å¼•å­˜å‚¨ä¸»é”®å€¼\nä¸»é”®ä¸åº”æ›´æ–°ä¿®æ”¹\næŒ‰è‡ªå¢é¡ºåºæ‘å…¥å€¼\nå¿Œç”¨å­—ç¬¦ä¸²åšä¸»é”®\nèšç°‡ç´¢å¼•åˆ†è£‚\næ¨èç”¨ç‹¬ç«‹äºä¸šåŠ¡çš„ AUTO_INCREMENT åˆ—æˆ–å…¨å±€ ID ç”Ÿæˆ å™¨åšä»£ç†ä¸»é”®\nè‹¥ä¸æŒ‡å®šä¸»é”®ï¼ŒInnoDB ä¼šç”¨å”¯ä¸€ä¸”éç©ºå€¼ç´¢å¼•ä»£æ›¿\n\n3.5 å°½é‡ä¸ç”¨å¤–é”®\nçº¿ä¸Š OLTP ç³»ç»Ÿ(çº¿ä¸‹ç³»ç»Ÿå¦è®º)\n\nå¤–é”®å¯èŠ‚çœå¼€å‘é‡\næœ‰é¢å¤–å¼€é”€\né€è¡Œæ“ä½œ\nå¯â€™åˆ°è¾¾â€™å…¶å®ƒè¡¨ï¼Œæ„å‘³ç€é”\né«˜å¹¶å‘æ—¶å®¹æ˜“æ­»é”\n\n\nç”±ç¨‹åºä¿è¯çº¦æŸ\n\n\n3.6 ç´¢å¼•ç±»å†›è§„å°ç»“\nè°¨æ…åˆç†æ·»åŠ ç´¢å¼•\nå­—ç¬¦å­—æ®µå¿…é¡»å»ºå‰ç¼€ç´¢å¼•\nä¸åœ¨ç´¢å¼•åˆ—åšè¿ç®—\nè‡ªå¢åˆ—æˆ–å…¨å±€ ID åš INNODB ä¸»é”®\nå°½é‡ä¸ç”¨å¤–é”®\n\nå››ã€SQL ç±»å†›è§„(15)4.1 SQL è¯­å¥å°½å¯èƒ½ç®€å•\nå¤§ SQL VS å¤šä¸ªç®€å• SQL\n\nä¼ ç»Ÿè®¾è®¡æ€æƒ³\nBUT MySQL NOT\nä¸€æ¡ SQL å§èƒ½åœ¨ä¸€ä¸ª CPU è¿ç®—\n5000+ QPS çš„é«˜å¹µå‘ä¸­ï¼Œ1 ç§’å¤§ SQL æ„å‘³ç€?\nå¯èƒ½ä¸€æ¡å¤§ SQL å°±æŠŠæ•´ä¸ªæ•°æ®åº“å µæ­»\n\n\næ‹’ç»å¤§ SQLï¼Œæ‹†è§£æˆå¤šæ¡ç®€å• SQL\n\nç®€å• SQL ç¼“å­˜å‘½ä¸­ç‡æ›´é«˜\nå‡å°‘é”è¡¨æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯ MyISAM\nç”¨ä¸Šå¤š CPU\n\n\n\n4.2 ä¿æŒäº‹åŠ¡(è¿æ¥)çŸ­å°\nä¿æŒäº‹åŠ¡&#x2F;DB è¿æ¥çŸ­å°ç²¾æ‚\n\näº‹åŠ¡&#x2F;è¿æ¥ä½¿ç”¨åŸåˆ™:å³å¼€å³ç”¨ï¼Œç”¨å®Œå³å…³\nä¸äº‹åŠ¡æ— å…³æ“ä½œæ”¾åˆ°äº‹åŠ¡å¤–é¢, å‡å°‘é”èµ„æºçš„å ç”¨\nä¸ç ´åä¸€è‡´æ€§å‰æä¸‹ï¼Œä½¿ç”¨å¤šä¸ªçŸ­äº‹åŠ¡ä»£æ›¿é•¿äº‹åŠ¡\n\n\nä¸¾ä¾‹\n\nå‘è´´æ—¶çš„å›¾ç‰‡ä¸Šä¼ ç­‰å¾…\nå¤§é‡çš„ sleep è¿æ¥\n\n\n\n4.3 å°½å¯èƒ½é¿å…ä½¿ç”¨ SP&#x2F;TRIG&#x2F;FUNC\nçº¿ä¸Š OLTP ç³»ç»Ÿ(çº¿ä¸‹åº“å¦è®º)\n\nå°½å¯èƒ½å°‘ç”¨å­˜å‚¨è¿‡ç¨‹\nå°½å¯èƒ½å°‘ç”¨è§¦å‘å™¨\nå‡ç”¨ä½¿ç”¨ MySQL å‡¼æ•°å¯¹ç»“æœè¿›è¡Œå¤„ç†\n\n\nç”±å®¢æˆ·ç«¯ç¨‹åºè´Ÿè´£\n\n\n4.4 å°½é‡ä¸ç”¨ SELECT\nç”¨ SELECT * æ—¶\næ›´å¤šæ¶ˆè€— CPUã€å†…å­˜ã€IOã€ç½‘ç»œå¸¦å®½\nå…ˆå‘æ•°æ®åº“è¯·æ±‚æ‰€æœ‰åˆ—ï¼Œç„¶åä¸¢æ‰ä¸éœ€è¦åˆ—?\nå°½é‡ä¸ç”¨ SELECT * ï¼Œå§å–éœ€è¦æ•°æ®åˆ— â€¢ æ›´å®‰å…¨çš„è®¾è®¡:å‡å°‘è¡¨å˜åŒ–å¸¦æ¥çš„å½±å“\nä¸ºä½¿ç”¨ covering index æä¾›å¯èƒ½æ€§\nSELECT&#x2F;JOIN å‡å°‘ç¡¬ç›˜ä¸´æ—¶è¡¨ç”Ÿæˆï¼Œç‰¹åˆ«æ˜¯æœ‰ TEXT&#x2F;BLOB æ—¶\nä¸¾ä¾‹:\n\nSELECT * FROM tag WHERE id = 999184;\nSELECT keyword FROM tag WHERE id = 999184;\n\n4.5 æ”¹å†™ OR ä¸º IN()\nåŒä¸€å­—æ®µï¼Œå°† or æ”¹å†™ä¸º in()\nOR æ•ˆç‡:O(n)\nIN æ•ˆç‡:O(Log n)\nå½“ n å¾ˆå¤§æ—¶ï¼ŒOR ä¼šæ…¢å¾ˆå¤š\næ³¨æ„æ§åˆ¶ IN çš„ä¸ªæ•°ï¼Œå»ºè®® n å°äº 200\nä¸¾ä¾‹:\n\nSELECT * from opp WHERE phone='12347856' or phone='42242233' \\G;\nSELECT * from opp WHERE phone in ('12347856' , '42242233');\n\n4.6 æ”¹å†™ OR ä¸º UNION\nä¸åŒå­—æ®µï¼Œå°† or æ”¹ä¸º union\nå‡å°‘å¯¹ä¸åŒå­—æ®µè¿›è¡Œ â€œorâ€ æŸ¥è¯¢\nMerge index å¾€å¾€å¾ˆå¼±æ™º\nå¦‚æœæœ‰è¶³å¤Ÿä¿¡å¿ƒ:set global optimizer_switch&#x3D;â€™index_merge&#x3D;offâ€™;\nä¸¾ä¾‹:\n\nSELECT * from opp WHERE phone='010-88886666' or cellPhone='13800138000';\nSELECT * from opp WHERE phone='010-88886666' union SELECT * from opp WHERE cellPhone='13800138000';\n\n4.7 é¿å…è´Ÿå‘æŸ¥è¯¢å’Œ% å‰ç¼€æ¨¡ç³ŠæŸ¥è¯¢\né¿å…è´Ÿå‘æŸ¥è¯¢\n\nNOTã€!&#x3D;ã€&lt;&gt;ã€!&lt;ã€!&gt;ã€NOT EXISTSã€NOT INã€ NOT LIKE ç­‰\n\n\né¿å… % å‰ç¼€æ¨¡ç³ŠæŸ¥è¯¢\n\nB+ Tree\nä½¿ç”¨ä¸äº†ç´¢å¼•\nå¯¼è‡´å…¨è¡¨æ‰«æ\n\n\nä¸¾ä¾‹:\n\n\nSELECT * from post WHERE title like 'åŒ—äº¬%'; -- 298 rows in set (0.01 sec)\nSELECT * from post WHERE title like '%åŒ—äº¬%'; -- 572 rows in set (3.27 sec)\n\n4.8 COUNT(*)çš„å‡ ä¸ªä¾‹å­\nå‡ ä¸ªæœ‰è¶£çš„ä¾‹å­:\n\nCOUNT(COL) VS COUNT(*)\nCOUNT(*) VS COUNT(1)\nCOUNT(1) VS COUNT(0) VS COUNT(100)\n\n\nç¤ºä¾‹:\n\n\n`id` int(10) NOT NULL AUTO_INCREMENT COMMENT 'å…¬å¸çš„id', `sale_id` int(10) unsigned DEFAULT NULL,\n\n\nç»“è®º\n\nCOUNT(*)&#x3D;count(1)\n\n\n\n*COUNT(0)&#x3D;count(1)\n\nCOUNT(1)&#x3D;count(100)\nCOUNT(*)!&#x3D;count(col)\nWHY?\n\n4.9 å‡å°‘ COUNT(*)\nMyISAM VS INNODB\n\nä¸å¸¦ WHERE COUNT()\nå¸¦ WHERE COUNT()\n\n\nCOUNT(*)çš„èµ„æºå¼€é”€å¤§ï¼Œå°½é‡ä¸ç”¨å°‘ç”¨\n\nè®¡æ•°ç»Ÿè®¡\n\nå®æ—¶ç»Ÿè®¡:ç”¨ memcacheï¼ŒåŒå‘æ›´æ–°ï¼Œå‡Œæ™¨ è·‘åŸºå‡†\néå®æ—¶ç»Ÿè®¡:å°½é‡ç”¨å•ç‹¬ç»Ÿè®¡è¡¨ï¼Œå®šæœŸé‡ç®—\n\n\n\n4.10 LIMIT é«˜æ•ˆåˆ†é¡µ\nä¼ ç»Ÿåˆ†é¡µ:\n\nSELECT * from table limit 10000,10;\n\n\nLIMIT åŸç†:\n\nLimit 10000,10 ïƒ˜ åç§±é‡èµ¹å¤§åˆ™èµ¹æ…¢\n\n\næ¨èåˆ†é¡µ:\n\nSELECT * from table WHERE id&gt;&#x3D;23423 limit 11;\n\n\n\n_SELECT _ from table WHERE id&gt;&#x3D;23434 limit 11;\n\nåˆ†é¡µæ–¹å¼äºŒ:\n\nSELECT * from table WHERE id &gt;&#x3D; ( SELECT id from table limit 10000,1 ) limit 10;\n\n\nåˆ†é¡µæ–¹å¼ä¸‰:\n\nSELECT * FROM table INNER JOIN (SELECT id FROM table LIMIT 10000,10) USING (id);\n\n\nåˆ†é¡µæ–¹å¼å››:\n\nç¨‹åºå– ID:SELECT id from table limit 10000,10;\nSELECT * from table WHERE id in (123,456â€¦);\n\n\nå¯èƒ½éœ€æŒ‰åœºæ™¯åˆ†æå¹µé‡ç»„ç´¢å¼•\n\nç¤ºä¾‹:\n\n\nMySQL> SELECT sql_no_cache * from post limit 10,10; 10 row in set (0.01 sec)\nMySQL> SELECT sql_no_cache * from post limit 20000,10; 10 row in set (0.13 sec)\nMySQL> SELECT sql_no_cache * from post limit 80000,10; 10 rows in set (0.58 sec)\nMySQL> SELECT sql_no_cache id from post limit 80000,10; 10 rows in set (0.02 sec)\nMySQL> SELECT sql_no_cache * from post WHERE id>=323423 limit 10; 10 rows in set (0.01 sec)\nMySQL> SELECT * from post WHERE id >= ( SELECT sql_no_cache id from post limit 80000,1 ) limit 10; 10 rows in set (0.02 sec)\n\n4.11 ç”¨ UNION ALL è€Œé UNION\nè‹¥æ— éœ€å¯¹ç»“æœè¿›è¡Œå»é‡ï¼Œåˆ™ç”¨ UNION ALL\n\nUNION æœ‰å»é‡å¼€é”€\n\n\nä¸¾ä¾‹:\n\n\nSELECT * FROM detail20091128 UNION ALL SELECT * FROM detail20110427 UNION ALL SELECT * FROM detail20110426 UNION ALL SELECT * FROM detail20110425 UNION ALL SELECT * FROM detail20110424 UNION ALL SELECT * FROM detail20110423;\n\n4.12 åˆ†è§£è”æ¥ä¿è¯é«˜å¹¶å‘\né«˜å¹µå‘ DB ä¸å»ºè®®è¿›è¡Œä¸¤ä¸ªè¡¨ä»¥ä¸Šçš„ JOIN\n\né€‚å½“åˆ†è§£è”æ¥ä¿è¯é«˜å¹µå‘\n\nå¯ç¼“å­˜å¤§é‡æ—©æœŸæ•°æ®\nä½¿ç”¨äº†å¤šä¸ª MyISAM è¡¨\nå¯¹å¤§è¡¨çš„å° ID IN()\nè”æ¥å¼•ç”¨åŒä¸€ä¸ªè¡¨å¤šæ¬¡\nä¸¾ä¾‹:\n\n\n\nMySQL> SELECT * from tag JOIN post on tag_post.post_id=post.id WHERE tag.tag='äºŒæ‰‹ç©å…·';\n\nMySQL> SELECT * from tag WHERE tag='äºŒæ‰‹ç©å…·';\nMySQL> SELECT * from tag_post WHERE tag_id=1321;\nMySQL> SELECT * from post WHERE post.id in (123,456,314,141);\n\n4.13 GROUP BY å»é™¤æ’åº\nGROUP BY å®ç°\n\nåˆ†ç»„\nè‡ªåŠ¢æ’åº\n\n\næ— éœ€æ’åº:Order by NULL\n\nç‰¹å®šæ’åº:Group by DESC&#x2F;ASC\n\nä¸¾ä¾‹:\n\n\nMySQL> SELECT phone,count(*) from post group by phone limit 1 ; 1 row in set (2.19 sec)\nMySQL> SELECT phone,count(*) from post group by phone order by null limit 1; 1 row in set (2.02 sec)\n\n4.14 åŒæ•°æ®ç±»å‹çš„åˆ—å€¼æ¯”è¾ƒ\nåŸåˆ™:æ•°å­—å¯¹æ•°å­—ï¼Œå­—ç¬¦å¯¹å­—ç¬¦\n\næ•°å€¼åˆ—ä¸å­—ç¬¦ç±»å‹æ¯”è¾ƒ\n\nåŒæ—¶è½¬æ¢ä¸ºåŒç²¾åº¦\nè¿›è¡Œæ¯”å¯¹\n\n\nå­—ç¬¦åˆ—ä¸æ•°å€¼ç±»å‹æ¯”è¾ƒ\n\nå­—ç¬¦åˆ—æ•´åˆ—è½¬æ•°å€¼\nä¸ä¼šä½¿ç”¨ç´¢å¼•æŸ¥è¯¢\n\n\nä¸¾ä¾‹:å­—ç¬¦åˆ—ä¸æ•°å€¼ç±»å‹æ¯”è¾ƒ\n\n\nå­—æ®µ:`remark` varchar(50) NOT NULL COMMENT 'å¤‡æ³¨, é»˜è®¤ä¸ºç©º',\n\nMySQL>SELECT `id`, `gift_code` FROM gift WHERE `deal_id` = 640 AND remark=115127; 1 row in set (0.14 sec)\nMySQL>SELECT `id`, `gift_code` FROM pool_gift WHERE `deal_id` = 640 AND remark='115127'; 1 row in set (0.005 sec)\n\n4.15 Load data å¯¼æ•°æ®\næ‰¹é‡æ•°æ®å¿«å¯¼å…¥:\n\næˆæ‰¹è£…è½½æ¯”å•è¡Œè£…è½½æ›´å¿«ï¼Œä¸éœ€è¦æ¯æ¬¡åˆ·æ–°ç¼“å­˜\næ— ç´¢å¼•æ—¶è£…è½½æ¯”ç´¢å¼•è£…è½½æ›´å¿«\nInsert values ,valuesï¼Œvalues å‡å°‘ç´¢å¼•åˆ·æ–°\nLoad data æ¯” insert å¿«çº¦ 20 å€\n\n\nå°½é‡ä¸ç”¨ INSERT â€¦ SELECT\n\nå»¶è¿Ÿ\nåŒæ­¥å‡ºé”™\n\n\n\n4.16 æ‰“æ•£å¤§æ‰¹é‡æ›´æ–°\nå¤§æ‰¹é‡æ›´æ–°å‡Œæ™¨æ“ä½œï¼Œé¿å¼€é«˜å³°\nå‡Œæ™¨ä¸é™åˆ¶\nç™½å¤©ä¸Šé™é»˜è®¤ä¸º 100 æ¡&#x2F;ç§’(ç‰¹æ®Šå†è®®)\nä¸¾ä¾‹:\n\nupdate post set tag=1 WHERE id in (1,2,3); sleep 0.01;\nupdate post set tag=1 WHERE id in (4,5,6); sleep 0.01;\n......\n\n4.17 Know Every SQL\nSHOW PROFILE\nMySQLdumpslow\nEXPLAIN\nShow Slow Log\nSHOW QUERY_RESPONSE_TIME(Percona)\nMySQLsla\nShow Processlist\n\n4.18 SQL ç±»å†›è§„å°ç»“\nSQL è¯­å¥å°½å¯èƒ½ç®€å•\nä¿æŒäº‹åŠ¡(è¿æ¥)çŸ­å°\nå°½å¯èƒ½é¿å…ä½¿ç”¨ SP&#x2F;TRIG&#x2F;FUNC\nå°½é‡ä¸ç”¨ SELECT *\næ”¹å†™ OR è¯­å¥\né¿å…è´Ÿå‘æŸ¥è¯¢å’Œ% å‰ç¼€æ¨¡ç³ŠæŸ¥è¯¢\nå‡å°‘ COUNT(*)\nLIMIT çš„é«˜æ•ˆåˆ†é¡µ\nç”¨ UNION ALL è€Œé UNION\nåˆ†è§£è”æ¥ä¿è¯é«˜å¹µå‘\nGROUP BY å»é™¤æ’åº\nåŒæ•°æ®ç±»å‹çš„åˆ—å€¼æ¯”è¾ƒ\nLoad data å¯¼æ•°æ®\næ‰“æ•£å¤§æ‰¹é‡æ›´æ–°\nKnow Every SQL!\n\näº”ã€çº¦å®šç±»å†›è§„(5)5.1 éš”ç¦»çº¿ä¸Šçº¿ä¸‹\næ„å»ºæ•°æ®åº“çš„ç”Ÿæ€ç¯å¢ƒ\n\nå¼€å‘æ— çº¿ä¸Šåº“æ“ä½œæƒé™\n\nåŸåˆ™:çº¿ä¸Šè¿çº¿ä¸Šï¼Œçº¿ä¸‹è¿çº¿ä¸‹\n\nå®æ—¶æ•°æ®ç”¨ real åº“\næ¨¡æ‹Ÿç¯å¢ƒç”¨ sim åº“\næµ‹è¯•ç”¨ qa åº“\nå¼€å‘ç”¨ dev åº“\n\n\n\n5.2 ç¦æ­¢æœªç» DBA ç¡®è®¤çš„å­æŸ¥è¯¢\nMySQL å­æŸ¥è¯¢\n\nå¤§éƒ¨åˆ†æƒ…å†µä¼˜åŒ–è¾ƒå·®\nç‰¹åˆ« WHERE ä¸­ä½¿ç”¨ IN id çš„å­æŸ¥è¯¢ ïƒ˜ ä¸€èˆ¬å¯ç”¨ JOIN æ”¹å†™\n\n\nä¸¾ä¾‹:\n\n\nSELECT * from table1 where id id from table2) in (SELECT insert into table1 (SELECT * from table2); -- å¯èƒ½å¯¼è‡´å¤åˆ¶å¼‚å¸¸\n\n5.3 æ°¸è¿œä¸åœ¨ç¨‹åºç«¯æ˜¾å¼åŠ é”\næ°¸è¿œä¸åœ¨ç¨‹åºç«¯å¯¹æ•°æ®åº“æ˜¾å¼åŠ é”\n\nå¤–éƒ¨é”å¯¹æ•°æ®åº“ä¸å¯æ§\né«˜å¹¶å‘å‘æ—¶æ˜¯ç¾éš¾\næéš¾è°ƒè¯•å’Œæ’æŸ¥\n\n\nå¹¶å‘æ‰£æ¬¾ç­‰ä¸€è‡´æ€§é—®é¢˜\n\né‡‡ç”¨äº‹åŠ¡\nç›¸å¯¹å€¼ä¿®æ”¹\nCommit å‰äºŒæ¬¡è¾ƒéªŒå†²çª\n\n\n\n5.4 ç»Ÿä¸€å­—ç¬¦é›†ä¸º UTF8\nå­—ç¬¦é›†:\n\nMySQL 4.1 ä»¥å‰å§æœ‰ latin1\nä¸ºå¤šè¯­è¨€æ”¯æŒå¢åŠ å¤šå­—ç¬¦é›†\nä¹Ÿå¸¦æ¥äº† N å¤šé—®é¢˜\nä¿æŒç®€å•\n\n\nç»Ÿä¸€å­—ç¬¦é›†:UTF8\n\næ ¡å¯¹è§„åˆ™:utf8_general_ci\n\nä¹±ç :SET NAMES UTF8\n\n\n5.5 ç»Ÿä¸€å‘½åè§„èŒƒ\nåº“è¡¨ç­‰åç§°ç»Ÿä¸€ç”¨å°å†™\n\nLinux VS Windows\nMySQL åº“è¡¨å¤§å°å†™æ•æ„Ÿ\nå­—æ®µåçš„å¤§å°å†™ä¸æ•æ„Ÿ\n\n\nç´¢å¼•å‘½åé»˜è®¤ä¸ºâ€œidx_å­—æ®µåâ€\n\nåº“åç”¨ç¼©å†™ï¼Œå°½é‡åœ¨ 2~7 ä¸ªå­—æ¯\n\nDataSharing &#x3D;&#x3D;&gt; ds\n\n\næ³¨æ„é¿å…ç”¨ä¿ç•™å­—å‘½å\n\nâ€¦â€¦\n\n\n5.6 æ³¨æ„é¿å…ç”¨ä¿ç•™å­—å‘½å\nä¸¾ä¾‹:\n\nSELECT * from return;\nSELECT * from `return`;\n\nMySQLç³»ç»Ÿå…³é”®å­—\n\nADD\nALL\nALTER GOTO\nGRANT\nGROUP\nPURGE\nRAID0\nRANGE\nANALYZE\nAND\nAS HAVING\nHIGH_PRIORIT Y\nHOUR_MICROSEC OND\nREAD\nREADS\nREAL\nASC\nASENSITIVE\nBEFORE HOUR_MINUTE\nHOUR_SECON D\nIF\nREFERENCES\nREGEXP\nRELEASE\nBETWEEN\nBIGINT\nBINARY IGNORE\nIN\nINDEX\nRENAME\nREPEAT\nREPLACE\nBLOB\nBOTH\nBY INFILE\nINNER\nINOUT\nREQUIRE\nRESTRICT\nRETURN\nCALL\nCASCADE\nCASE INSENSITIVE\nINSERT\nINT\nREVOKE\nRIGHT\nRLIKE\nCHANGE\nCHAR\nCHARACTER INT1\nINT2\nINT3\nSCHEMA\nSCHEMAS\nSECOND_MICROSEC OND\nCHECK\nCOLLATE\nCOLUMN INT4\nINT8\nINTEGER\nSELECT\nSENSITIVE\nSEPARATOR\nCONDITION\nCONNECTION\nCONSTRAINT INTERVAL\nINTO\nIS\nSET\nSHOW\nSMALLINT\nCONTINUE\nCONVERT\nCREATE ITERATE\nJOIN\nKEY\nSPATIAL\nSPECIFIC\nSQL\nCROSS\nCURRENT_DA TE\nCURRENT_TIM KEYS E\nKILL\nLABEL\nSQLEXCEPTION\nSQLSTATE\nSQLWARNING\nCURRENT_TIMESTA MP\nCURRENT_US ER\nCURSOR LEADING\nLEAVE\nLEFT\nSQL_BIG_RESUL T\nSQL_CALC_FOUND_R OWS\nSQL_SMALL_RESULT\nDATABASE\nDATABASES\nDAY_HOUR LIKE\nLIMIT\nLINEAR\nSSL\nSTARTING\nSTRAIGHT_JOIN\nDAY_MICROSECON D\nDAY_MINUTE\nDAY_SECOND LINES\nLOAD\nLOCALTIME\nTABLE\nTERMINATED\nTHEN\nDEC\nDECIMAL\nDECLARE LOCALTIMESTAMP\nLOCK\nLONG\nTINYBLOB\nTINYINT\nTINYTEXT\nDEFAULT\nDELAYED\nDELETE LONGBLOB\nLONGTEXT\nLOOP\nTO\nTRAILING\nTRIGGER\nDESC\nDESCRIBE\nDETERMINISTI LOW_PRIORITY C\nMATCH\nMEDIUMBLOB\nTRUE\nUNDO\nUNION\nDISTINCT\nDISTINCTROW\nDIV MEDIUMINT\nMEDIUMTEXT\nMIDDLEINT\nUNIQUE\nUNLOCK\nUNSIGNED\nDOUBLE\nDROP\nDUAL\nMINUTE_MICROSECO ND\nMINUTE_SECO ND\nMOD\nUPDATE\nUSAGE\nUSE\nEACH\nELSE\nELSEIF MODIFIES\nNATURAL\nNOT\nUSING\nUTC_DATE\nUTC_TIME\nENCLOSED\nESCAPED\nEXISTS\nNO_WRITE_TO_BINL OG\nNULL\nNUMERIC\nUTC_TIMESTAM P\nVALUES\nVARBINARY\nEXIT\nEXPLAIN\nFALSE ON\nOPTIMIZE\nOPTION\nVARCHAR\nVARCHARACTER\nVARYING\nFETCH\nFLOAT\nFLOAT4 OPTIONALLY\nOR\nORDER\nWHEN\nWHERE\nWHILE\nFLOAT8\nFOR\nFORCE OUT\nOUTER\nOUTFILE\nWITH\nWRITE\nX509\nFOREIGN\nFROM\nFULLTEXT PRECISION\nPRIMARY\nPROCEDURE\nXOR\nYEAR_MONTH\nZEROFILL\n\n5.7 çº¦å®šç±»å†›è§„å°ç»“\néš”ç¦»çº¿ä¸Šçº¿ä¸‹\nç¦æ­¢æœªç» DBA ç¡®è®¤çš„å­æŸ¥è¯¢ä¸Šçº¿\næ°¸è¿œä¸åœ¨ç¨‹åºç«¯æ˜¾å¼åŠ é”\nç»Ÿä¸€å­—ç¬¦é›†ä¸º UTF8\nç»Ÿä¸€å‘½åè§„èŒƒ\n\nå…­ã€åŸæ–‡é“¾æ¥\nhttp://weibo.com/wushizhan\n\n","slug":"MySQL/MySQLæ•°æ®åº“å¼€å‘çš„ä¸‰åå…­æ¡å†›è§„","date":"2022-02-26T03:37:18.000Z","categories_index":"MySQL","tags_index":"MySQL","author_index":"Anchor"},{"id":"d8253a8b0f6101721f69eb1f7316985f","title":"Mybatisä¸€çº§ç¼“å­˜å¯¼è‡´çš„å†…å­˜æº¢å‡º","content":"\n\n\n\n\n\n\n\n\næ¥ä¸Šç¯‡ Druid ç›‘æ§å¯¼è‡´çš„å†…å­˜æº¢å‡ºé—®é¢˜å®šä½å¤„ç† JVM å†…å­˜æº¢å‡ºç›¸å…³ï¼ŒåºŸè¯ä¸å¤šè¯´ç›´æ¥ä¸Šåˆ†æè¿‡ç¨‹ã€‚\n\n\n1ã€æœåŠ¡å™¨å†…å­˜å¿«ç…§åˆ†æ  é¦–å…ˆé€šè¿‡å¿«ç…§æŸ¥çœ‹æœ€å¤§çš„äºŒåä¸ªå¯¹è±¡å¦‚ä¸‹å›¾ï¼š  \næ ¹æ®åé¦ˆæ•°æ®å¯ä»¥å‘ç°å‰åä¸ªå¯¹è±¡å¤§å°åŸºæœ¬å·®ä¸å¤šï¼ŒçŒœæµ‹åº”è¯¥ç”±ä¸€ä¸ªé—®é¢˜å¯¼è‡´ï¼Œç‚¹å‡»å»è¿›ä¸€æ­¥å®šä½é—®é¢˜ã€‚\n2ã€å®šä½å¼•èµ·å†…å­˜æº¢å‡ºçš„å…³é”®å¯¹è±¡  å‘ç°å¼•èµ·å†…å­˜æº¢å‡ºçš„å¯¹è±¡å¾ˆæ˜ç¡®ä¸º mybatis çš„ PerpetualCache å¯¹è±¡ï¼š    \n3ã€åˆ†æå¼•èµ·å†…å­˜æº¢å‡ºçš„åŸå› \nçŒœæµ‹æº¢å‡º\nPerpetualCache å…¶å®æ˜¯ Mybatis çš„ä¸€çº§ç¼“å­˜å¯¹è±¡ï¼Œä¸”å…¨éƒ¨ä¸º HashMap ç±»å‹å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥å¤§èƒ†çŒœæµ‹æ˜¯ç”±äº Mybatis ä¸€çº§ç¼“å­˜ä¸æ­£ç¡®ä½¿ç”¨é€ æˆçš„ï¼Œæ•¢äºå¦‚æ­¤çŒœæµ‹æ˜¯å› ä¸ºï¼š\nMyBatis å¯¹ä¼šè¯ï¼ˆSessionï¼‰çº§åˆ«çš„ä¸€çº§ç¼“å­˜è®¾è®¡çš„æ¯”è¾ƒç®€å•ï¼Œå°±ç®€å•åœ°ä½¿ç”¨äº† HashMap æ¥ç»´æŠ¤ï¼Œå¹¶æ²¡æœ‰å¯¹ HashMap çš„å®¹é‡å’Œå¤§å°è¿›è¡Œé™åˆ¶ã€‚\næ‰€ä»¥å¦‚æœæˆ‘ä»¬ä¸€ç›´ä½¿ç”¨æŸä¸€ä¸ª SqlSession å¯¹è±¡æŸ¥è¯¢æ•°æ®ï¼Œè¿™æ ·ä¼šä¸ä¼šå¯¼è‡´ HashMap å¤ªå¤§ï¼Œè€Œå¯¼è‡´ java.lang.OutOfMemoryError é”™è¯¯ï¼Ÿ\n\n\n\néªŒè¯æº¢å‡º\nMybatis çš„ä¸€çº§ç¼“å­˜æ˜¯äº‹åŠ¡çº§åˆ«çš„ï¼Œä¸€æ—¦äº‹åŠ¡æäº¤å°±ä¼šæ¸…ç©ºã€‚å› æ­¤å¯èƒ½è¯¥çº¿ç¨‹çš„äº‹åŠ¡ä¸€ç›´æœªç»“æŸå’Œæäº¤ã€‚é‚£å°±ä»ä¸€ä¸ªæ‹¥æœ‰å¤§é‡æŸ¥è¯¢ä¸šåŠ¡ç¹æ‚çš„åŠŸèƒ½å…¥æ‰‹éªŒè¯ï¼Œç»“åˆäºŒé˜¶æ®µå®šä½åˆ°çš„é›¶æ˜Ÿçº¿ç´¢ï¼Œå‘ç°æœåŠ¡å™¨å†…å­˜æº¢å‡ºæ—¶æ­£åœ¨å¤„ç†çš„ä¸šåŠ¡æ˜¯æ•°æ®ä¸‹å‘ï¼Œé‚£æˆ‘ä»¬å°±ä»¥æ¬¡ä¸ºå…¥æ‰‹ç‚¹éªŒè¯ï¼š\nA.é¦–å…ˆè®¾ç½® JVM å‚æ•°ï¼Œä¸ºäº†å°½å¿«å®ç°å†…å­˜æº¢å‡ºæ•ˆæœï¼Œè®¾å®šä¸€ä¸ªåˆé€‚çš„å‚æ•°ï¼Œå¯æ ¹æ®æœ¬åœ°ç¯å¢ƒè°ƒæ•´ï¼š\n-server -XX:PermSize=256M -XX:MaxPermSize=256m\n-Xms300M -Xmx300M\n-Dcom.sun.management.jmxremote.port=8999\n-Dcom.sun.management.jmxremote.ssl=false\n-Dcom.sun.management.jmxremote.authenticate=false\n-XX:+HeapDumpOnOutOfMemoryError\n-XX:HeapDumpPath=/Users/anchor/Downloads/dump/\n\nB.å¼€å¯ Jvisualvm ç›‘æ§ï¼Œåº”ç”¨ä¸­å¼€å¯ä¸‹å‘ä¸šåŠ¡ï¼Œè·å–ç›‘æ§æ•°æ®ï¼š\nå¦‚ä¸‹å›¾æ‰€ç¤ºå¯ä»¥çœ‹åˆ°ï¼Œæœ¬åœ°ç¨‹åºåœ¨è¿è¡Œä¸€æ®µæ—¶é—´åå·²ç»å¤„äºå‡æ­»çŠ¶æ€ï¼ŒGC å›æ”¶æ´»åŠ¨é¢‘ç¹ï¼Œå¯å †å†…å­˜åŸºæœ¬æœªè§æœ‰æ•ˆå›æ”¶ï¼ŒCPU è¿‡å±±è½¦å¼çš„èµ·ä¼ï¼Œå¾ˆå¿«å†…å­˜æº¢å‡ºäº†ï¼Œè‡³æ­¤å¯ä»¥å¾—å‡ºç»“è®ºæˆ‘ä»¬æ‰¾å¯¹äº†å…¥æ‰‹ç‚¹ï¼š\n\n\n\n\n\nä¿®æ”¹æº¢å‡º\nåŠ æ–­ç‚¹åˆ†æä¸‹å‘ä¸šåŠ¡å‘ç°ï¼Œä¸‹å‘ä¸šåŠ¡å­˜åœ¨å¤§é‡ for å¾ªç¯å¼•å‘å¤§é‡æ•°æ®åº“æŸ¥è¯¢æ“ä½œï¼Œä¸”è¯¥æ“ä½œå‚æ•°ä¸é‡å¤ï¼Œä¹Ÿå°±å¯¼è‡´äº† Mybatis çš„ä¸€çº§ç¼“å­˜ä¸€ç›´æ— æ³•å‘½ä¸­ï¼Œæ‰€ä»¥æ­£å¥½éªŒè¯æˆ‘ä»¬çš„çŒœæµ‹ï¼Œåœ¨ä¸€æ¬¡ä¸‹å‘è¯·æ±‚ä¸­ Mybatis åˆ›å»ºäº†æµ·é‡çš„ç¼“å­˜æ•°æ®ï¼Œæ”¹éƒ¨åˆ†æ•°æ®åœ¨ä¸‹å‘ä¸šåŠ¡å®Œæˆä¹‹å‰æ˜¯æ— æ³•é‡Šæ”¾çš„ï¼Œå ç”¨äº†å¤§é‡çš„å†…å­˜èµ„æºï¼Œå¦‚æœæ­¤æ—¶åˆšå¥½æœåŠ¡å™¨å†…å­˜æœ‰é™å¾ˆå®¹æ˜“å¼•å‘ GC overhead limit exceded é”™è¯¯ï¼Œè¿›è€Œé€ æˆæœåŠ¡å‡æ­»å†…å­˜æº¢å‡ºï¼š\n\n\n\n  ç»“åˆé¡¹ç›®å®é™…æƒ…å†µé’ˆå¯¹ä¸€çº§ç¼“å­˜çš„å¯åˆ©ç”¨ç‡å®åœ¨è¿‡ä½ï¼Œç”±äºå‚æ•°ä¸€ç›´å˜åŠ¨ï¼Œç¼“å­˜å‘½ä¸­å‡ ç‡æä½ï¼Œä» MyBatis ä¸€çº§ç¼“å­˜æ¥çœ‹ï¼Œå®ƒä»¥å•çº¯çš„ HashMap åšç¼“å­˜ï¼Œæ²¡æœ‰å®¹é‡æ§åˆ¶ï¼Œè€Œä¸€æ¬¡ SqlSession ä¸­é€šå¸¸æ¥è¯´å¹¶ä¸ä¼šæœ‰å¤§é‡çš„æŸ¥è¯¢æ“ä½œï¼Œå› æ­¤åªé€‚ç”¨äºä¸€æ¬¡ SqlSessionï¼Œä¸”é¡¹ç›®ä¸­å·²å¼€å¯äºŒçº§ç¼“å­˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ä¿®æ”¹ä¸€çº§ç¼“å­˜è§„åˆ™ï¼š\n  &lt;!-è®¾ç½®ä¸€çº§ç¼“å­˜æ¨¡å¼ä¸ºSTATEMENTï¼Œé»˜è®¤ä¸ºSESSIONï¼ŒSESSIONä¸ºä¼šè¯çº§åˆ«ï¼ŒSTATEMENTä¸ºSQLçº§åˆ«-&gt;\n&lt;setting name&#x3D;&quot;localCacheScope&quot; value&#x3D;&quot;STATEMENT&quot;&#x2F;&gt;\n&lt;!-PSï¼šä¸€çº§ç¼“å­˜çš„èŒƒå›´æœ‰SESSIONå’ŒSTATEMENTä¸¤ç§ï¼Œé»˜è®¤æ˜¯SESSIONï¼Œå¦‚æœæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨ä¸€çº§ç¼“å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠä¸€çº§ç¼“å­˜çš„èŒƒå›´æŒ‡å®šä¸ºSTATEMENTï¼Œè¿™æ ·æ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªMapperè¯­å¥åéƒ½ä¼šå°†ä¸€çº§ç¼“å­˜æ¸…é™¤ã€‚å¦‚æœéœ€è¦æ›´æ”¹ä¸€çº§ç¼“å­˜çš„èŒƒå›´ï¼Œè¯·åœ¨Mybatisçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œåœ¨&lt;settings&gt;ä¸‹é€šè¿‡localCacheScopeæŒ‡å®šã€‚-&gt;\n\n\n\nå†æ¬¡éªŒè¯\nå¯åŠ¨é¡¹ç›®ï¼Œå¼€å¯ä¸‹å‘ä¸šåŠ¡ï¼Œæ‰“å¼€ç›‘æ§ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š\n\n\n\n  818 å®¶é—¨åº—ä¸‹å‘ä¸šåŠ¡æ­£å¸¸å®Œæˆï¼ŒæœŸé—´å †å†…å­˜å›æ”¶ç¨³å®šï¼Œæ— æº¢å‡ºæƒ…å†µå‡ºç°ï¼ˆå¡åº¦è¾ƒé™¡æ˜¯å› ä¸ºæœ¬åœ° JVM å†…å­˜è®¾ç½®è¾ƒä½ï¼Œä¸ºæé«˜å†…å­˜åˆ©ç”¨ç‡ï¼ŒGC å›æ”¶é¢‘ç¹ï¼‰ã€‚\n4ã€æ€»ç»“\nç–‘é—®ï¼šæ—¢ç„¶ä¸€çº§ç¼“å­˜ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œä¸ºä»€ä¹ˆ Mybatis è¿˜å¦‚æ­¤è®¾è®¡ï¼Ÿ\nMyBatis è¿™æ ·è®¾è®¡ä¹Ÿæœ‰å®ƒè‡ªå·±çš„ç†ç”±ï¼š\n\n\n\n\n\n\n\n\n\na.ä¸€èˆ¬è€Œè¨€ SqlSession çš„ç”Ÿå­˜æ—¶é—´å¾ˆçŸ­ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨ä¸€ä¸ª SqlSession å¯¹è±¡æ‰§è¡Œçš„æ“ä½œä¸ä¼šå¤ªå¤šï¼Œæ‰§è¡Œå®Œå°±ä¼šæ¶ˆäº¡ï¼›\n\n\n\n\n\n\n\n\n\nb.å¯¹äºæŸä¸€ä¸ª SqlSession å¯¹è±¡è€Œè¨€ï¼Œåªè¦æ‰§è¡Œ update æ“ä½œï¼ˆupdateã€insertã€deleteï¼‰ï¼Œéƒ½ä¼šå°†è¿™ä¸ª SqlSession å¯¹è±¡ä¸­å¯¹åº”çš„ä¸€çº§ç¼“å­˜æ¸…ç©ºæ‰ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šå‡ºç°ç¼“å­˜è¿‡å¤§ï¼Œå½±å“ JVM å†…å­˜ç©ºé—´çš„é—®é¢˜ï¼›\n\n\n\n\n\n\n\n\n\nc.å¯ä»¥æ‰‹åŠ¨åœ°é‡Šæ”¾æ‰ SqlSession å¯¹è±¡ä¸­çš„ç¼“å­˜ã€‚\n\næ”¶è·ï¼šMybatis ä¸€çº§ç¼“å­˜çš„å­˜å‚¨æµç¨‹\n\n\n\n\n\n\n\n\n\na.MyBatis çš„ä¸€çº§ç¼“å­˜æ˜¯ SqlSession çº§åˆ«çš„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸å®šä¹‰åœ¨ SqlSessio æ¥å£çš„å®ç°ç±» DefaultSqlSession ä¸­ï¼Œè€Œæ˜¯å®šä¹‰åœ¨ DefaultSqlSession çš„æˆå‘˜å˜é‡ Executor ä¸­ï¼ŒExecutor æ˜¯åœ¨ openSession çš„æ—¶å€™è¢«å®ä¾‹åŒ–å‡ºæ¥çš„ï¼Œå®ƒçš„é»˜è®¤å®ç°ä¸º SimpleExecutorã€‚\n\n\n\n\n\n\n\n\n\nb.MyBatis ä¸­çš„ä¸€çº§ç¼“å­˜ï¼Œä¸æœ‰æ²¡æœ‰é…ç½®æ— å…³ï¼Œåªè¦ SqlSession å­˜åœ¨ï¼ŒMyBastis ä¸€çº§ç¼“å­˜å°±å­˜åœ¨ï¼ŒlocalCache çš„ç±»å‹æ˜¯ PerpetualCacheï¼Œå®ƒå…¶å®å¾ˆç®€å•ï¼Œä¸€ä¸ª id å±æ€§+ä¸€ä¸ª HashMap å±æ€§è€Œå·²ï¼Œid æ˜¯ä¸€ä¸ªåä¸ºâ€localCacheâ€çš„å­—ç¬¦ä¸²ï¼ŒHashMap ç”¨äºå­˜å‚¨æ•°æ®ï¼ŒKey ä¸º CacheKeyï¼ŒValue ä¸ºæŸ¥è¯¢ç»“æœã€‚\n\n\n\n\n\n\n\n\n\nc.MyBatis çš„ä¸€çº§ç¼“å­˜æŸ¥è¯¢çš„æ—¶å€™é»˜è®¤éƒ½æ˜¯ä¼šå…ˆå°è¯•ä»ä¸€çº§ç¼“å­˜ä¸­è·å–æ•°æ®çš„ï¼Œå³æƒ³æ¯æ¬¡æŸ¥è¯¢éƒ½èµ° DB ä¹Ÿè¡Œï¼Œå°†&lt;select&gt;æ ‡ç­¾ä¸­çš„ flushCache å±æ€§è®¾ç½®ä¸º true å³å¯ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡æŸ¥è¯¢çš„æ—¶å€™éƒ½ä¼šæ¸…ç†ä¸€é PerpetualCacheï¼ŒPerpetualCache ä¸­æ²¡æ•°æ®ï¼Œè‡ªç„¶åªèƒ½èµ° DBã€‚\n\n\n","slug":"Java/Mybatisä¸€çº§ç¼“å­˜å¯¼è‡´çš„å†…å­˜æº¢å‡º","date":"2018-09-29T12:06:29.000Z","categories_index":"JAVA","tags_index":"JVM,OOM,Mybatis","author_index":"Anchor"},{"id":"9736882d32005a945dbd1b55fb5920ee","title":"Druidç›‘æ§å¯¼è‡´çš„å†…å­˜æº¢å‡ºé—®é¢˜å®šä½å¤„ç†","content":"0ã€èµ·å›   ä¸€å°éƒ¨ç½²äºå•†æˆ·ç§æœ‰äº‘ä¸­çš„åº”ç”¨é¢‘ç¹å®•æœºï¼Œç»æŸ¥ä¸º OOMï¼Œå‘¨æœŸå¤§çº¦ä¸€å‘¨ä¸€æ¬¡ï¼Œè¾ƒè§„å¾‹ï¼Œæ‰€è°“åƒé‡Œä¹‹å ¤æ¯äºèšç©´ï¼Œåˆæ­¥æ€€ç–‘æ˜¯è½»å¾®çš„å†…å­˜æ³„æ¼ä¸æ–­ç§¯ç´¯å¯¼è‡´çš„å†…å­˜æº¢å‡ºï¼Œæ‰€ä»¥å†æ¬¡å®•æœºå‡ºç°æ—¶æœæ–­ dump å†…å­˜é•œåƒå¼€å§‹åˆ†æ\n1ã€å†…å­˜æº¢å‡ºåŸç†\nå¸¸è§å†…å­˜æº¢å‡ºï¼š\nç›¸ä¿¡é€šè¿‡å†™ java ç¨‹åºè®¨ç”Ÿæ´»çš„äººå¯¹å†…å­˜æº¢å‡ºå¹¶ä¸é™Œç”Ÿï¼Œå…ˆçœ‹ä¸‰å¼ å›¾ï¼š\n\n\n\nHeap spaceï¼ˆå †ç©ºé—´ï¼‰\n\nPermgenï¼ˆæ°¸ä¹…ä»£ï¼‰\n\nå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰\n\nJVM å†…å­˜æ¨¡å‹\n\n\n  Java åº”ç”¨ç¨‹åºåœ¨å¯åŠ¨æ—¶ä¼šæŒ‡å®šæ‰€éœ€è¦çš„å†…å­˜å¤§å°ï¼Œå®ƒè¢«åˆ†å‰²æˆä¸¤ä¸ªä¸åŒçš„åŒºåŸŸï¼šHeap spaceï¼ˆå †ç©ºé—´ï¼‰å’ŒPermgenï¼ˆæ°¸ä¹…ä»£ï¼‰ã€‚\n  java.lang.OutOfMemoryError\n\n  æ­£å¦‚å­—é¢æ„æ€ï¼Œå½“åº”ç”¨ç¨‹åºè¯•å›¾å‘è¿™ä¸¤ä¸ªç©ºé—´æ·»åŠ æ›´å¤šçš„æ•°æ®ï¼Œä½†å´æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥å®¹çº³è¿™äº›æ•°æ®æ—¶ï¼Œå°†ä¼šè§¦å‘java.lang.OutOfMemoryErrorã€‚\n\nå†…å­˜æº¢å‡ºåŸå› åˆ†æ\n1ã€java.lang.OutOfMemoryError: PermGen space\nPermGen spaceçš„å…¨ç§°æ˜¯Permanent Generation space,æ˜¯æŒ‡å†…å­˜çš„æ°¸ä¹…ä¿å­˜åŒºåŸŸ, è¿™å—å†…å­˜ä¸»è¦æ˜¯è¢« JVM å­˜æ”¾ Class å’Œ Meta ä¿¡æ¯çš„,Class åœ¨è¢« Load æ—¶å°±ä¼šè¢«æ”¾åˆ°PermGen spaceä¸­, åŒæ—¶ GC(Garbage Collection)ä¸ä¼šåœ¨ä¸»ç¨‹åºè¿è¡ŒæœŸå¯¹ PermGen spaceè¿›è¡Œæ¸…ç†ã€‚\næ‰€ä»¥å¦‚æœä½ çš„åº”ç”¨ä¸­æœ‰å¾ˆå¤š CLASS çš„è¯,å°±å¾ˆå¯èƒ½å‡ºç° PermGen space é”™è¯¯ã€‚\né€šè¿‡ä¸Šé¢çš„æè¿°å°±å¯ä»¥å¾—å‡ºï¼šå¦‚æœè¦åŠ è½½çš„ class ä¸ jar æ–‡ä»¶å¤§å°è¶…è¿‡-XX:MaxPermSize å°±æœ‰å¯èƒ½ä¼šäº§ç”Ÿ java.lang.OutOfMemoryError: PermGen space ã€‚\næ¢å¥è¯è¯´-XX:MaxPermSize çš„å¤§å°è¦è¶…è¿‡ class ä¸ jar çš„å¤§å°ã€‚\n2ã€java.lang.OutOfMemoryError: Java heap space\nè™½ç„¶å„ç§ java è™šæ‹Ÿæœºçš„å®ç°æœºåˆ¶ä¸ä¸€,ä½†æ˜¯heap spaceå†…å­˜æº¢å‡ºäº§ç”Ÿçš„åŸå› ç›¸åŒï¼šé‚£å°±æ˜¯å †å†…å­˜ä¸å¤Ÿè™šæ‹Ÿæœºåˆ†é…äº†ã€‚\nç”±äºå†…å­˜çš„åˆ†é…æœºåˆ¶ä¸ GC æ˜¯æœ‰è”ç³»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å†…å­˜ä¸å¤Ÿç”¨æ—¶æœ‰éƒ¨åˆ†å†…å­˜ GC è‚¯å®šæ— æ³•é‡Šæ”¾ï¼Œè€Œæˆ‘ä»¬è¦æ‰¾çš„å°±æ˜¯ä¸ºä»€ä¹ˆ GC é‡Šæ”¾ä¸äº†å †å†…å­˜ã€‚\næ‰€ä»¥å½“äº§ç”Ÿheap spaceå†…å­˜æº¢å‡ºæ—¶ï¼Œå †å†…å­˜ä¸­å¯¹è±¡æ•°é‡è¿‡å¤šçš„å°±å¯èƒ½æ˜¯é—®é¢˜çš„æ ¹æºäº†ã€‚ä¾‹å¤–çš„æƒ…å†µæ˜¯ï¼Œç¨‹åºç¡®å®éœ€è¦é‚£ä¹ˆå¤šå†…å­˜ï¼Œè¿™æ—¶å°±è¦è€ƒè™‘å¢å¤§å †å†…å­˜ã€‚\n\n\n2ã€å†…å­˜æº¢å‡ºæ—¶åº”è¯¥åšä»€ä¹ˆ\næ”¶é›†æ¡ˆå‘ç°åœºæ•°æ®ï¼Œå°½å¿«æ¢å¤ç³»ç»Ÿ\nè·å–å†…å­˜å¿«ç…§ï¼Œæ ¹æ®é€‚ç”¨åœºæ™¯æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š\n1ã€ä½¿ç”¨ jmap å‘½ä»¤åœ¨æ¡ˆå‘ç°åœºæ‰‹åŠ¨ç”Ÿæˆ dump æ–‡ä»¶\njmap -dump:format=b,file=heap.dump \\`pid of java\\`\n2ã€ä½¿ç”¨ JVM å‚æ•°è‡ªåŠ¨åœ¨æ¡ˆå‘å½“åœºè·å– dump æ–‡ä»¶\n-XX:+HeapDumpOnOutOfMemoryError\n3ã€ä½¿ç”¨å…¶å®ƒå·¥å…·è·å– dump æ–‡ä»¶ï¼Œä¸»è¦é’ˆå¯¹æœ¬åœ°å¼€å‘ç¯å¢ƒï¼š\nåˆ†æ Heap Dump çš„å·¥å…·éƒ½å¯ä»¥è·å– Heap Dump æ–‡ä»¶ã€‚æ¯”å¦‚ï¼šjdk è‡ªå¸¦çš„å·¥å…· jvisualvmã€‚å…¶å®ƒå·¥å…·ï¼šEclipse memory analyzerï¼ˆjmatï¼‰ã€JProfiler ç­‰ã€‚\n\næœ¬åœ°å¤ç°ä¹‹ jvisualvm çš„ä½¿ç”¨\næ— è®ºæ˜¯ä¸ºäº†å†ç°æ¡ˆå‘åœºæ™¯è¿˜æ˜¯éªŒè¯ä¿®å¤æ•ˆæœï¼Œéƒ½éœ€è¦æˆ‘ä»¬åœ¨æœ¬åœ°ç¯å¢ƒä¸­ç›‘æ§ JVM çš„è¿è¡Œæƒ…å†µï¼ŒSO ä»¥æˆ‘ç†Ÿæ‚‰çš„jvisualvmä¸ºä¾‹ï¼Œç®€å•è¯´ä¸‹ä½¿ç”¨æ–¹æ³•\n\n\n\n\n\n\n\n\n\nVisualVM æä¾›åœ¨ Java è™šæ‹Ÿæœº (Java Virutal Machine, JVM) ä¸Šè¿è¡Œçš„ Java åº”ç”¨ç¨‹åºçš„è¯¦ç»†ä¿¡æ¯ã€‚åœ¨ VisualVM çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ä¸­ï¼Œæ‚¨å¯ä»¥æ–¹ä¾¿ã€å¿«æ·åœ°æŸ¥çœ‹å¤šä¸ª Java åº”ç”¨ç¨‹åºçš„ç›¸å…³ä¿¡æ¯ã€‚ï¼ˆæ‘˜è‡ªå®˜æ–¹ï¼‰ç®€å•è¯´æ¥ï¼ŒVisualVM æ˜¯ä¸€ç§é›†æˆäº†å¤šä¸ª JDK å‘½ä»¤è¡Œå·¥å…·çš„å¯è§†åŒ–å·¥å…·ï¼Œå®ƒèƒ½ä¸ºæ‚¨æä¾›å¼ºå¤§çš„åˆ†æèƒ½åŠ›ã€‚æ‰€æœ‰è¿™äº›éƒ½æ˜¯å…è´¹çš„ï¼å®ƒå›Šæ‹¬çš„å‘½ä»¤è¡Œå·¥å…·åŒ…æ‹¬ jstat, JConsole, jstack, jmap å’Œ jinfoï¼Œè¿™äº›å·¥å…·ä¸ JDK çš„æ ‡å‡†ç‰ˆæœ¬æ˜¯ä¸€è‡´çš„ã€‚ å¯ä»¥ä½¿ç”¨ VisualVM ç”Ÿæˆå’Œåˆ†ææµ·é‡æ•°æ®ã€è·Ÿè¸ªå†…å­˜æ³„æ¼ã€ç›‘æ§åƒåœ¾å›æ”¶å™¨ã€æ‰§è¡Œå†…å­˜å’Œ CPU åˆ†æã€‚å°½ç®¡ VisualVM è‡ªèº«è¦åœ¨ JDK6 è¿™ä¸ªç‰ˆæœ¬ä¸Šè¿è¡Œï¼Œä½†æ˜¯ JDK1.4 ä»¥ä¸Šç‰ˆæœ¬çš„ç¨‹åºå®ƒéƒ½èƒ½ç›‘æ§ã€‚VisualVM çš„ä¸€ä¸ªæœ€å¤§å¥½å¤„å°±æ˜¯ï¼Œå®ƒå·²ç»åœ¨ä½ çš„ JDK bin ç›®å½•é‡Œäº†ï¼Œåªè¦ä½ ä½¿ç”¨çš„æ˜¯ JDK1.6 Update7 ä¹‹åçš„ç‰ˆæœ¬ã€‚ç‚¹å‡»ä¸€ä¸‹ jvisualvm.exe å›¾æ ‡å®ƒå°±å¯ä»¥è¿è¡Œäº†ï¼Œä¹Ÿå¯ä»¥ç»ˆç«¯æˆ–è€… CMD ä¸­ä½¿ç”¨ jvisualvm å‘½ä»¤å¯åŠ¨ã€‚\nJvisualvm æœ¬åœ°è”è°ƒçš„ä¸¤ç§å¸¸ç”¨æ–¹æ³•ï¼š\n1ã€Jvisualvmä¸IDEAé›†æˆï¼ŒIntelij Idea -&gt; Preferences -&gt; Plugins -&gt;Browers Repositroriesï¼Œæœç´¢visualvmï¼Œé€‰æ‹©installï¼šå®‰è£…æˆåŠŸåä¼šæ·»åŠ visualvmçš„å¯åŠ¨é€‰é¡¹ï¼Œå¯åŠ¨ Tomcat çš„åŒæ—¶ä¼šæ‰“å¼€ä¸€ä¸ªVisualVMçš„çª—å£ã€‚\n\n2ã€ä¸é€šè¿‡æ’ä»¶ç›´æ¥å¯åŠ¨ï¼Œä¸æœ¬åœ° Tomcat è”è°ƒï¼Œéœ€è¦é…ç½®ä¸€ä¸‹ Tomcatï¼Œæ·»åŠ å‚æ•°ï¼š\n-Dcom.sun.management.jmxremote.port&#x3D;8999\n-Dcom.sun.management.jmxremote.ssl&#x3D;false\n-Dcom.sun.management.jmxremote.authenticate&#x3D;false\n\n3ã€è‡ªé€ æ¡ˆå‘ç°åœº\n\n\n\n\n\n\n\n\nä¸ºäº†å¿«é€ŸéªŒè¯æˆ‘ä»¬çš„å·¥å…·ä»¥åŠåŠ æ·±å¯¹ OOM çš„ç†è§£ï¼Œæˆ‘ä»¬è‡ªé€ å‡ ç§å†…å­˜æº¢å‡ºåœºæ™¯ï¼Œä»£ç æˆ‘å·²å‡†å¤‡å¦¥å½“ï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶è¿è¡ŒéªŒè¯ï¼Œå¼€å§‹å‰è®°å¾—æ ¹æ®ç¤ºä¾‹è°ƒæ•´ JVM å‚æ•°~\n\nPermGen OOM\n/**\n * @program: jvisualvmDemo\n * @description: jdk1.7æ°¸ä¹…åŒºå†…å­˜æº¢å‡º\n * -XX:MaxPermSize=5m\n * -XX:+HeapDumpOnOutOfMemoryError\n * -XX:HeapDumpPath=/Users/anchor/Downloads/dump/\n * @author: Anchor\n * @create: 2018-07-31\n **/\npublic class PermGenOOM &#123;\n    public static void main(String[] args) &#123;\n        while (true) &#123;\n            Enhancer enhancer = new Enhancer();\n            enhancer.setSuperclass(MetaOOM.OOMObject.class);\n            enhancer.setUseCache(false);\n            enhancer.setCallback(new MethodInterceptor() &#123;\n                public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable &#123;\n                    return proxy.invokeSuper(obj, args);\n                &#125;\n            &#125;);\n            //æ— é™åˆ›å»ºåŠ¨æ€ä»£ç†ï¼Œç”ŸæˆClasså¯¹è±¡\n            enhancer.create();\n        &#125;\n    &#125;\n    static class OOMObject &#123;\n\n    &#125;\n&#125;\n\n\nMetaOOM\n/**\n * @program: jvisualvmDemo\n * @description: æ–¹æ³•åŒºå†…å­˜å¼‚å¸¸\n * -XX:MetaspaceSize=8m\n * -XX:MaxMetaspaceSize=8m\n * -XX:+HeapDumpOnOutOfMemoryError\n * -XX:HeapDumpPath=/Users/anchor/Downloads/dump/\n * @author: Anchor\n * @create: 2018-07-27\n **/\npublic class MetaOOM &#123;\n\n    public static void main(String[] args) &#123;\n        while (true) &#123;\n            Enhancer enhancer = new Enhancer();\n            enhancer.setSuperclass(OOMObject.class);\n            enhancer.setUseCache(false);\n            enhancer.setCallback(new MethodInterceptor() &#123;\n                public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable &#123;\n                    return proxy.invokeSuper(obj, args);\n                &#125;\n            &#125;);\n            //æ— é™åˆ›å»ºåŠ¨æ€ä»£ç†ï¼Œç”ŸæˆClasså¯¹è±¡\n            enhancer.create();\n        &#125;\n    &#125;\n\n    static class OOMObject &#123;\n\n    &#125;\n&#125;\n\nHeapOOM\n/**\n * @program: jvisualvmDemo\n * @description: å †å†…å­˜å¼‚å¸¸\n * VM Args:\n *     //è¿™ä¸¤ä¸ªå‚æ•°ä¿è¯äº†å †ä¸­çš„å¯åˆ†é…å†…å­˜å›ºå®šä¸º20M\n *     -Xms20m\n *     -Xmx20m\n *     -XX:+HeapDumpOnOutOfMemoryError\n *     -XX:HeapDumpPath=/Users/anchor/Downloads/dump/\n * @author: Anchor\n * @create: 2018-07-27\n **/\npublic class HeapOOM &#123;\n    //åˆ›å»ºä¸€ä¸ªå†…éƒ¨ç±»ç”¨äºåˆ›å»ºå¯¹è±¡ä½¿ç”¨\n    static class OOMObject &#123;\n    &#125;\n    public static void main(String[] args) &#123;\n        List&lt;OOMObject> list = new ArrayList&lt;OOMObject>();\n        //æ— é™åˆ›å»ºå¯¹è±¡ï¼Œåœ¨å †ä¸­\n        while (true) &#123;\n            list.add(new OOMObject());\n        &#125;\n    &#125;\n&#125;\n\nJavaVMStackSOF\n/**\n * @program: jvisualvmDemo\n * @description: æ ˆå†…å­˜å¼‚å¸¸\n * VM Argsï¼š\n *     //è®¾ç½®æ ˆå®¹é‡ä¸º160Kï¼Œé»˜è®¤1M\n *    -Xss160k\n * @author: Anchor\n * @create: 2018-07-27\n **/\npublic class JavaVMStackSOF &#123;\n    private int stackLength = 1;\n    public void stackLeak() &#123;\n        stackLength++;\n        //é€’å½’è°ƒç”¨ï¼Œè§¦å‘å¼‚å¸¸\n        stackLeak();\n    &#125;\n\n    public static void main(String[] args) throws Throwable &#123;\n        JavaVMStackSOF oom = new JavaVMStackSOF();\n        try &#123;\n            oom.stackLeak();\n        &#125; catch (Throwable e) &#123;\n            System.out.println(\"stack length:\" + oom.stackLength);\n            throw e;\n        &#125;\n    &#125;\n&#125;\n\n4ã€æ¡ˆä¾‹åˆ†æ\n\n\n\n\n\n\n\n\nå•°é‡Œå•°å—¦è¿™ä¹ˆç»ˆäºè¦è¿›å…¥æ­£é¢˜äº† ğŸ˜¹\n\nå‡†å¤‡ç¯å¢ƒï¼Œæµ‹è¯•è„šæœ¬\næ ¹æ®æœ¬åœ°æœºå™¨æ€§èƒ½é…ç½® JVM å‚æ•°ï¼š\n-server -XX:PermSize&#x3D;256M -XX:MaxPermSize&#x3D;256m -Xms300M -Xmx300M\n-Dcom.sun.management.jmxremote.port&#x3D;8999\n-Dcom.sun.management.jmxremote.ssl&#x3D;false\n-Dcom.sun.management.jmxremote.authenticate&#x3D;false\n\nå‡†å¤‡æµ‹è¯•è„šæœ¬ï¼š\n#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\nfrom multiprocessing import Process,Pool\nimport os,time\nimport requests\n\ndef run_proc(name):\n    for i in range(30000):\n        postdata = &#123;'code': i&#125;\n        r = requests.post(\"http://localhost:8080/OOM.do\", data=postdata)\n\nif __name__ =='__main__':\n    print('Run the main process (%s).' % (os.getpid()))\n    mainStart = time.time()\n    p = Pool(8)\n    for i in range(16):\n        p.apply_async(run_proc,args=('Process'+str(i),))\n\n    print('Waiting for all subprocesses done ...')\n    p.close()\n    p.join()\n    print('All subprocesses done')\n    mainEnd = time.time()\n    print ('All process ran %0.2f seconds.' % (mainEnd-mainStart))\n\nå†…å­˜å¿«ç…§åˆ†æ\nå¿«ç…§å¯¼å…¥ visualvmï¼Œç®€å•ç¿»äº†ä¸€ä¸‹å¾ˆå¿«å‘ç°é—®é¢˜ï¼Œå†…å­˜ä¸­å­˜åœ¨å¤§é‡ SQL ç‰‡æ®µæœªå›æ”¶ï¼Œå¦‚å›¾ï¼š\n\nä¸ºä½•å†…å­˜ä¼šè¢«å¤§é‡ SQL ç‰‡æ®µå é¢†ï¼Œè«éï¼Ÿï¼Ÿï¼Ÿæœæ–­å¼€å¯æ–­è¨€ï¼ˆççŒœï¼‰æ¨¡å¼ï¼Œæˆ‘ä»¬è¦å¤ç°é—®é¢˜ï¼\n\n\n\n\n\n\n\n\n\nå‡è®¾ Aï¼šä½¿ç”¨äº†é™æ€å˜é‡å®šä¹‰ SQL ç‰‡æ®µï¼Œå¯¼è‡´èµ„æºæœªå›æ”¶ç¿»ä»£ç ç¡®è®¤ï¼Œå‘ç° SQL ä½¿ç”¨ String å¯¹è±¡æ‹¼æ¥ï¼Œéé™æ€å˜é‡ï¼Œä½†æ˜¯è¯¥ SQL è¿›è¡Œäº†ä¸Šç™¾æ¬¡çš„æ‹¼æ¥å¿…ç„¶é€ æˆèµ„æºæµªè´¹åŠ é‡ GC è´Ÿæ‹…,æœ‰ä¼˜åŒ–ç©ºé—´æ”¹ StringBuildï¼Œæµ‹è¯•ä¹‹ã€‚\nè„šæœ¬è·‘èµ·æ¥~ Emm~~ è²Œä¼¼æ²¡å•¥æ•ˆæœ\n\n\n\n\n\n\n\n\n\nå‡è®¾ Bï¼šè¿æ¥æ± ä¸å¤Ÿç”¨ï¼Ÿ\nç¿»ä»£ç ç¡®è®¤ï¼Œå‘ç°é…ç½®æ­£å¸¸ï¼Œæ”¹å°è¿æ¥æ± å¤§å°ï¼Œæµ‹è¯•ä¹‹ï¼Œæ— æ•ˆã€‚\n\n\n\n\n\n\n\n\n\nå‡è®¾ Cï¼šæ•°æ®åº“æœ‰æ­»é”ï¼Ÿ\nä½†æ˜¯ä¸è¿ç»´ç¡®è®¤æ¯æ¬¡å†…å­˜æº¢å‡ºåªéœ€é‡å¯åº”ç”¨å³å¯æ¢å¤ï¼Œæ•°æ®åº“æ— éœ€æ“ä½œï¼ŒPASS\n\n\n\n\n\n\n\n\n\nå‡è®¾ Dï¼šã€‚ã€‚ã€‚ã€‚ã€‚\n\n\n\n\n\n\n\n\n\nå‡è®¾ Xï¼šéš¾é“ Druid è¿æ¥æ± ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼Ÿ\næ£€æŸ¥ Druid é…ç½®ï¼Œå‘ç°ä»£ç ä¸­é™¤äº†ä½¿ç”¨äº†è¿æ¥æ± è¿˜é…ç½®äº† SQL ç›‘æ§ï¼ŒURL ç›‘æ§ï¼Œé‚£ä¹ˆç›‘æ§æ•°æ®å­˜å‚¨åœ¨å“ªé‡Œäº†ï¼Ÿéš¾é“é»˜è®¤æ˜¯å†…å­˜ä¸­ï¼Ÿç™¾åº¦ Google æ— æœï¼Œç›´æ¥åŠ¨æ‰‹å‹æµ‹ï¼Œæ¨¡æ‹Ÿ 50W è¯·æ±‚ï¼Œå¾—åˆ°å¦‚ä¸‹æ•°æ®ï¼šæˆåŠŸçš„çœ‹åˆ°äº†å†…å­˜æº¢å‡ºã€‚\n\nå¯¹æ¯”ç”Ÿäº§æœºå†…å­˜å¿«ç…§ï¼Œå‘ç°æœ‰æˆï¼ç»„æˆç»“æœåŸºæœ¬ä¸€è‡´ï¼Œå¯æ˜¯æ²¡é“ç†å•Šï¼Œéš¾åº¦ Druid è¿˜æœ‰è¿™ç§å¤§å‘ï¼Ÿä¸è¡Œä¸æ•¢ç¡®å®šï¼Œé‚£ä¹ˆæˆ‘ä»¬åå‘éªŒè¯ä¸‹ï¼Œå¦‚æœæˆ‘å…³æ‰ Druid çš„ç›‘æ§å‘¢ï¼Ÿè¯´å¹²å°±å¹²ï¼Œå†è·‘ 50W è¯·æ±‚ï¼š\n\næ¬§å…‹ï¼Œæœç„¶æœ‰ç‚¹æ„æ€ï¼ŒOOM æ¶ˆå¤±äº†(à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§\næ—¢ç„¶é—®é¢˜æ‰¾åˆ°äº†ï¼Œé‚£ä¹ˆå°±è¦åˆ†æä¸ºå•¥ä¼šå‡ºç°è¿™ç§å¤§å‘ï¼Œå…ˆä»å®˜ç½‘å…¥æ‰‹ï¼Œç¿»ä¸‹ Druid çš„ lssues å‘ç°ç«Ÿç„¶æœ‰å‰è¾ˆå·²ç»é—®è¿‡è¯¥ç±»é—®é¢˜\n\nbutï¼Œå®˜æ–¹å¹¶æœªå›å¤ï¼Œé‚£ä¹ˆçœ‹èµ·æ¥è¿™ä¸ªé—®é¢˜å¤ª lowï¼Ÿ\nEmmâ€¦. é‚£è‡ªå·±ç ”ç©¶ä¸‹å¥½äº†\n\nè¿›ä¸€æ­¥æ‰©å±•\nç¿»é˜…å®˜æ–¹æ–‡æ¡£ï¼Œ åœ¨ SQL åˆå¹¶é…ç½® ï¼Œå‘ç°å¦‚ä¸‹å†…å®¹ï¼š\n\n\n\n\n\n\n\n\n\nå½“ä½ ç¨‹åºä¸­å­˜åœ¨æ²¡æœ‰å‚æ•°åŒ–çš„ sql æ‰§è¡Œæ—¶ï¼Œsql ç»Ÿè®¡çš„æ•ˆæœä¼šä¸å¥½ã€‚æ¯”å¦‚ï¼šselect _ from t where id &#x3D; 1select _ from t where id &#x3D; 2select _ from t where id &#x3D; 3åœ¨ç»Ÿè®¡ä¸­ï¼Œæ˜¾ç¤ºä¸º 3 æ¡ sqlï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›è¦çš„æ•ˆæœã€‚StatFilter æä¾›åˆå¹¶çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå°†è¿™ 3 ä¸ª SQL åˆå¹¶ä¸ºå¦‚ä¸‹çš„ SQLselect _ from t where id &#x3D; ?\né—®é¢˜åˆ°æ­¤å·²ç»åŸºæœ¬æ˜äº†ï¼Œä¸è§„èŒƒçš„å…¥å‚å¯¼è‡´StatFilteræœªèƒ½æˆåŠŸåˆå¹¶ SQLï¼ŒDruid æˆåŠŸè®°å½•äº†æ‰€æœ‰çš„æ‰§è¡Œè¯­å¥ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚\nå¤§å®¶å¯ä»¥è‡ªè¡Œä½“ä¼šä¸‹è¿™ä¸¤ç§å†™æ³•çš„åŒºåˆ«ï¼š\n\n\n\n5ã€å†…å­˜æº¢å‡ºæ’æŸ¥æ€»ç»“\n\n\n\n\n\n\n\n\nå¯¼è‡´ OutOfMemoryError å¼‚å¸¸çš„å¸¸è§åŸå› æœ‰ä»¥ä¸‹å‡ ç§ï¼š\n   - å†…å­˜ä¸­åŠ è½½çš„æ•°æ®é‡è¿‡äºåºå¤§ï¼Œå¦‚ä¸€æ¬¡ä»æ•°æ®åº“å–å‡ºè¿‡å¤šæ•°æ®ï¼›\n   - é›†åˆç±»ä¸­æœ‰å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œä½¿ç”¨å®Œåæœªæ¸…ç©ºï¼Œä½¿å¾—JVMä¸èƒ½å›æ”¶ï¼›\n   - ä»£ç ä¸­å­˜åœ¨æ­»å¾ªç¯æˆ–å¾ªç¯äº§ç”Ÿè¿‡å¤šé‡å¤çš„å¯¹è±¡å®ä½“ï¼›\n   - ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹è½¯ä»¶ä¸­çš„BUGï¼›\n   - å¯åŠ¨å‚æ•°å†…å­˜å€¼è®¾å®šçš„è¿‡å°ï¼›\n   - ç¼–ç ä¸è§„èŒƒçš„éšæ‚£ï¼›\n\n","slug":"Java/Druidç›‘æ§å¯¼è‡´çš„å†…å­˜æº¢å‡ºé—®é¢˜å®šä½å¤„ç†","date":"2018-08-06T06:03:15.000Z","categories_index":"JAVA","tags_index":"JVM,OOM,Druid","author_index":"Anchor"},{"id":"1a07a30e4d12a51de2d9119320d5847f","title":"MySQL ä¸»é”®è®¾è®¡ç›˜ç‚¹","content":"ä¸»é”®å®šä¹‰å”¯ä¸€æ ‡è¯†è¡¨ä¸­æ¯è¡Œçš„ä¸€ä¸ªåˆ—ï¼ˆæˆ–ä¸€ç»„åˆ—ï¼‰ç§°ä¸ºä¸»é”®ã€‚ä¸»é”®ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªç‰¹å®šçš„è¡Œã€‚\nä¸»é”®è®¾è®¡å’Œåº”ç”¨åŸåˆ™é™¤äº†æ»¡è¶³MySQLå¼ºåˆ¶å®æ–½çš„è§„åˆ™ï¼ˆä¸»é”®ä¸å¯é‡å¤ï¼›ä¸€è¡Œä¸­ä¸»é”®ä¸å¯ä¸ºç©ºï¼‰ä¹‹å¤–ï¼Œä¸»é”®çš„è®¾è®¡å’Œåº”ç”¨åº”å½“è¿˜éµå®ˆä»¥ä¸‹å…¬è®¤çš„åŸåˆ™ï¼š\n\nä¸æ›´æ–°ä¸»é”®åˆ—ä¸­çš„å€¼ï¼›\nä¸é‡ç”¨ä¸»é”®åˆ—çš„å€¼ï¼›\nä¸åœ¨ä¸»é”®åˆ—ä¸­ä½¿ç”¨å¯èƒ½ä¼šæ›´æ”¹çš„å€¼ã€‚ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨ä¸€ä¸ª åå­—ä½œä¸ºä¸»é”®ä»¥æ ‡è¯†æŸä¸ªä¾›åº”å•†ï¼Œå½“è¯¥ä¾›åº”å•†åˆå¹¶å’Œæ›´æ”¹å…¶ åå­—æ—¶ï¼Œå¿…é¡»æ›´æ”¹è¿™ä¸ªä¸»é”®ã€‚ï¼‰\n\nä¸»é”®ç”Ÿæˆç­–ç•¥è‡ªå¢IDä½¿ç”¨æ•°æ®åº“çš„è‡ªåŠ¨å¢é•¿ï¼ˆauto_incrementï¼‰ï¼Œæ˜¯æ¯”è¾ƒç®€å•å’Œå¸¸è§çš„IDç”Ÿæˆæ–¹æ¡ˆï¼Œæ•°æ®åº“å†…éƒ¨å¯ä»¥ç¡®ä¿ç”Ÿæˆidçš„å”¯ä¸€æ€§ã€‚ä¼˜ç‚¹ï¼š1ã€æ•°æ®åº“è‡ªåŠ¨ç¼–å·ï¼Œé€Ÿåº¦å¿«ï¼Œè€Œä¸”æ˜¯å¢é‡å¢é•¿ï¼Œèšé›†å‹ä¸»é”®æŒ‰é¡ºåºå­˜æ”¾ï¼Œå¯¹äºæ£€ç´¢éå¸¸æœ‰åˆ©ã€‚2ã€ æ•°å­—å‹ï¼Œå ç”¨ç©ºé—´å°ï¼Œæ˜“æ’åºï¼Œåœ¨ç¨‹åºä¸­ä¼ é€’æ–¹ä¾¿ã€‚ç¼ºç‚¹ï¼š1ã€ä¸æ”¯æŒæ°´å¹³åˆ†ç‰‡æ¶æ„ï¼Œæ°´å¹³åˆ†ç‰‡çš„è®¾è®¡å½“ä¸­ï¼Œè¿™ç§æ–¹æ³•æ˜¾ç„¶ä¸èƒ½ä¿è¯å…¨å±€å”¯ä¸€ã€‚2ã€å¯¹æ•°æ®åº“æœ‰ä¾èµ–ï¼Œæ¯ç§æ•°æ®åº“å¯èƒ½å®ç°ä¸ä¸€æ ·ï¼Œæ•°æ®åº“åˆ‡æ¢æ—¶å€™ï¼Œæ¶‰åŠåˆ°ä»£ç çš„ä¿®æ”¹ï¼Œä¸åˆ©äºæ‰©å±•ç»“è®ºï¼šè‡ªå¢idåšä¸»é”®é€‚ç”¨äºéåˆ†å¸ƒå¼æ¶æ„ã€‚\nUUID| **UUID:é€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼ˆè‹±è¯­ï¼šUniversally Unique Identifierï¼Œç¼©å†™ï¼šUUIDï¼‰æ˜¯ç”¨äºè®¡ç®—æœºä½“ç³»ä¸­ä»¥è¯†åˆ«ä¿¡æ¯æ•°ç›®çš„ä¸€ä¸ª128ä½æ ‡è¯†ç¬¦ï¼Œè¿˜æœ‰ç›¸å…³çš„æœ¯è¯­ï¼šå…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆGUIDï¼‰ã€‚ æ ¹æ®æ ‡å‡†æ–¹æ³•ç”Ÿæˆï¼Œä¸ä¾èµ–ä¸­å¤®æœºæ„çš„æ³¨å†Œå’Œåˆ†é…ï¼ŒUUIDå…·æœ‰å”¯ä¸€æ€§ï¼Œè¿™ä¸å…¶ä»–å¤§å¤šæ•°ç¼–å·æ–¹æ¡ˆä¸åŒã€‚é‡å¤UUIDç æ¦‚ç‡æ¥è¿‘é›¶ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚UUIDæ˜¯ç”±ä¸€ç»„32ä½æ•°çš„16è¿›åˆ¶æ•°å­—æ‰€æ„æˆ,æ ‡å‡†å‹å¼åŒ…å«32ä¸ª16è¿›åˆ¶æ•°å­—ï¼Œä»¥è¿å­—å·åˆ†ä¸ºäº”æ®µï¼Œå½¢å¼ä¸º8-4-4-4-12çš„32ä¸ªå­—ç¬¦ã€‚ç¤ºä¾‹ï¼š550e8400-e29b-41d4-a716-446655440000\n\n\n\nåˆ°ç›®å‰ä¸ºæ­¢ä¸šç•Œä¸€å…±æœ‰5ç§æ–¹å¼ç”ŸæˆUUIDï¼Œè¯¦æƒ…å¯è§IETFå‘å¸ƒçš„UUIDè§„èŒƒ**A Universally Unique IDentifier (UUID) URN Namespace\n\n\n\nä¼˜ç‚¹ï¼šæ€§èƒ½éå¸¸é«˜ï¼šæœ¬åœ°ç”Ÿæˆï¼Œæ²¡æœ‰ç½‘ç»œæ¶ˆè€—ã€‚ç¼ºç‚¹ï¼š1ã€ä¸æ˜“äºå­˜å‚¨ï¼šUUIDå¤ªé•¿ï¼Œ16å­—èŠ‚128ä½ï¼Œé€šå¸¸ä»¥36é•¿åº¦çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå¾ˆå¤šåœºæ™¯ä¸é€‚ç”¨ã€‚2ã€ä¿¡æ¯ä¸å®‰å…¨ï¼šåŸºäºMACåœ°å€ç”ŸæˆUUIDçš„ç®—æ³•å¯èƒ½ä¼šé€ æˆMACåœ°å€æ³„éœ²ï¼Œè¿™ä¸ªæ¼æ´æ›¾è¢«ç”¨äºå¯»æ‰¾æ¢…ä¸½èç—…æ¯’çš„åˆ¶ä½œè€…ä½ç½®ã€‚3ã€IDä½œä¸ºä¸»é”®æ—¶åœ¨ç‰¹å®šçš„ç¯å¢ƒä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚éœ€è¦æ’åºçš„æ—¶å€™â€”â€”UUIDæ˜¯æ— åºçš„ã€‚4ã€MySQLå®˜æ–¹æœ‰æ˜ç¡®çš„å»ºè®®ä¸»é”®è¦å°½é‡è¶ŠçŸ­è¶Šå¥½ï¼Œ36ä¸ªå­—ç¬¦é•¿åº¦çš„UUIDä¸ç¬¦åˆè¦æ±‚ã€‚5ã€å¯¹MySQLç´¢å¼•ä¸åˆ©ï¼šä½œä¸ºæ•°æ®åº“ä¸»é”®ï¼Œåœ¨InnoDBå¼•æ“ä¸‹ï¼ŒUUIDçš„æ— åºæ€§å¯èƒ½ä¼šå¼•èµ·æ•°æ®ä½ç½®é¢‘ç¹å˜åŠ¨ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚å…³äºMySQL ä½¿ç”¨è‡ªå¢IDä¸»é”®å’ŒUUID ä½œä¸ºä¸»é”®çš„æ€§èƒ½æ¯”è¾ƒå¯ä»¥æŸ¥çœ‹å‚è€ƒã€8ã€‘ã€‚ç»“è®ºï¼š1ã€uuidåšä¸»é”®é€‚ç”¨äºå°è§„æ¨¡åˆ†å¸ƒå¼æ¶æ„ç”¨ã€‚2ã€åœ¨ä½¿ç”¨uuidä½œä¸ºä¸»é”®çš„æ—¶å€™ï¼Œæœ€å¥½è®¾è®¡createtimeï¼ˆåˆ›å»ºæ—¶é—´ï¼‰åˆ—å’Œmodifytimeï¼ˆä¿®æ”¹æ—¶é—´ï¼‰åˆ—ä»¥åº”ä»˜å¯èƒ½çš„æ’åºç­‰åœºæ™¯ã€‚\nè‡ªå»ºçš„idç”Ÿæˆå™¨Twitterçš„snowflakeç®—æ³•Twitterçš„snowflakeç®—æ³•çš„æ ¸å¿ƒæŠŠæ—¶é—´æˆ³ï¼Œå·¥ä½œæœºå™¨idï¼Œåºåˆ—å·ç»„åˆåœ¨ä¸€èµ·ã€‚é™¤äº†æœ€é«˜ä½bitæ ‡è®°ä¸ºä¸å¯ç”¨ä»¥å¤–ï¼Œå…¶ä½™ä¸‰ç»„bitå ä½å‡å¯æµ®åŠ¨ï¼Œçœ‹å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚è€Œå®šã€‚é»˜è®¤æƒ…å†µä¸‹41bitçš„æ—¶é—´æˆ³å¯ä»¥æ”¯æŒè¯¥ç®—æ³•ä½¿ç”¨åˆ°2082å¹´ï¼Œ10bitçš„å·¥ä½œæœºå™¨idå¯ä»¥æ”¯æŒ1023å°æœºå™¨ï¼Œåºåˆ—å·æ”¯æŒ1æ¯«ç§’äº§ç”Ÿ4095ä¸ªè‡ªå¢åºåˆ—idã€‚\nå…·ä½“å¯ä»¥æŸ¥çœ‹ï¼šgithub.com&#x2F;twitter-arcâ€¦** ï¼ˆä½†æ˜¯æœ€è¿‘ä¸€æ¬¡çš„æäº¤æ˜¯6å¹´å‰ï¼Œæ˜¾ç¤ºå·²ç»åœæ­¢äº†å¯¹åˆå§‹ç‰ˆsnowflakeçš„æ”¯æŒï¼‰**æºç å¦‚ä¸‹ï¼š\npackage com.yjd.comm.util;/**\n* Created by pc on 2017/8/16 0016.\n*/\n\n/**\n* Twitter_Snowflake&lt;br>\n* SnowFlakeçš„ç»“æ„å¦‚ä¸‹(æ¯éƒ¨åˆ†ç”¨-åˆ†å¼€):&lt;br>\n* 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 &lt;br>\n* 1ä½æ ‡è¯†ï¼Œç”±äºlongåŸºæœ¬ç±»å‹åœ¨Javaä¸­æ˜¯å¸¦ç¬¦å·çš„ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œæ­£æ•°æ˜¯0ï¼Œè´Ÿæ•°æ˜¯1ï¼Œæ‰€ä»¥idä¸€èˆ¬æ˜¯æ­£æ•°ï¼Œæœ€é«˜ä½æ˜¯0&lt;br>\n* 41ä½æ—¶é—´æˆª(æ¯«ç§’çº§)ï¼Œæ³¨æ„ï¼Œ41ä½æ—¶é—´æˆªä¸æ˜¯å­˜å‚¨å½“å‰æ—¶é—´çš„æ—¶é—´æˆªï¼Œè€Œæ˜¯å­˜å‚¨æ—¶é—´æˆªçš„å·®å€¼ï¼ˆå½“å‰æ—¶é—´æˆª - å¼€å§‹æ—¶é—´æˆª)\n* å¾—åˆ°çš„å€¼ï¼‰ï¼Œè¿™é‡Œçš„çš„å¼€å§‹æ—¶é—´æˆªï¼Œä¸€èˆ¬æ˜¯æˆ‘ä»¬çš„idç”Ÿæˆå™¨å¼€å§‹ä½¿ç”¨çš„æ—¶é—´ï¼Œç”±æˆ‘ä»¬ç¨‹åºæ¥æŒ‡å®šçš„ï¼ˆå¦‚ä¸‹ä¸‹é¢ç¨‹åºIdWorkerç±»çš„startTimeå±æ€§ï¼‰ã€‚41ä½çš„æ—¶é—´æˆªï¼Œå¯ä»¥ä½¿ç”¨69å¹´ï¼Œå¹´T = (1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69&lt;br>\n* 10ä½çš„æ•°æ®æœºå™¨ä½ï¼Œå¯ä»¥éƒ¨ç½²åœ¨1024ä¸ªèŠ‚ç‚¹ï¼ŒåŒ…æ‹¬5ä½datacenterIdå’Œ5ä½workerId&lt;br>\n* 12ä½åºåˆ—ï¼Œæ¯«ç§’å†…çš„è®¡æ•°ï¼Œ12ä½çš„è®¡æ•°é¡ºåºå·æ”¯æŒæ¯ä¸ªèŠ‚ç‚¹æ¯æ¯«ç§’(åŒä¸€æœºå™¨ï¼ŒåŒä¸€æ—¶é—´æˆª)äº§ç”Ÿ4096ä¸ªIDåºå·&lt;br>\n* åŠ èµ·æ¥åˆšå¥½64ä½ï¼Œä¸ºä¸€ä¸ªLongå‹ã€‚&lt;br>\n* SnowFlakeçš„ä¼˜ç‚¹æ˜¯ï¼Œæ•´ä½“ä¸ŠæŒ‰ç…§æ—¶é—´è‡ªå¢æ’åºï¼Œå¹¶ä¸”æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå†…ä¸ä¼šäº§ç”ŸIDç¢°æ’(ç”±æ•°æ®ä¸­å¿ƒIDå’Œæœºå™¨IDä½œåŒºåˆ†)ï¼Œå¹¶ä¸”æ•ˆç‡è¾ƒé«˜ï¼Œç»æµ‹è¯•ï¼ŒSnowFlakeæ¯ç§’èƒ½å¤Ÿäº§ç”Ÿ26ä¸‡IDå·¦å³ã€‚\n*/\npublic class SnowflakeIdWorker &#123;\n    \n    // ==============================Fields===========================================\n    /**\n    * å¼€å§‹æ—¶é—´æˆª (2015-01-01)\n    */\n    private final long twepoch = 1420041600000L;\n    \n    /**\n    * æœºå™¨idæ‰€å çš„ä½æ•°\n    */\n    private final long workerIdBits = 5L;\n    \n    /**\n    * æ•°æ®æ ‡è¯†idæ‰€å çš„ä½æ•°\n    */\n    private final long datacenterIdBits = 5L;\n    \n    /**\n    * æ”¯æŒçš„æœ€å¤§æœºå™¨idï¼Œç»“æœæ˜¯31 (è¿™ä¸ªç§»ä½ç®—æ³•å¯ä»¥å¾ˆå¿«çš„è®¡ç®—å‡ºå‡ ä½äºŒè¿›åˆ¶æ•°æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§åè¿›åˆ¶æ•°)\n    */\n    private final long maxWorkerId = -1L ^ (-1L &lt;&lt; workerIdBits);\n    \n    /**\n    * æ”¯æŒçš„æœ€å¤§æ•°æ®æ ‡è¯†idï¼Œç»“æœæ˜¯31\n    */\n    private final long maxDatacenterId = -1L ^ (-1L &lt;&lt; datacenterIdBits);\n    \n    /**\n    * åºåˆ—åœ¨idä¸­å çš„ä½æ•°\n    */\n    private final long sequenceBits = 12L;\n    \n    /**\n    * æœºå™¨IDå‘å·¦ç§»12ä½\n    */\n    private final long workerIdShift = sequenceBits;\n    \n    /**\n    * æ•°æ®æ ‡è¯†idå‘å·¦ç§»17ä½(12+5)\n    */\n    private final long datacenterIdShift = sequenceBits + workerIdBits;\n    \n    /**\n    * æ—¶é—´æˆªå‘å·¦ç§»22ä½(5+5+12)\n    */\n    private final long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;\n    \n    /**\n    * ç”Ÿæˆåºåˆ—çš„æ©ç ï¼Œè¿™é‡Œä¸º4095 (0b111111111111=0xfff=4095)\n    */\n    private final long sequenceMask = -1L ^ (-1L &lt;&lt; sequenceBits);\n    \n    /**\n    * å·¥ä½œæœºå™¨ID(0~31)\n    */\n    private long workerId;\n    \n    /**\n    * æ•°æ®ä¸­å¿ƒID(0~31)\n    */\n    private long datacenterId;\n    \n    /**\n    * æ¯«ç§’å†…åºåˆ—(0~4095)\n    */\n    private long sequence = 0L;\n    \n    /**\n    * ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª\n    */\n    private long lastTimestamp = -1L;\n    \n    //==============================Constructors=====================================\n    \n    /**\n    * æ„é€ å‡½æ•°\n    *\n    * @param workerId     å·¥ä½œID (0~31)\n    * @param datacenterId æ•°æ®ä¸­å¿ƒID (0~31)\n    */\n    public SnowflakeIdWorker(long workerId, long datacenterId) &#123;\n        if (workerId > maxWorkerId || workerId &lt; 0) &#123;\n            throw new IllegalArgumentException(String.format(\"worker Id can't be greater than %d or less than 0\", maxWorkerId));\n        &#125;\n        if (datacenterId > maxDatacenterId || datacenterId &lt; 0) &#123;\n            throw new IllegalArgumentException(String.format(\"datacenter Id can't be greater than %d or less than 0\", maxDatacenterId));\n        &#125;\n        this.workerId = workerId;\n        this.datacenterId = datacenterId;\n    &#125;\n    \n    // ==============================Methods==========================================\n    \n    /**\n    * è·å¾—ä¸‹ä¸€ä¸ªID (è¯¥æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„)\n    *\n    * @return SnowflakeId\n    */\n    public synchronized long nextId() &#123;\n        long timestamp = timeGen();\n        \n        //å¦‚æœå½“å‰æ—¶é—´å°äºä¸Šä¸€æ¬¡IDç”Ÿæˆçš„æ—¶é—´æˆ³ï¼Œè¯´æ˜ç³»ç»Ÿæ—¶é’Ÿå›é€€è¿‡è¿™ä¸ªæ—¶å€™åº”å½“æŠ›å‡ºå¼‚å¸¸\n        if (timestamp &lt; lastTimestamp) &#123;\n            throw new RuntimeException(\n                String.format(\"Clock moved backwards.  Refusing to generate id for %d milliseconds\", lastTimestamp - timestamp));\n        &#125;\n        \n        //å¦‚æœæ˜¯åŒä¸€æ—¶é—´ç”Ÿæˆçš„ï¼Œåˆ™è¿›è¡Œæ¯«ç§’å†…åºåˆ—\n        if (lastTimestamp == timestamp) &#123;\n            sequence = (sequence + 1) &amp; sequenceMask;\n            //æ¯«ç§’å†…åºåˆ—æº¢å‡º\n            if (sequence == 0) &#123;\n                //é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’,è·å¾—æ–°çš„æ—¶é—´æˆ³\n                timestamp = tilNextMillis(lastTimestamp);\n            &#125;\n        &#125;\n        //æ—¶é—´æˆ³æ”¹å˜ï¼Œæ¯«ç§’å†…åºåˆ—é‡ç½®\n        else &#123;\n            sequence = 0L;\n        &#125;\n        \n        //ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª\n        lastTimestamp = timestamp;\n        \n        //ç§»ä½å¹¶é€šè¿‡æˆ–è¿ç®—æ‹¼åˆ°ä¸€èµ·ç»„æˆ64ä½çš„ID\n        return ((timestamp - twepoch) &lt;&lt; timestampLeftShift) //\n            | (datacenterId &lt;&lt; datacenterIdShift) //\n            | (workerId &lt;&lt; workerIdShift) //\n            | sequence;\n    &#125;\n    \n    /**\n    * é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’ï¼Œç›´åˆ°è·å¾—æ–°çš„æ—¶é—´æˆ³\n    *\n    * @param lastTimestamp ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª\n    * @return å½“å‰æ—¶é—´æˆ³\n    */\n    protected long tilNextMillis(long lastTimestamp) &#123;\n        long timestamp = timeGen();\n        while (timestamp &lt;= lastTimestamp) &#123;\n            timestamp = timeGen();\n        &#125;\n        return timestamp;\n    &#125;\n    \n    /**\n    * è¿”å›ä»¥æ¯«ç§’ä¸ºå•ä½çš„å½“å‰æ—¶é—´\n    *\n    * @return å½“å‰æ—¶é—´(æ¯«ç§’)\n    */\n    protected long timeGen() &#123;\n        return System.currentTimeMillis();\n    &#125;\n    \n    //==============================Test=============================================\n    \n    /**\n    * æµ‹è¯•\n    */\n    public static void main(String[] args) &#123;\n        SnowflakeIdWorker idWorker = new SnowflakeIdWorker(1, 1);\n        long startime = System.currentTimeMillis();\n        for (int i = 0; i &lt; 4000000; i++) &#123;\n            long id = idWorker.nextId();\n            //            System.out.println(Long.toBinaryString(id));\n            //            System.out.println(id);\n        &#125;\n        System.out.println(System.currentTimeMillis() - startime);\n    &#125;\n&#125;\n\n\nä¼˜ç‚¹ï¼š1ã€æ¯«ç§’æ•°åœ¨é«˜ä½ï¼Œè‡ªå¢åºåˆ—åœ¨ä½ä½ï¼Œæ•´ä¸ªIDéƒ½æ˜¯è¶‹åŠ¿é€’å¢çš„ã€‚ 2ã€ ä¸ä¾èµ–æ•°æ®åº“ç­‰ç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼Œä»¥æœåŠ¡çš„æ–¹å¼éƒ¨ç½²ï¼Œç¨³å®šæ€§æ›´é«˜ï¼Œç”ŸæˆIDçš„æ€§èƒ½ä¹Ÿæ˜¯éå¸¸é«˜çš„ã€‚ 3ã€å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹æ€§åˆ†é…bitä½ï¼Œéå¸¸çµæ´»ã€‚ç¼ºç‚¹ï¼šå¼ºä¾èµ–æœºå™¨æ—¶é’Ÿï¼Œå¦‚æœæœºå™¨ä¸Šæ—¶é’Ÿå›æ‹¨ï¼Œä¼šå¯¼è‡´å‘å·é‡å¤æˆ–è€…æœåŠ¡ä¼šå¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚ç»“è®ºï¼šç”¨è‡ªå»ºçš„idç”Ÿæˆå™¨åšä¸»é”®é€‚ç”¨äºå¤§è§„æ¨¡åˆ†å¸ƒå¼æ¶æ„\n","slug":"MySQL/MySQLä¸»é”®è®¾è®¡ç›˜ç‚¹","date":"2022-02-23T05:32:16.000Z","categories_index":"MySQL","tags_index":"MySQL","author_index":"Anchor"},{"id":"6dd356025f124f190d32c47865445ac7","title":"MySQL å¸¸ç”¨å‡½æ•°&æ•°æ®ç±»å‹","content":"MySQL å¸¸ç”¨å‡½æ•°æ±‡æ€»å­—ç¬¦ä¸²å‡½æ•°\n\n\nå‡½æ•°\nåŠŸèƒ½\n\n\n\nCONCAT(s1,s2,â€¦â€¦)\nå­—ç¬¦ä¸²è¿æ¥\n\n\nINSERT(str,x,y,instr)\nå°†æŒ‡å®šå¼€å§‹æ ‡è®°åˆ°ç»“æŸçš„å­—ç¬¦ä¸²æ›¿æ¢ä¸ºæŒ‡å®šå­—ç¬¦ä¸²\n\n\nLOWER(str)\nå°†å­—ç¬¦ä¸²æ‰€æœ‰å­—ç¬¦è½¬ä¸ºå°å†™\n\n\nUPPER(str)\nå°†å­—ç¬¦ä¸²æ‰€æœ‰å­—ç¬¦ä¸²è½¬ä¸ºå¤§å†™\n\n\nLEFT(str,x)\nè¿”å›å­—ç¬¦ä¸² str æœ€å·¦è¾¹çš„ x ä¸ªå­—ç¬¦\n\n\nRIGHT(str,x)\nè¿”å›å­—ç¬¦ä¸² str æœ€å³è¾¹çš„ x ä¸ªå­—ç¬¦\n\n\nLPAD(str,n,pad)\nåœ¨ str æœ€å·¦è¾¹å¡«å…… n ä¸ª pad\n\n\nRPAD(str,n,pad)\nåœ¨ str æœ€å³è¾¹å¡«å…… n ä¸ª pad\n\n\nLTRIM(str)\nå»æ‰å­—ç¬¦ä¸² str å·¦ä¾§çš„ç©ºæ ¼\n\n\nRTRIM(str)\nå»æ‰å­—ç¬¦ä¸² str å³ä¾§çš„ç©ºæ ¼\n\n\nREPEAT(str,x)\nè¿”å› str é‡å¤ x æ¬¡çš„ç»“æœ\n\n\nSTRCMP(s1,s2)\næ¯”è¾ƒå­—ç¬¦ä¸² s1 å’Œ s2\n\n\nREPLACE(str,a,b)\nç”¨å­—ç¬¦ä¸² b æ›¿æ¢å­—ç¬¦ä¸² str ä¸­æ‰€æœ‰å‡ºç°çš„å­—ç¬¦ä¸² a\n\n\nTRIM(str)\nå»æ‰å­—ç¬¦ä¸²è¡Œå°¾å’Œè¡Œå¤´çš„ç©ºæ ¼\n\n\nSUBSTRING(str,x,y)\nè¿”å›ä»å­—ç¬¦ä¸² str x ä½ç½®èµ· y ä¸ªå­—ç¬¦é•¿åº¦çš„å­—ä¸²\n\n\næ•°å­¦å‡½æ•°\n\n\nå‡½æ•°\nåŠŸèƒ½\n\n\n\nABS(x)\nè¿”å› x çš„ç»å¯¹å€¼\n\n\nCEIL(x)\nè¿”å›å¤§äº x çš„æœ€å°æ•´æ•°å€¼\n\n\nFLOOR(x)\nè¿”å›å°äº x çš„æœ€å¤§æ•´æ•°å€¼\n\n\nMOD(x,y)\nè¿”å› x&#x2F;y çš„æ¨¡\n\n\nRAND()\nè¿”å› 0ï½1 å†…çš„éšæœºå€¼\n\n\nROUND(x,y)\nè¿”å›å‚æ•° x çš„å››èˆäº”å…¥çš„æœ‰ y ä½å°æ•°çš„å€¼\n\n\nTRUNCATE(x,y)\nè¿”å›æ•°å­— x æˆªæ–­ä½ y ä½å°æ•°çš„ç»“æœ\n\n\næ—¥æœŸå’Œæ—¶é—´å‡½æ•°\n\n\nå‡½æ•°\nåŠŸèƒ½\n\n\n\nCURDATE()\nè¿”å›å½“å‰æ—¥æœŸ\n\n\nCURTIME()\nè¿”å›å½“å‰æ—¶é—´\n\n\nNOW()\nè¿”å›å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´\n\n\nUNIX_TIMESTAMP(date)\nè¿”å›æ—¥æœŸ date çš„ UNIX æ—¶é—´æˆ³\n\n\nFROM_UNIXTIME\nè¿”å› UNIX æ—¶é—´æˆ³çš„æ—¥æœŸå€¼\n\n\nWEEK(date)\nè¿”å›æ—¥æœŸ date ä¸ºä¸€å¹´ä¸­çš„ç¬¬å‡ å‘¨\n\n\nYEAR(date)\nè¿”å›æ—¥æœŸ date çš„å¹´ä»½\n\n\nHOUR(time)\nè¿”å› time çš„å°æ—¶å€¼\n\n\nMINUTE(time)\nè¿”å› time çš„åˆ†é’Ÿå€¼\n\n\nMONTHNAME(date)\nè¿”å› date çš„æœˆä»½å\n\n\nDATE_FORMAT(date,fmt)\nè¿”å›æŒ‰å­—ç¬¦ä¸² fmt æ ¼å¼æ—¥æœŸ date å€¼\n\n\nDATE_ADD(date,interval expr type)\nè¿”å›ä¸€ä¸ªæ—¥æœŸæˆ–æ—¶é—´å€¼åŠ ä¸Šä¸€ä¸ªæ—¶é—´é—´éš”çš„æ—¶é—´å€¼\n\n\nDATEDIFF(expr,expr2)\nè¿”å›èµ·å§‹æ—¶é—´ expr å’Œç»“æŸæ—¶é—´ expr2 ä¹‹é—´çš„å¤©æ•°\n\n\næµç¨‹å‡½æ•°\n\n\nå‡½æ•°\nåŠŸèƒ½\n\n\n\nIF(value,t f)\nå¦‚æœ value æ˜¯çœŸï¼Œè¿”å› tï¼›å¦åˆ™è¿”å› f\n\n\nIFNULL(value1,value2)\nå¦‚æœ value1 ä¸ä¸ºç©ºï¼Œè¿”å› value1ï¼Œå¦åˆ™è¿”å› value2\n\n\nCASE WHEN [value1] THEN[result1]â€¦ELSE[default]END\nå¦‚æœ value1 æ˜¯çœŸï¼Œè¿”å› result1ï¼Œå¦åˆ™è¿”å› result\n\n\nCASE[expr] WHEN [value1]THEN[result1]â€¦ELSE[default]END\nå¦‚æœ expr ç­‰äº value1ï¼Œè¿”å› result1ï¼Œå¦åˆ™è¿”å› default\n\n\nå…¶ä»–å¸¸ç”¨å‡½æ•°\n\n\nå‡½æ•°\nåŠŸèƒ½\n\n\n\nDATEBASE()\nè¿”å›å½“å‰æ•°æ®åº“å\n\n\nVERSION()\nè¿”å›å½“å‰æ•°æ®åº“ç‰ˆæœ¬\n\n\nUSER()\nè¿”å›å½“å‰ç™»å½•ç”¨æˆ·å\n\n\nINET_ATON(ip)\nè¿”å› ip åœ°å€çš„æ•°å­—è¡¨ç¤º\n\n\nINET_NTOA(num)\nè¿”å›æ•°å­—ä»£è¡¨çš„ ip åœ°å€\n\n\nPASSWORD(str)\nè¿”å›å­—ç¬¦ä¸² str çš„åŠ å¯†ç‰ˆæœ¬\n\n\nMD5()\nè¿”å›å­—ç¬¦ä¸² str çš„ md5 å€¼\n\n\nMySQL æ•°æ®ç±»å‹ä¸²æ•°æ®ç±»å‹\n\n\næ•°æ®ç±»å‹\nè¯´æ˜\n\n\n\nCHAR\n1ï½255 ä¸ªå­—ç¬¦çš„å®šé•¿ä¸²ã€‚å®ƒçš„é•¿åº¦å¿…é¡»åœ¨åˆ›å»ºæ—¶æŒ‡å®šï¼Œå¦åˆ™ MySQL å‡å®šä¸º CHAR(1)\n\n\nENUM\næ¥å—æœ€å¤š 64 K ä¸ªä¸²ç»„æˆçš„ä¸€ä¸ªé¢„å®šä¹‰é›†åˆçš„æŸä¸ªä¸²\n\n\nLONGTEXT\nä¸ TEXT ç›¸åŒï¼Œä½†æœ€å¤§é•¿åº¦ä¸º 4GB\n\n\nMEDIUMTEXT\nä¸ TEXT ç›¸åŒï¼Œä½†æœ€å¤§é•¿åº¦ä¸º 16K\n\n\nSET\næ¥å—æœ€å¤š 64 ä¸ªä¸²ç»„æˆçš„ä¸€ä¸ªé¢„å®šä¹‰é›†åˆçš„é›¶ä¸ªæˆ–å¤šä¸ªä¸²\n\n\nTEXT\næœ€å¤§é•¿åº¦ä¸º 64K çš„å˜é•¿æ–‡æœ¬\n\n\nTINYTEXT\nä¸ TEXT ç›¸åŒï¼Œä½†æœ€å¤§é•¿åº¦ä¸º 255 å­—èŠ‚\n\n\nVARCHAR\né•¿åº¦å¯å˜ï¼Œæœ€å¤šä¸è¶…è¿‡ 255 å­—èŠ‚ã€‚å¦‚æœåœ¨åˆ›å»ºæ—¶æŒ‡å®šä¸º VARCHAR(n)ï¼Œåˆ™å¯å­˜å‚¨ 0 åˆ° n ä¸ªå­—ç¬¦çš„å˜é•¿ä¸²ï¼ˆå…¶ä¸­ nâ‰¤255ï¼‰\n\n\næ•°å€¼æ•°æ®ç±»å‹\n\n\næ•°æ®ç±»å‹\nè¯´æ˜\n\n\n\nBIT\nä½å­—æ®µï¼Œ1ï½64 ä½ã€‚ï¼ˆåœ¨ MySQL 5 ä¹‹å‰ï¼ŒBIT åœ¨åŠŸèƒ½ä¸Šç­‰ä»·äº TINYINT\n\n\nBIGINT\næ•´æ•°å€¼ï¼Œæ”¯æŒï€­9223372036854775808ï½9223372036854775807ï¼ˆå¦‚æœæ˜¯ UNSIGNEDï¼Œä¸º 0ï½18446744073709551615ï¼‰çš„æ•°\n\n\nBOOLEANï¼ˆæˆ– BOOLï¼‰\nå¸ƒå°”æ ‡å¿—ï¼Œæˆ–è€…ä¸º 0 æˆ–è€…ä¸º 1ï¼Œä¸»è¦ç”¨äºå¼€&#x2F;å…³ï¼ˆon&#x2F;offï¼‰æ ‡å¿—\n\n\nDECIMALï¼ˆæˆ– DECï¼‰\nç²¾åº¦å¯å˜çš„æµ®ç‚¹å€¼\n\n\nDOUBLE\nåŒç²¾åº¦æµ®ç‚¹å€¼\n\n\nFLOAT\nå•ç²¾åº¦æµ®ç‚¹å€¼\n\n\nINTï¼ˆæˆ– INTEGERï¼‰\næ•´æ•°å€¼ï¼Œæ”¯æŒï€­2147483648ï½2147483647ï¼ˆå¦‚æœæ˜¯ UNSIGNEDï¼Œä¸º 0ï½4294967295ï¼‰çš„æ•°\n\n\nMEDIUMINT\næ•´æ•°å€¼ï¼Œæ”¯æŒï€­8388608ï½8388607ï¼ˆå¦‚æœæ˜¯ UNSIGNEDï¼Œä¸º 0ï½16777215ï¼‰çš„æ•°\n\n\nREAL\n4 å­—èŠ‚çš„æµ®ç‚¹å€¼\n\n\nSMALLINT\næ•´æ•°å€¼ï¼Œæ”¯æŒï€­32768ï½32767ï¼ˆå¦‚æœæ˜¯ UNSIGNEDï¼Œä¸º 0ï½65535ï¼‰çš„æ•°\n\n\nTINYINT\næ•´æ•°å€¼ï¼Œæ”¯æŒï€­128ï½127ï¼ˆå¦‚æœä¸º UNSIGNEDï¼Œä¸º 0ï½255ï¼‰çš„æ•°\n\n\næ—¥æœŸå’Œæ—¶é—´æ•°æ®ç±»å‹\n\n\næ•°æ®ç±»å‹\nè¯´æ˜\n\n\n\nDATE\nè¡¨ç¤º 1000-01-01ï½9999-12-31 çš„æ—¥æœŸï¼Œæ ¼å¼ä¸º YYYY-MM-DD\n\n\nDATETIME\nDATE å’Œ TIME çš„ç»„åˆ\n\n\nTIMESTAMP\nåŠŸèƒ½å’Œ DATETIME ç›¸åŒï¼ˆä½†èŒƒå›´è¾ƒå°ï¼‰\n\n\nTIME\næ ¼å¼ä¸º HH:MM:SS\n\n\nYEAR\nç”¨ 2 ä½æ•°å­—è¡¨ç¤ºï¼ŒèŒƒå›´æ˜¯ 70ï¼ˆ1970 å¹´ï¼‰ï½69ï¼ˆ2069 å¹´ï¼‰ï¼Œç”¨ 4 ä½æ•°å­—è¡¨ç¤ºï¼ŒèŒƒå›´æ˜¯ 1901 å¹´ï½2155 å¹´\n\n\näºŒè¿›åˆ¶æ•°æ®ç±»å‹\n\n\næ•°æ®ç±»å‹\nè¯´æ˜\n\n\n\nBLOB\nBlob æœ€å¤§é•¿åº¦ä¸º 64KB\n\n\nMEDIUMBLOB\nBlob æœ€å¤§é•¿åº¦ä¸º 16MB\n\n\nLONGBLOB\nBlob æœ€å¤§é•¿åº¦ä¸º 4GB\n\n\nTINYBLOB\nBlob æœ€å¤§é•¿åº¦ä¸º 255 å­—èŠ‚\n\n\n","slug":"MySQL/MySQLå¸¸ç”¨å‡½æ•°æ±‡æ€»","date":"2022-02-23T05:32:16.000Z","categories_index":"MySQL","tags_index":"MySQL","author_index":"Anchor"},{"id":"87cebc6d905dece24636202906841487","title":"MySQL æ•°æ®åº“è®¾è®¡è§„èŒƒ","content":"MySQL æ•°æ®åº“è®¾è®¡è§„èŒƒ1. è§„èŒƒèƒŒæ™¯ä¸ç›®çš„MySQL æ•°æ®åº“ä¸ Oracleã€ SQL Server ç­‰æ•°æ®åº“ç›¸æ¯”ï¼Œæœ‰å…¶å†…æ ¸ä¸Šçš„ä¼˜åŠ¿ä¸åŠ£åŠ¿ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨ MySQL æ•°æ®åº“çš„æ—¶å€™éœ€è¦éµå¾ªä¸€å®šè§„èŒƒï¼Œæ‰¬é•¿é¿çŸ­ã€‚æœ¬è§„èŒƒæ—¨åœ¨å¸®åŠ©æˆ–æŒ‡å¯¼ RDã€QAã€OP ç­‰æŠ€æœ¯äººå‘˜åšå‡ºé€‚åˆçº¿ä¸Šä¸šåŠ¡çš„æ•°æ®åº“è®¾è®¡ã€‚åœ¨æ•°æ®åº“å˜æ›´å’Œå¤„ç†æµç¨‹ã€æ•°æ®åº“è¡¨è®¾è®¡ã€SQL ç¼–å†™ç­‰æ–¹é¢äºˆä»¥è§„èŒƒï¼Œä»è€Œä¸ºå…¬å¸ä¸šåŠ¡ç³»ç»Ÿç¨³å®šã€å¥åº·åœ°è¿è¡Œæä¾›ä¿éšœã€‚\n2. è®¾è®¡è§„èŒƒ2.1 æ•°æ®åº“è®¾è®¡ä»¥ä¸‹æ‰€æœ‰è§„èŒƒä¼šæŒ‰ç…§ã€é«˜å±ã€‘ã€ã€å¼ºåˆ¶ã€‘ã€ã€å»ºè®®ã€‘ä¸‰ä¸ªçº§åˆ«è¿›è¡Œæ ‡æ³¨ï¼Œéµå®ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ã€‚\nå¯¹äºä¸æ»¡è¶³ã€é«˜å±ã€‘å’Œã€å¼ºåˆ¶ã€‘ä¸¤ä¸ªçº§åˆ«çš„è®¾è®¡ï¼ŒDBA ä¼šå¼ºåˆ¶æ‰“å›è¦æ±‚ä¿®æ”¹ã€‚\n2.1.1 ä¸€èˆ¬å‘½åè§„åˆ™\nã€å¼ºåˆ¶ã€‘ä½¿ç”¨å°å†™ï¼Œæœ‰åŠ©äºæé«˜æ‰“å­—é€Ÿåº¦ï¼Œé¿å…å› å¤§å°å†™æ•æ„Ÿè€Œå¯¼è‡´çš„é”™è¯¯ã€‚\nã€å¼ºåˆ¶ã€‘æ²¡æœ‰ç©ºæ ¼ï¼Œä½¿ç”¨ä¸‹åˆ’çº¿ä»£æ›¿ã€‚\nã€å¼ºåˆ¶ã€‘åç§°ä¸­æ²¡æœ‰æ•°å­—ï¼Œåªæœ‰è‹±æ–‡å­—æ¯ã€‚\nã€å¼ºåˆ¶ã€‘æœ‰æ•ˆçš„å¯ç†è§£çš„åç§°ã€‚\nã€å¼ºåˆ¶ã€‘åç§°åº”è¯¥æ˜¯è‡ªæˆ‘è§£é‡Šçš„ã€‚\nã€å¼ºåˆ¶ã€‘åç§°ä¸åº”è¶…è¿‡ 32 ä¸ªå­—ç¬¦ã€‚\nã€å¼ºåˆ¶ã€‘é¿å…ä½¿ç”¨å‰ç¼€ã€‚\n\n2.1.2 åº“\nã€å¼ºåˆ¶ã€‘éµå®ˆä»¥ä¸Šå…¨éƒ¨ä¸€èˆ¬å‘½åè§„åˆ™ã€‚ \nã€å¼ºåˆ¶ã€‘ä½¿ç”¨å•æ•°ã€‚ \nã€å¼ºåˆ¶ã€‘åº“çš„åç§°æ ¼å¼ï¼šä¸šåŠ¡ç³»ç»Ÿåç§°_å­ç³»ç»Ÿåã€‚ \nã€å¼ºåˆ¶ã€‘ä¸€èˆ¬åˆ†åº“åç§°å‘½åæ ¼å¼æ˜¯åº“é€šé…å_ç¼–å·ï¼Œç¼–å·ä» 0 å¼€å§‹é€’å¢ï¼Œæ¯”å¦‚ northwind_001ï¼Œä»¥æ—¶é—´è¿›è¡Œåˆ†åº“çš„åç§°æ ¼å¼æ˜¯åº“é€šé…å_æ—¶é—´ã€‚ \nã€å¼ºåˆ¶ã€‘åˆ›å»ºæ•°æ®åº“æ—¶å¿…é¡»æ˜¾å¼æŒ‡å®šå­—ç¬¦é›†ï¼Œå¹¶ä¸”å­—ç¬¦é›†åªèƒ½æ˜¯ utf8 æˆ–è€… utf8mb4ã€‚åˆ›å»ºæ•°æ®åº“ SQL ä¸¾ä¾‹ï¼š  create database db_name default character set utf8;\n\n2.1.3 è¡¨\nã€å¼ºåˆ¶ã€‘éµå®ˆä»¥ä¸Šå…¨éƒ¨ä¸€èˆ¬å‘½åè§„åˆ™ã€‚\nã€å¼ºåˆ¶ã€‘ä½¿ç”¨å•æ•°ã€‚\nã€å¼ºåˆ¶ã€‘ç›¸å…³æ¨¡å—çš„è¡¨åä¸è¡¨åä¹‹é—´å°½é‡ä½“ç° join çš„å…³ç³»ï¼Œå¦‚ user è¡¨å’Œ user_login è¡¨ã€‚\nã€å¼ºåˆ¶ã€‘åˆ›å»ºè¡¨æ—¶å¿…é¡»æ˜¾å¼æŒ‡å®šå­—ç¬¦é›†ä¸º utf8 æˆ– utf8mb4ã€‚\nã€å¼ºåˆ¶ã€‘åˆ›å»ºè¡¨æ—¶å¿…é¡»æ˜¾å¼æŒ‡å®šè¡¨å­˜å‚¨å¼•æ“ç±»å‹ï¼Œå¦‚æ— ç‰¹æ®Šéœ€æ±‚ï¼Œä¸€å¾‹ä¸º InnoDBã€‚å½“éœ€è¦ä½¿ç”¨é™¤ InnoDB&#x2F;MyISAM&#x2F;Memory ä»¥å¤–çš„å­˜å‚¨å¼•æ“æ—¶ï¼Œå¿…é¡»é€šè¿‡ DBA å®¡æ ¸æ‰èƒ½åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚å› ä¸º InnoDB è¡¨æ”¯æŒäº‹åŠ¡ã€è¡Œé”ã€å®•æœºæ¢å¤ã€MVCC ç­‰å…³ç³»å‹æ•°æ®åº“é‡è¦ç‰¹æ€§ï¼Œä¸ºä¸šç•Œä½¿ç”¨æœ€å¤šçš„ MySQL å­˜å‚¨å¼•æ“ã€‚è€Œè¿™æ˜¯å…¶å®ƒå¤§å¤šæ•°å­˜å‚¨å¼•æ“ä¸å…·å¤‡çš„ï¼Œå› æ­¤é¦–æ¨ InnoDBã€‚\nã€å¼ºåˆ¶ã€‘å»ºè¡¨å¿…é¡»æœ‰ commentã€‚\nã€å¼ºåˆ¶ã€‘å…³äºä¸»é”®ï¼š(1) å‘½åä¸º idï¼Œç±»å‹ä¸º int æˆ– bigintï¼Œä¸”ä¸º auto_incrementï¼›(2) æ ‡è¯†è¡¨é‡Œæ¯ä¸€è¡Œä¸»ä½“çš„å­—æ®µä¸è¦è®¾ä¸ºä¸»é”®ï¼Œå»ºè®®è®¾ä¸ºå…¶å®ƒå­—æ®µå¦‚ user_idï¼Œorder_idç­‰ï¼Œå¹¶å»ºç«‹ unique key ç´¢å¼•ã€‚å› ä¸ºå¦‚æœè®¾ä¸ºä¸»é”®ä¸”ä¸»é”®å€¼ä¸ºéšæœºæ’å…¥ï¼Œåˆ™ä¼šå¯¼è‡´ InnoDB å†…éƒ¨ page åˆ†è£‚å’Œå¤§é‡éšæœº I&#x2F;Oï¼Œæ€§èƒ½ä¸‹é™ã€‚\nã€å»ºè®®ã€‘æ ¸å¿ƒè¡¨ï¼ˆå¦‚ç”¨æˆ·è¡¨ï¼Œé‡‘é’±ç›¸å…³çš„è¡¨ï¼‰å¿…é¡»æœ‰è¡Œæ•°æ®çš„åˆ›å»ºæ—¶é—´å­—æ®µ create_time å’Œæœ€åæ›´æ–°æ—¶é—´å­—æ®µ update_timeï¼Œä¾¿äºæ’æŸ¥é—®é¢˜ã€‚\nã€å»ºè®®ã€‘è¡¨ä¸­æ‰€æœ‰å­—æ®µå¿…é¡»éƒ½æ˜¯ NOT NULL å±æ€§ï¼Œä¸šåŠ¡å¯ä»¥æ ¹æ®éœ€è¦å®šä¹‰ DEFAULT å€¼ã€‚å› ä¸ºä½¿ç”¨ NULL å€¼ä¼šå­˜åœ¨æ¯ä¸€è¡Œéƒ½ä¼šå ç”¨é¢å¤–å­˜å‚¨ç©ºé—´ã€æ•°æ®è¿ç§»å®¹æ˜“å‡ºé”™ã€èšåˆå‡½æ•°è®¡ç®—ç»“æœåå·®ç­‰é—®é¢˜ã€‚\nã€å»ºè®®ã€‘å»ºè®®å¯¹è¡¨é‡Œçš„ blobã€text ç­‰å¤§å­—æ®µï¼Œå‚ç›´æ‹†åˆ†åˆ°å…¶å®ƒè¡¨é‡Œï¼Œä»…åœ¨éœ€è¦è¯»è¿™äº›å¯¹è±¡çš„æ—¶å€™æ‰å» selectã€‚\nã€å»ºè®®ã€‘åèŒƒå¼è®¾è®¡ï¼šæŠŠç»å¸¸éœ€è¦ join æŸ¥è¯¢çš„å­—æ®µï¼Œåœ¨å…¶å®ƒè¡¨é‡Œå†—ä½™ä¸€ä»½ã€‚å¦‚ username å±æ€§åœ¨ user_accountï¼Œuser_login_log ç­‰è¡¨é‡Œå†—ä½™ä¸€ä»½ï¼Œå‡å°‘ join æŸ¥è¯¢ã€‚\nã€å¼ºåˆ¶ã€‘ä¸­é—´è¡¨ç”¨äºä¿ç•™ä¸­é—´ç»“æœé›†ï¼Œåç§°å¿…é¡»ä»¥ tmp_ å¼€å¤´ã€‚å¤‡ä»½è¡¨ç”¨äºå¤‡ä»½æˆ–æŠ“å–æºè¡¨å¿«ç…§ï¼Œåç§°å¿…é¡»ä»¥ bak_ å¼€å¤´ã€‚ä¸­é—´è¡¨å’Œå¤‡ä»½è¡¨å®šæœŸæ¸…ç†ã€‚\nã€å¼ºåˆ¶ã€‘å¯¹äºè¶…è¿‡ 100W è¡Œçš„å¤§è¡¨è¿›è¡Œ alter tableï¼Œå¿…é¡»ç»è¿‡ DBA å®¡æ ¸ï¼Œå¹¶åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œã€‚å› ä¸º alter table ä¼šäº§ç”Ÿè¡¨é”ï¼ŒæœŸé—´é˜»å¡å¯¹äºè¯¥è¡¨çš„æ‰€æœ‰å†™å…¥ï¼Œå¯¹äºä¸šåŠ¡å¯èƒ½ä¼šäº§ç”Ÿæå¤§å½±å“ã€‚\n\n2.1.4 å­—æ®µ\nã€å¼ºåˆ¶ã€‘éµå®ˆä»¥ä¸Šå…¨éƒ¨ä¸€èˆ¬å‘½åè§„åˆ™ã€‚\nã€å»ºè®®ã€‘å°½å¯èƒ½é€‰æ‹©çŸ­çš„æˆ–ä¸€ä¸¤ä¸ªå•è¯ã€‚\nã€å¼ºåˆ¶ã€‘é¿å…ä½¿ç”¨ä¿ç•™å­—ä½œä¸ºå­—æ®µåç§°ï¼šorderï¼Œdateï¼Œname æ˜¯æ•°æ®åº“çš„ä¿ç•™å­—ï¼Œé¿å…ä½¿ç”¨å®ƒã€‚å¯ä»¥ä¸ºè¿™äº›åç§°æ·»åŠ å‰ç¼€ä½¿å…¶æ˜“äºç†è§£ï¼Œå¦‚ user_nameï¼Œsignup_date ç­‰ã€‚\nã€å¼ºåˆ¶ã€‘é¿å…ä½¿ç”¨ä¸è¡¨åç›¸åŒçš„å­—æ®µåï¼Œè¿™ä¼šåœ¨ç¼–å†™æŸ¥è¯¢æ—¶é€ æˆæ··æ·†ã€‚\nã€å¼ºåˆ¶ã€‘åœ¨æ•°æ®åº“æ¨¡å¼ä¸Šå®šä¹‰å¤–é”®ã€‚\nã€å¼ºåˆ¶ã€‘é¿å…ä½¿ç”¨ç¼©å†™æˆ–åŸºäºé¦–å­—æ¯ç¼©å†™è¯çš„åç§°ã€‚\nã€å¼ºåˆ¶ã€‘å¤–é”®åˆ—å¿…é¡»å…·æœ‰è¡¨ååŠå…¶ä¸»é”®ï¼Œä¾‹å¦‚ï¼šblog_id è¡¨ç¤ºæ¥è‡ªè¡¨åšå®¢çš„å¤–é”® idã€‚\n\n2.1.5 å­—æ®µæ•°æ®ç±»å‹ä¼˜åŒ–\nã€å»ºè®®ã€‘è¡¨ä¸­çš„è‡ªå¢åˆ—ï¼ˆauto_increment å±æ€§ï¼‰ï¼Œæ¨èä½¿ç”¨ bigint ç±»å‹ã€‚å› ä¸ºæ— ç¬¦å· int å­˜å‚¨èŒƒå›´ä¸º 0~4,294,967,295ï¼ˆä¸åˆ° 43 äº¿ï¼‰ï¼Œæº¢å‡ºåä¼šå¯¼è‡´æŠ¥é”™ã€‚ \nã€å»ºè®®ã€‘ä¸šåŠ¡ä¸­é€‰æ‹©æ€§å¾ˆå°‘çš„çŠ¶æ€ statusã€ç±»å‹ type ç­‰å­—æ®µæ¨èä½¿ç”¨ tinytint æˆ–è€… smallint ç±»å‹èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚ \nã€å»ºè®®ã€‘ä¸šåŠ¡ä¸­ IP åœ°å€å­—æ®µæ¨èä½¿ç”¨ int ç±»å‹ï¼Œä¸æ¨èç”¨ char(15)ã€‚å› ä¸º int åªå  4 å­—èŠ‚ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‡½æ•°ç›¸äº’è½¬æ¢ï¼Œè€Œ char(15) å ç”¨è‡³å°‘ 15 å­—èŠ‚ã€‚\n\nSQL: \nselect inet_aton('192.168.2.12');\nselect inet_ntoa(3232236044);\nPHP: \nip2long('192.168.2.12'); \nlong2ip(3530427185);\n\nJava:  \npublic static long ipToLong(String addr)&#123;\n    String[] addrArray = addr.split(\"\\\\.\");\n    long num = 0;\n    for (int i = 0; i &lt; addrArray.length; i++)&#123;\n        int power = 3 - i;\n        num += ((Integer.parseInt(addrArray[i]) % 256 * Math.pow(256, power)));\n    &#125;\n    return num;\n&#125;\n\npublic static String longToIp(long i)&#123;\n    return ((i >> 24) &amp; 0xFF) + \".\" +\n           ((i >> 16) &amp; 0xFF) + \".\" +\n           ((i >> 8) &amp; 0xFF) + \".\" +\n           (i &amp; 0xFF);\n&#125;\n\n\nã€å»ºè®®ã€‘ä¸æ¨èä½¿ç”¨ enumï¼Œsetã€‚ å› ä¸ºå®ƒä»¬æµªè´¹ç©ºé—´ï¼Œä¸”æšä¸¾å€¼å†™æ­»äº†ï¼Œå˜æ›´ä¸æ–¹ä¾¿ã€‚æ¨èä½¿ç”¨ tinyint æˆ– smallintã€‚ \nã€å»ºè®®ã€‘ä¸æ¨èä½¿ç”¨ blobï¼Œtext ç­‰ç±»å‹ã€‚å®ƒä»¬éƒ½æ¯”è¾ƒæµªè´¹ç¡¬ç›˜å’Œå†…å­˜ç©ºé—´ã€‚åœ¨åŠ è½½è¡¨æ•°æ®æ—¶ï¼Œä¼šè¯»å–å¤§å­—æ®µåˆ°å†…å­˜é‡Œä»è€Œæµªè´¹å†…å­˜ç©ºé—´ï¼Œå½±å“ç³»ç»Ÿæ€§èƒ½ã€‚å»ºè®®å’Œ PMã€RD æ²Ÿé€šï¼Œæ˜¯å¦çœŸçš„éœ€è¦è¿™ä¹ˆå¤§å­—æ®µã€‚InnoDB ä¸­å½“ä¸€è¡Œè®°å½•è¶…è¿‡ 8098 å­—èŠ‚æ—¶ï¼Œä¼šå°†è¯¥è®°å½•ä¸­é€‰å–æœ€é•¿çš„ä¸€ä¸ªå­—æ®µå°†å…¶ 768 å­—èŠ‚æ”¾åœ¨åŸå§‹ page é‡Œï¼Œè¯¥å­—æ®µä½™ä¸‹å†…å®¹æ”¾åœ¨ overflow-page é‡Œã€‚ä¸å¹¸çš„æ˜¯åœ¨ compact è¡Œæ ¼å¼ä¸‹ï¼ŒåŸå§‹ page å’Œ overflow-page éƒ½ä¼šåŠ è½½ã€‚ \nã€å»ºè®®ã€‘å­˜å‚¨é‡‘é’±çš„å­—æ®µï¼Œå»ºè®®ç”¨ int ä»¥åˆ†ä¸ºå•ä½å­˜å‚¨ï¼Œæœ€å¤§æ•°å€¼çº¦ 4290 ä¸‡ï¼Œç¨‹åºç«¯ä¹˜ä»¥ 100 å’Œé™¤ä»¥ 100 è¿›è¡Œå­˜å–ã€‚å› ä¸º int å ç”¨ 4 å­—èŠ‚ï¼Œè€Œ double å ç”¨ 8 å­—èŠ‚ï¼Œç©ºé—´æµªè´¹ã€‚ \nã€å»ºè®®ã€‘æ–‡æœ¬æ•°æ®å°½é‡ç”¨ varchar å­˜å‚¨ã€‚å› ä¸º varchar æ˜¯å˜é•¿å­˜å‚¨ï¼Œæ¯” char æ›´çœç©ºé—´ã€‚MySQL server å±‚è§„å®šä¸€è¡Œæ‰€æœ‰æ–‡æœ¬æœ€å¤šå­˜ 65535 å­—èŠ‚ï¼Œå› æ­¤åœ¨ utf8 å­—ç¬¦é›†ä¸‹æœ€å¤šå­˜ 21844 ä¸ªå­—ç¬¦ï¼Œè¶…è¿‡ä¼šè‡ªåŠ¨è½¬æ¢ä¸º mediumtext å­—æ®µã€‚è€Œ text åœ¨ utf8 å­—ç¬¦é›†ä¸‹æœ€å¤šå­˜ 21844 ä¸ªå­—ç¬¦ï¼Œmediumtext æœ€å¤šå­˜ 2^24&#x2F;3 ä¸ªå­—ç¬¦ï¼Œlongtext æœ€å¤šå­˜ 2^32 ä¸ªå­—ç¬¦ã€‚ä¸€èˆ¬å»ºè®®ç”¨ varchar ç±»å‹ï¼Œå­—ç¬¦æ•°ä¸è¦è¶…è¿‡ 2700ã€‚ \nã€å»ºè®®ã€‘æ—¶é—´ç±»å‹å°½é‡é€‰å– timestampã€‚å› ä¸º datetime å ç”¨ 8 å­—èŠ‚ï¼Œtimestamp ä»…å ç”¨ 4 å­—èŠ‚ï¼Œä½†æ˜¯èŒƒå›´ä¸º 1970-01-01 00:00:01 åˆ° 2038-01-01 00:00:00ã€‚æ›´ä¸ºé«˜é˜¶çš„æ–¹æ³•ï¼Œé€‰ç”¨ int æ¥å­˜å‚¨æ—¶é—´ï¼Œä½¿ç”¨ SQL å‡½æ•° unix_timestamp() å’Œ from_unixtime() æ¥è¿›è¡Œè½¬æ¢ã€‚\n\n\nè¯¦ç»†å­˜å‚¨å¤§å°å‚è€ƒä¸‹å›¾ï¼š  \n\n\nç±»å‹ï¼ˆåŒä¹‰è¯ï¼‰\nå­˜å‚¨é•¿åº¦(BYTES)\næœ€å°å€¼(SIGNED&#x2F;UNSIGNED)\næœ€å¤§å€¼(SIGNED&#x2F;UNSIGNED)\n\n\n\næ•´å½¢æ•°å­—\n\n\n\n\n\nTINYINT\n1\n-128&#x2F;0\n127&#x2F;255\n\n\nSMALLINT\n2\n-32,768&#x2F;0\n32767&#x2F;65,535\n\n\nMEDIUMINT\n3\n-8,388,608&#x2F;0\n8388607&#x2F;16,777,215&#x2F;\n\n\nINT(INTEGER)\n4\n-2,14,7483,648&#x2F;0\n2147483647&#x2F;4,294,967,295&#x2F;\n\n\nBIGINT\n8\n-2^63&#x2F;0\n263-1&#x2F;264-1\n\n\nå°æ•°æ”¯æŒ\n\n\n\n\n\nFLOAT[(M[,D])]\n4 or 8\n-\n\n\n\nDOUBLE[(M[,D])]\n\n\n\n\n\n(REAL, DOUBLE PRECISION)\n8\n-\n\n\n\næ—¶é—´ç±»å‹\n\n\n\n\n\nDATETIME\n8\n1001-01-01 00:00:00\n9999-12-31 23:59:59\n\n\nDATE\n3\n1001-01-01\n9999-12-31\n\n\nTIME\n3\n00:00:00\n23:59:59\n\n\nYEAR\n1\n1001\n9999\n\n\nTIMESTAMP\n4\n1970-01-01 00:00:00\n\n\n\n\n\n2.1.6 ç´¢å¼•è®¾è®¡\nã€å¼ºåˆ¶ã€‘InnoDB è¡¨å¿…é¡»ä¸»é”®ä¸º id int/bigint auto_incrementï¼Œä¸”ä¸»é”®å€¼ç¦æ­¢è¢«æ›´æ–°ã€‚\nã€å»ºè®®ã€‘ä¸»é”®çš„åç§°ä»¥ pk_ å¼€å¤´ï¼Œå”¯ä¸€é”®ä»¥ uk_ å¼€å¤´ï¼Œæ™®é€šç´¢å¼•ä»¥ ix_ å¼€å¤´ï¼Œä¸€å¾‹ä½¿ç”¨å°å†™æ ¼å¼ï¼Œä»¥è¡¨å&#x2F;å­—æ®µçš„åç§°æˆ–ç¼©å†™ä½œä¸ºåç¼€ã€‚\nã€å¼ºåˆ¶ã€‘InnoDB å’Œ MyISAM å­˜å‚¨å¼•æ“è¡¨ï¼Œç´¢å¼•ç±»å‹å¿…é¡»ä¸º BTREEï¼›MEMORY è¡¨å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹© HASH æˆ–è€… BTREE ç±»å‹ç´¢å¼•ã€‚\nã€å¼ºåˆ¶ã€‘å•ä¸ªç´¢å¼•ä¸­æ¯ä¸ªç´¢å¼•è®°å½•çš„é•¿åº¦ä¸èƒ½è¶…è¿‡ 64KBã€‚\nã€å»ºè®®ã€‘å•ä¸ªè¡¨ä¸Šçš„ç´¢å¼•ä¸ªæ•°ä¸èƒ½è¶…è¿‡ 7 ä¸ªã€‚\nã€å»ºè®®ã€‘åœ¨å»ºç«‹ç´¢å¼•æ—¶ï¼Œå¤šè€ƒè™‘å»ºç«‹è”åˆç´¢å¼•ï¼Œå¹¶æŠŠåŒºåˆ†åº¦æœ€é«˜çš„å­—æ®µæ”¾åœ¨æœ€å‰é¢ã€‚å¦‚åˆ— user_id çš„åŒºåˆ†åº¦å¯ç”± select count(distinct user_id) è®¡ç®—å‡ºæ¥ã€‚\nã€å»ºè®®ã€‘åœ¨å¤šè¡¨ join çš„ SQL é‡Œï¼Œä¿è¯è¢«é©±åŠ¨è¡¨çš„è¿æ¥åˆ—ä¸Šæœ‰ç´¢å¼•ï¼Œè¿™æ · join æ‰§è¡Œæ•ˆç‡æœ€é«˜ã€‚\nã€å»ºè®®ã€‘å»ºè¡¨æˆ–åŠ ç´¢å¼•æ—¶ï¼Œä¿è¯è¡¨é‡Œäº’ç›¸ä¸å­˜åœ¨å†—ä½™ç´¢å¼•ã€‚å¯¹äº MySQL æ¥è¯´ï¼Œå¦‚æœè¡¨é‡Œå·²ç»å­˜åœ¨ key(a, b)ï¼Œåˆ™ key(a) ä¸ºå†—ä½™ç´¢å¼•ï¼Œéœ€è¦åˆ é™¤ã€‚\nã€å»ºè®®ã€‘å¦‚æœé€‰æ‹©æ€§è¶…è¿‡ 20%ï¼Œé‚£ä¹ˆå…¨è¡¨æ‰«ææ¯”ä½¿ç”¨ç´¢å¼•æ€§èƒ½æ›´ä¼˜ï¼Œå³æ²¡æœ‰è®¾ç½®ç´¢å¼•çš„å¿…è¦ã€‚\n\n2.1.7 åˆ†åº“åˆ†è¡¨ã€åˆ†åŒºè¡¨\nã€å¼ºåˆ¶ã€‘åˆ†åŒºè¡¨çš„åˆ†åŒºå­—æ®µï¼ˆpartition-keyï¼‰å¿…é¡»æœ‰ç´¢å¼•ï¼Œæˆ–è€…æ˜¯ç»„åˆç´¢å¼•çš„é¦–åˆ—ã€‚\nã€å¼ºåˆ¶ã€‘å•ä¸ªåˆ†åŒºè¡¨ä¸­çš„åˆ†åŒºï¼ˆåŒ…æ‹¬å­åˆ†åŒºï¼‰ä¸ªæ•°ä¸èƒ½è¶…è¿‡ 1024ã€‚\nã€å¼ºåˆ¶ã€‘ä¸Šçº¿å‰ RD æˆ–è€… DBA å¿…é¡»æŒ‡å®šåˆ†åŒºè¡¨çš„åˆ›å»ºã€æ¸…ç†ç­–ç•¥ã€‚\nã€å¼ºåˆ¶ã€‘è®¿é—®åˆ†åŒºè¡¨çš„ SQL å¿…é¡»åŒ…å«åˆ†åŒºé”®ã€‚\nã€å»ºè®®ã€‘å•ä¸ªåˆ†åŒºæ–‡ä»¶ä¸è¶…è¿‡ 2Gï¼Œæ€»å¤§å°ä¸è¶…è¿‡ 50Gã€‚å»ºè®®æ€»åˆ†åŒºæ•°ä¸è¶…è¿‡ 20 ä¸ªã€‚\nã€å¼ºåˆ¶ã€‘å¯¹äºåˆ†åŒºè¡¨æ‰§è¡Œ alter table æ“ä½œï¼Œå¿…é¡»åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œã€‚\nã€å¼ºåˆ¶ã€‘é‡‡ç”¨åˆ†åº“ç­–ç•¥çš„ï¼Œåº“çš„æ•°é‡ä¸èƒ½è¶…è¿‡ 1024ã€‚\nã€å¼ºåˆ¶ã€‘é‡‡ç”¨åˆ†è¡¨ç­–ç•¥çš„ï¼Œè¡¨çš„æ•°é‡ä¸èƒ½è¶…è¿‡ 4096ã€‚\nã€å»ºè®®ã€‘å•ä¸ªåˆ†è¡¨ä¸è¶…è¿‡ 500W è¡Œï¼Œibd æ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 2Gï¼Œè¿™æ ·æ‰èƒ½è®©æ•°æ®åˆ†å¸ƒå¼å˜å¾—æ€§èƒ½æ›´ä½³ã€‚\nã€å»ºè®®ã€‘æ°´å¹³åˆ†è¡¨å°½é‡ç”¨å–æ¨¡æ–¹å¼ï¼Œæ—¥å¿—ã€æŠ¥è¡¨ç±»æ•°æ®å»ºè®®é‡‡ç”¨æ—¥æœŸè¿›è¡Œåˆ†è¡¨ã€‚\n\n2.1.8 å­—ç¬¦é›†\nã€å¼ºåˆ¶ã€‘æ•°æ®åº“æœ¬èº«åº“ã€è¡¨ã€åˆ—æ‰€æœ‰å­—ç¬¦é›†å¿…é¡»ä¿æŒä¸€è‡´ï¼Œä¸º utf8 æˆ– utf8mb4ã€‚\nã€å¼ºåˆ¶ã€‘å‰ç«¯ç¨‹åºå­—ç¬¦é›†æˆ–è€…ç¯å¢ƒå˜é‡ä¸­çš„å­—ç¬¦é›†ï¼Œä¸æ•°æ®åº“ã€è¡¨çš„å­—ç¬¦é›†å¿…é¡»ä¸€è‡´ï¼Œç»Ÿä¸€ä¸º utf8ã€‚\n\n2.1.9 ç¨‹åºå±‚ DAO è®¾è®¡å»ºè®®\nã€å»ºè®®ã€‘æ–°çš„ä»£ç ä¸è¦ç”¨ modelï¼Œæ¨èä½¿ç”¨æ‰‹åŠ¨æ‹¼ SQL + ç»‘å®šå˜é‡ä¼ å…¥å‚æ•°çš„æ–¹å¼ã€‚å› ä¸º model è™½ç„¶å¯ä»¥ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼æ“ä½œ dbï¼Œä½†æ˜¯å…¶ä½¿ç”¨ä¸å½“å¾ˆå®¹æ˜“é€ æˆç”Ÿæˆçš„ SQL éå¸¸å¤æ‚ï¼Œä¸” model å±‚è‡ªå·±åšçš„å¼ºåˆ¶ç±»å‹è½¬æ¢æ€§èƒ½è¾ƒå·®ï¼Œæœ€ç»ˆå¯¼è‡´æ•°æ®åº“æ€§èƒ½ä¸‹é™ã€‚\nã€å»ºè®®ã€‘å‰ç«¯ç¨‹åºè¿æ¥ MySQL æˆ–è€… Redisï¼Œå¿…é¡»è¦æœ‰è¿æ¥è¶…æ—¶å’Œå¤±è´¥é‡è¿æœºåˆ¶ï¼Œä¸”å¤±è´¥é‡è¯•å¿…é¡»æœ‰é—´éš”æ—¶é—´ã€‚\nã€å»ºè®®ã€‘å‰ç«¯ç¨‹åºæŠ¥é”™é‡Œå°½é‡èƒ½å¤Ÿæç¤º MySQL æˆ– Redis åŸç”Ÿæ€çš„æŠ¥é”™ä¿¡æ¯ï¼Œä¾¿äºæ’æŸ¥é”™è¯¯ã€‚\nã€å»ºè®®ã€‘å¯¹äºæœ‰è¿æ¥æ± çš„å‰ç«¯ç¨‹åºï¼Œå¿…é¡»æ ¹æ®ä¸šåŠ¡éœ€è¦é…ç½®åˆå§‹ã€æœ€å°ã€æœ€å¤§è¿æ¥æ•°ï¼Œè¶…æ—¶æ—¶é—´ä»¥åŠè¿æ¥å›æ”¶æœºåˆ¶ï¼Œå¦åˆ™ä¼šè€—å°½æ•°æ®åº“è¿æ¥èµ„æºï¼Œé€ æˆçº¿ä¸Šäº‹æ•…ã€‚\nã€å»ºè®®ã€‘å¯¹äº log æˆ– history ç±»å‹çš„è¡¨ï¼Œéšæ—¶é—´å¢é•¿å®¹æ˜“è¶Šæ¥è¶Šå¤§ï¼Œå› æ­¤ä¸Šçº¿å‰ RD æˆ–è€… DBA å¿…é¡»å»ºç«‹è¡¨æ•°æ®æ¸…ç†æˆ–å½’æ¡£æ–¹æ¡ˆã€‚\nã€å»ºè®®ã€‘åœ¨åº”ç”¨ç¨‹åºè®¾è®¡é˜¶æ®µï¼ŒRD å¿…é¡»è€ƒè™‘å¹¶è§„é¿æ•°æ®åº“ä¸­ä¸»ä»å»¶è¿Ÿå¯¹äºä¸šåŠ¡çš„å½±å“ã€‚å°½é‡é¿å…ä»åº“çŸ­æ—¶å»¶è¿Ÿï¼ˆ20 ç§’ä»¥å†…ï¼‰å¯¹ä¸šåŠ¡é€ æˆå½±å“ï¼Œå»ºè®®å¼ºåˆ¶ä¸€è‡´æ€§çš„è¯»å¼€å¯äº‹åŠ¡èµ°ä¸»åº“ï¼Œæˆ–æ›´æ–°åè¿‡ä¸€æ®µæ—¶é—´å†å»è¯»ä»åº“ã€‚\nã€å»ºè®®ã€‘å¤šä¸ªå¹¶å‘ä¸šåŠ¡é€»è¾‘è®¿é—®åŒä¸€å—æ•°æ®ï¼ˆInnoDB è¡¨ï¼‰æ—¶ï¼Œä¼šåœ¨æ•°æ®åº“ç«¯äº§ç”Ÿè¡Œé”ç”šè‡³è¡¨é”å¯¼è‡´å¹¶å‘ä¸‹é™ï¼Œå› æ­¤å»ºè®®æ›´æ–°ç±» SQL å°½é‡åŸºäºä¸»é”®å»æ›´æ–°ã€‚\nã€å»ºè®®ã€‘ä¸šåŠ¡é€»è¾‘ä¹‹é—´åŠ é”é¡ºåºå°½é‡ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ­»é”ã€‚\nã€å»ºè®®ã€‘å¯¹äºå•è¡¨è¯»å†™æ¯”å¤§äº 10:1 çš„æ•°æ®è¡Œæˆ–å•ä¸ªåˆ—ï¼Œå¯ä»¥å°†çƒ­ç‚¹æ•°æ®æ”¾åœ¨ç¼“å­˜é‡Œï¼ˆå¦‚ Memcached æˆ– Redisï¼‰ï¼ŒåŠ å¿«è®¿é—®é€Ÿåº¦ï¼Œé™ä½ MySQL å‹åŠ›ã€‚\n\n2.1.10 ä¸€ä¸ªè§„èŒƒçš„å»ºè¡¨è¯­å¥ç¤ºä¾‹\nä¸€ä¸ªè¾ƒä¸ºè§„èŒƒçš„å»ºè¡¨è¯­å¥ä¸ºï¼š create table user \n( \n    `id`            bigint(11) not null auto_increment, \n    `user_id`       bigint(11) not null comment 'ç”¨æˆ· ID', \n    `username`      varchar(45) not null comment 'ç™»å½•å', \n    `email`         varchar(30) not null comment 'é‚®ç®±', \n    `nickname`      varchar(45) not null comment 'æ˜µç§°', \n    `avatar`        int(11) not null comment 'å¤´åƒ', \n    `birthday`      date not null comment 'ç”Ÿæ—¥', \n    `gender`        tinyint(4) default '0' comment 'æ€§åˆ«', \n    `intro`         varchar(150) default null comment 'ç®€ä»‹', \n    `resume_url`    varchar(300) not null comment 'ç®€å†å­˜æ”¾åœ°å€', \n    `register_ip`   int not null comment 'ç”¨æˆ·æ³¨å†Œæ—¶çš„æº IP', \n    `review_status` tinyint not null comment 'å®¡æ ¸çŠ¶æ€ï¼Œ1-é€šè¿‡ï¼Œ2-å®¡æ ¸ä¸­ï¼Œ3-æœªé€šè¿‡ï¼Œ4-å°šæœªæäº¤å®¡æ ¸', \n    `create_time`   timestamp not null comment 'è®°å½•åˆ›å»ºçš„æ—¶é—´', \n    `update_time`   timestamp not null comment 'èµ„æ–™ä¿®æ”¹çš„æ—¶é—´', \n    \n    primary key (`id`), \n    unique key `idx_user_id` (`user_id`), \n    key `idx_username`(`username`), \n    key `idx_create_time`(`create_time`, `review_status`) \n) \nengine = InnoDB\ndefault charset = utf8 \ncomment = 'ç”¨æˆ·åŸºæœ¬ä¿¡æ¯';\n\n2.2 SQL ç¼–å†™2.2.1 DML è¯­å¥\nã€å¼ºåˆ¶ã€‘select è¯­å¥å¿…é¡»æŒ‡å®šå…·ä½“å­—æ®µåç§°ï¼Œç¦æ­¢å†™æˆ *ã€‚å› ä¸º select * ä¼šå°†ä¸è¯¥è¯»çš„æ•°æ®ä¹Ÿä» MySQL é‡Œè¯»å‡ºæ¥ï¼Œé€ æˆç½‘å¡å‹åŠ›ã€‚\nã€å¼ºåˆ¶ã€‘insert è¯­å¥æŒ‡å®šå…·ä½“å­—æ®µåç§°ï¼Œä¸è¦å†™æˆ insert into t1 values(â€¦)ï¼Œé“ç†åŒä¸Šã€‚\nã€å»ºè®®ã€‘insert into â€¦ values(xx),(xx),(xx)â€¦ï¼Œè¿™é‡Œ xx çš„å€¼ä¸è¦è¶…è¿‡ 5000 ä¸ªã€‚å€¼è¿‡å¤šè™½ç„¶ä¸Šçº¿å¾ˆå¿«ï¼Œä½†ä¼šå¼•èµ·ä¸»ä»åŒæ­¥å»¶è¿Ÿã€‚\nã€å»ºè®®ã€‘select è¯­å¥ä¸è¦ä½¿ç”¨ unionï¼Œæ¨èä½¿ç”¨ union allï¼Œå¹¶ä¸” union å­å¥ä¸ªæ•°é™åˆ¶åœ¨ 5 ä¸ªä»¥å†…ã€‚å› ä¸º union all ä¸éœ€è¦å»é‡ï¼ŒèŠ‚çœæ•°æ®åº“èµ„æºï¼Œæé«˜æ€§èƒ½ã€‚\nã€å»ºè®®ã€‘in å€¼åˆ—è¡¨é™åˆ¶åœ¨ 500 ä»¥å†…ã€‚ä¾‹å¦‚ select â€¦ where user_id in(â€¦500 ä¸ªä»¥å†…â€¦)ï¼Œè¿™ä¹ˆåšæ˜¯ä¸ºäº†å‡å°‘åº•å±‚æ‰«æï¼Œå‡è½»æ•°æ®åº“å‹åŠ›ä»è€ŒåŠ é€ŸæŸ¥è¯¢ã€‚\nã€å»ºè®®ã€‘äº‹åŠ¡é‡Œæ‰¹é‡æ›´æ–°æ•°æ®éœ€è¦æ§åˆ¶æ•°é‡ï¼Œè¿›è¡Œå¿…è¦çš„ sleepï¼Œåšåˆ°å°‘é‡å¤šæ¬¡ã€‚\nã€å¼ºåˆ¶ã€‘äº‹åŠ¡æ¶‰åŠçš„è¡¨å¿…é¡»å…¨éƒ¨æ˜¯ InnoDB è¡¨ã€‚å¦åˆ™ä¸€æ—¦å¤±è´¥ä¸ä¼šå…¨éƒ¨å›æ»šï¼Œä¸”æ˜“é€ æˆä¸»ä»åº“åŒæ­¥ç»ˆç«¯ã€‚\nã€å¼ºåˆ¶ã€‘å†™å…¥å’Œäº‹åŠ¡å‘å¾€ä¸»åº“ï¼Œåªè¯» SQL å‘å¾€ä»åº“ã€‚\nã€å¼ºåˆ¶ã€‘é™¤é™æ€è¡¨æˆ–å°è¡¨ï¼ˆ100 è¡Œä»¥å†…ï¼‰ï¼Œdml è¯­å¥å¿…é¡»æœ‰ where æ¡ä»¶ï¼Œä¸”ä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾ã€‚\nã€å¼ºåˆ¶ã€‘ç”Ÿäº§ç¯å¢ƒç¦æ­¢ä½¿ç”¨ hintï¼Œå¦‚ sql_no_cacheï¼Œforce indexï¼Œignore keyï¼Œstraight join ç­‰ã€‚å› ä¸º hint æ˜¯ç”¨æ¥å¼ºåˆ¶ sql æŒ‰ç…§æŸä¸ªæ‰§è¡Œè®¡åˆ’æ¥æ‰§è¡Œï¼Œä½†éšç€æ•°æ®é‡å˜åŒ–æˆ‘ä»¬æ— æ³•ä¿è¯è‡ªå·±å½“åˆçš„é¢„åˆ¤æ˜¯æ­£ç¡®çš„ï¼Œå› æ­¤æˆ‘ä»¬è¦ç›¸ä¿¡ MySQL ä¼˜åŒ–å™¨ã€‚\nã€å¼ºåˆ¶ã€‘where æ¡ä»¶é‡Œç­‰å·å·¦å³å­—æ®µç±»å‹å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™æ— æ³•åˆ©ç”¨ç´¢å¼•ã€‚\nã€å»ºè®®ã€‘select|update|delete|replace è¦æœ‰ where å­å¥ï¼Œä¸” where å­å¥çš„æ¡ä»¶å¿…éœ€ä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾ã€‚\nã€å¼ºåˆ¶ã€‘ç”Ÿäº§æ•°æ®åº“ä¸­å¼ºçƒˆä¸æ¨èå¤§è¡¨ä¸Šå‘ç”Ÿå…¨è¡¨æ‰«æï¼Œä½†å¯¹äº 100 è¡Œä»¥ä¸‹çš„é™æ€è¡¨å¯ä»¥å…¨è¡¨æ‰«æã€‚æŸ¥è¯¢æ•°æ®é‡ä¸è¦è¶…è¿‡è¡¨è¡Œæ•°çš„ 25%ï¼Œå¦åˆ™ä¸ä¼šåˆ©ç”¨ç´¢å¼•ã€‚\nã€å¼ºåˆ¶ã€‘where å­å¥ä¸­ç¦æ­¢åªä½¿ç”¨å…¨æ¨¡ç³Šçš„ like æ¡ä»¶è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¿…é¡»æœ‰å…¶å®ƒç­‰å€¼æˆ–èŒƒå›´æŸ¥è¯¢æ¡ä»¶ï¼Œå¦åˆ™æ— æ³•åˆ©ç”¨ç´¢å¼•ã€‚\nã€å»ºè®®ã€‘ç´¢å¼•åˆ—ä¸è¦ä½¿ç”¨å‡½æ•°æˆ–è¡¨è¾¾å¼ï¼Œå¦åˆ™æ— æ³•åˆ©ç”¨ç´¢å¼•ã€‚å¦‚ where length(name) = &#39;admin&#39; æˆ– where user_id + 2 = 10023ã€‚\nã€å»ºè®®ã€‘å‡å°‘ä½¿ç”¨ or è¯­å¥ï¼Œå¯å°† or è¯­å¥ä¼˜åŒ–ä¸º unionï¼Œç„¶ååœ¨å„ä¸ª where æ¡ä»¶ä¸Šå»ºç«‹ç´¢å¼•ã€‚å¦‚ where a = 1 or b = 2 ä¼˜åŒ–ä¸º where a = 1 â€¦ union â€¦ where b = 2, key(a), key(b)ã€‚\nã€å»ºè®®ã€‘åˆ†é¡µæŸ¥è¯¢ï¼Œå½“ limit èµ·ç‚¹è¾ƒé«˜æ—¶ï¼Œå¯å…ˆç”¨è¿‡æ»¤æ¡ä»¶è¿›è¡Œè¿‡æ»¤ã€‚å¦‚ select a, b, c from t1 limit 10000, 20; ä¼˜åŒ–ä¸º: select a, b, c from t1 where id &gt; 10000 limit 20;ã€‚\n\n2.2.2 å¤šè¡¨è¿æ¥\nã€å¼ºåˆ¶ã€‘ç¦æ­¢è·¨ DB çš„ join è¯­å¥ã€‚å› ä¸ºè¿™æ ·å¯ä»¥å‡å°‘æ¨¡å—é—´è€¦åˆï¼Œä¸ºæ•°æ®åº“æ‹†åˆ†å¥ å®šåšå®åŸºç¡€ã€‚\nã€å¼ºåˆ¶ã€‘ç¦æ­¢åœ¨ä¸šåŠ¡çš„æ›´æ–°ç±» SQL è¯­å¥ä¸­ä½¿ç”¨ joinï¼Œæ¯”å¦‚ update t1 join t2 â€¦ã€‚\nã€å»ºè®®ã€‘ä¸å»ºè®®ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå»ºè®®å°†å­æŸ¥è¯¢ SQL æ‹†å¼€ç»“åˆç¨‹åºå¤šæ¬¡æŸ¥è¯¢ï¼Œæˆ–ä½¿ç”¨ join æ¥ä»£æ›¿å­æŸ¥è¯¢ã€‚\nã€å»ºè®®ã€‘çº¿ä¸Šç¯å¢ƒï¼Œå¤šè¡¨ join ä¸è¦è¶…è¿‡ 3 ä¸ªè¡¨ã€‚\nã€å»ºè®®ã€‘å¤šè¡¨è¿æ¥æŸ¥è¯¢æ¨èä½¿ç”¨åˆ«åï¼Œä¸” select åˆ—è¡¨ä¸­è¦ç”¨åˆ«åå¼•ç”¨å­—æ®µï¼Œæ•°æ®åº“.è¡¨æ ¼å¼ï¼Œå¦‚ select a from db1.table1 alias1 where â€¦ã€‚\nã€å»ºè®®ã€‘åœ¨å¤šè¡¨ join ä¸­ï¼Œå°½é‡é€‰å–ç»“æœé›†è¾ƒå°çš„è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œæ¥ join å…¶å®ƒè¡¨ã€‚\n\n2.2.3 äº‹åŠ¡\nã€å»ºè®®ã€‘äº‹åŠ¡ä¸­ insert|update|delete|replace è¯­å¥æ“ä½œçš„è¡Œæ•°æ§åˆ¶åœ¨ 2000 ä»¥å†…ï¼Œä»¥åŠ where å­å¥ä¸­ in åˆ—è¡¨çš„ä¼ å‚ä¸ªæ•°æ§åˆ¶åœ¨ 500 ä»¥å†…ã€‚\nã€å»ºè®®ã€‘æ‰¹é‡æ“ä½œæ•°æ®æ—¶ï¼Œéœ€è¦æ§åˆ¶äº‹åŠ¡å¤„ç†é—´éš”æ—¶é—´ï¼Œè¿›è¡Œå¿…è¦çš„ sleepï¼Œä¸€èˆ¬å»ºè®®å€¼ 5-10 ç§’ã€‚\nã€å»ºè®®ã€‘å¯¹äºæœ‰ auto_increment å±æ€§å­—æ®µçš„è¡¨çš„æ’å…¥æ“ä½œï¼Œå¹¶å‘éœ€è¦æ§åˆ¶åœ¨ 200 ä»¥å†…ã€‚\nã€å¼ºåˆ¶ã€‘ç¨‹åºè®¾è®¡å¿…é¡»è€ƒè™‘â€œæ•°æ®åº“äº‹åŠ¡éš”ç¦»çº§åˆ«â€å¸¦æ¥çš„å½±å“ï¼ŒåŒ…æ‹¬è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚çº¿ä¸Šå»ºè®®äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º repeatable-readã€‚\nã€å»ºè®®ã€‘äº‹åŠ¡é‡ŒåŒ…å« SQL ä¸è¶…è¿‡ 5 ä¸ªï¼ˆæ”¯ä»˜ä¸šåŠ¡é™¤å¤–ï¼‰ã€‚å› ä¸ºè¿‡é•¿çš„äº‹åŠ¡ä¼šå¯¼è‡´é”æ•°æ®è¾ƒä¹…ï¼ŒMySQL å†…éƒ¨ç¼“å­˜ã€è¿æ¥æ¶ˆè€—è¿‡å¤šç­‰é›ªå´©é—®é¢˜ã€‚\nã€å»ºè®®ã€‘äº‹åŠ¡é‡Œæ›´æ–°è¯­å¥å°½é‡åŸºäºä¸»é”®æˆ– unique keyï¼Œå¦‚ update â€¦ where id = XX;ï¼Œå¦åˆ™ä¼šäº§ç”Ÿé—´éš™é”ï¼Œå†…éƒ¨æ‰©å¤§é”å®šèŒƒå›´ï¼Œå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼Œäº§ç”Ÿæ­»é”ã€‚\nã€å»ºè®®ã€‘å°½é‡æŠŠä¸€äº›å…¸å‹å¤–éƒ¨è°ƒç”¨ç§»å‡ºäº‹åŠ¡ï¼Œå¦‚è°ƒç”¨ Web Serviceï¼Œè®¿é—®æ–‡ä»¶å­˜å‚¨ç­‰ï¼Œä»è€Œé¿å…äº‹åŠ¡è¿‡é•¿ã€‚\nã€å»ºè®®ã€‘å¯¹äº MySQL ä¸»ä»å»¶è¿Ÿä¸¥æ ¼æ•æ„Ÿçš„ select è¯­å¥ï¼Œè¯·å¼€å¯äº‹åŠ¡å¼ºåˆ¶è®¿é—®ä¸»åº“ã€‚\n\n2.2.4 æ’åºå’Œåˆ†ç»„\nã€å»ºè®®ã€‘å‡å°‘ä½¿ç”¨ order byï¼Œå’Œä¸šåŠ¡æ²Ÿé€šèƒ½ä¸æ’åºå°±ä¸æ’åºï¼Œæˆ–å°†æ’åºæ”¾åˆ°ç¨‹åºç«¯å»åšã€‚order byã€group byã€distinct è¿™äº›è¯­å¥è¾ƒä¸ºè€—è´¹ CPUï¼Œæ•°æ®åº“çš„ CPU èµ„æºæ˜¯æå…¶å®è´µçš„ã€‚\nã€å»ºè®®ã€‘order byã€group byã€distinct è¿™äº› SQL å°½é‡åˆ©ç”¨ç´¢å¼•ç›´æ¥æ£€ç´¢å‡ºæ’åºå¥½çš„æ•°æ®ã€‚å¦‚ where a = 1 order by å¯ä»¥åˆ©ç”¨ key(a, b)ã€‚\nã€å»ºè®®ã€‘åŒ…å«äº† order byã€group byã€distinct è¿™äº›æŸ¥è¯¢çš„è¯­å¥ï¼Œwhere æ¡ä»¶è¿‡æ»¤å‡ºæ¥çš„ç»“æœé›†è¯·ä¿æŒåœ¨ 1000 è¡Œä»¥å†…ï¼Œå¦åˆ™ SQL ä¼šå¾ˆæ…¢ã€‚\n\n2.2.5 çº¿ä¸Šç¦æ­¢ä½¿ç”¨çš„ SQL è¯­å¥\nã€é«˜å±ã€‘ç¦ç”¨ update|delete t1 â€¦ where a = XX limit XX; è¿™ç§å¸¦ limit çš„æ›´æ–°è¯­å¥ã€‚å› ä¸ºä¼šå¯¼è‡´ä¸»ä»ä¸ä¸€è‡´ï¼Œå¯¼è‡´æ•°æ®é”™ä¹±ã€‚å»ºè®®åŠ ä¸Š order by PKã€‚\nã€é«˜å±ã€‘ç¦æ­¢ä½¿ç”¨å…³è”å­æŸ¥è¯¢ï¼Œå¦‚ update t1 set â€¦ where name in(select name from user where â€¦);ï¼Œæ•ˆç‡æå…¶ä½ä¸‹ã€‚\nã€å¼ºåˆ¶ã€‘ç¦ç”¨ procedureã€functionã€triggerã€viewsã€eventã€å¤–é”®çº¦æŸã€‚å› ä¸ºä»–ä»¬æ¶ˆè€—æ•°æ®åº“èµ„æºï¼Œé™ä½æ•°æ®åº“å®ä¾‹å¯æ‰©å±•æ€§ã€‚æ¨èéƒ½åœ¨ç¨‹åºç«¯å®ç°ã€‚\nã€å¼ºåˆ¶ã€‘ç¦ç”¨ insert into â€¦ on duplicate key update â€¦ åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼Œä¼šé€ æˆä¸»ä»ä¸ä¸€è‡´ã€‚\nã€å¼ºåˆ¶ã€‘ç¦æ­¢è”è¡¨æ›´æ–°è¯­å¥ï¼Œå¦‚ update t1, t2 where t1.id = t2.id â€¦ã€‚\n\n","slug":"MySQL/MySQLæ•°æ®åº“è®¾è®¡è§„èŒƒ","date":"2022-02-23T03:37:18.000Z","categories_index":"MySQL","tags_index":"MySQL","author_index":"Anchor"},{"id":"b4b30b3366bb496de67ea3da9b9ffa6f","title":"Java åŸºç¡€","content":"ä¸€ã€æ•°æ®ç±»å‹åŸºæœ¬ç±»å‹\nbyte&#x2F;8\nchar&#x2F;16\nshort&#x2F;16\nint&#x2F;32\nfloat&#x2F;32\nlong&#x2F;64\ndouble&#x2F;64\nboolean&#x2F;~\n\nboolean åªæœ‰ä¸¤ä¸ªå€¼ï¼štrueã€falseï¼Œå¯ä»¥ä½¿ç”¨ 1 bit æ¥å­˜å‚¨ï¼Œä½†æ˜¯å…·ä½“å¤§å°æ²¡æœ‰æ˜ç¡®è§„å®šã€‚JVM ä¼šåœ¨ç¼–è¯‘æ—¶æœŸå°† boolean ç±»å‹çš„æ•°æ®è½¬æ¢ä¸º intï¼Œä½¿ç”¨ 1 æ¥è¡¨ç¤º trueï¼Œ0 è¡¨ç¤º falseã€‚JVM æ”¯æŒ boolean æ•°ç»„ï¼Œä½†æ˜¯æ˜¯é€šè¿‡è¯»å†™ byte æ•°ç»„æ¥å®ç°çš„ã€‚\n\nPrimitive Data Types\nThe JavaÂ® Virtual Machine Specification\n\nåŒ…è£…ç±»å‹åŸºæœ¬ç±»å‹éƒ½æœ‰å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼ŒåŸºæœ¬ç±»å‹ä¸å…¶å¯¹åº”çš„åŒ…è£…ç±»å‹ä¹‹é—´çš„èµ‹å€¼ä½¿ç”¨è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±å®Œæˆã€‚\nInteger x = 2;     // è£…ç®± è°ƒç”¨äº† Integer.valueOf(2)\nint y = x;         // æ‹†ç®± è°ƒç”¨äº† X.intValue()\n\n\nAutoboxing and Unboxing\n\nç¼“å­˜æ± new Integer(123) ä¸ Integer.valueOf(123) çš„åŒºåˆ«åœ¨äºï¼š\n\nnew Integer(123) æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼›\nInteger.valueOf(123) ä¼šä½¿ç”¨ç¼“å­˜æ± ä¸­çš„å¯¹è±¡ï¼Œå¤šæ¬¡è°ƒç”¨ä¼šå–å¾—åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚\n\nInteger x = new Integer(123);\nInteger y = new Integer(123);\nSystem.out.println(x == y);    // false\nInteger z = Integer.valueOf(123);\nInteger k = Integer.valueOf(123);\nSystem.out.println(z == k);   // true\n\nvalueOf() æ–¹æ³•çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å…ˆåˆ¤æ–­å€¼æ˜¯å¦åœ¨ç¼“å­˜æ± ä¸­ï¼Œå¦‚æœåœ¨çš„è¯å°±ç›´æ¥è¿”å›ç¼“å­˜æ± çš„å†…å®¹ã€‚\npublic static Integer valueOf(int i) &#123;\n    if (i >= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)\n        return IntegerCache.cache[i + (-IntegerCache.low)];\n    return new Integer(i);\n&#125;\n\nåœ¨ Java 8 ä¸­ï¼ŒInteger ç¼“å­˜æ± çš„å¤§å°é»˜è®¤ä¸º -128~127ã€‚\nstatic final int low = -128;\nstatic final int high;\nstatic final Integer cache[];\n\nstatic &#123;\n    // high value may be configured by property\n    int h = 127;\n    String integerCacheHighPropValue =\n        sun.misc.VM.getSavedProperty(\"java.lang.Integer.IntegerCache.high\");\n    if (integerCacheHighPropValue != null) &#123;\n        try &#123;\n            int i = parseInt(integerCacheHighPropValue);\n            i = Math.max(i, 127);\n            // Maximum array size is Integer.MAX_VALUE\n            h = Math.min(i, Integer.MAX_VALUE - (-low) -1);\n        &#125; catch( NumberFormatException nfe) &#123;\n            // If the property cannot be parsed into an int, ignore it.\n        &#125;\n    &#125;\n    high = h;\n\n    cache = new Integer[(high - low) + 1];\n    int j = low;\n    for(int k = 0; k &lt; cache.length; k++)\n        cache[k] = new Integer(j++);\n\n    // range [-128, 127] must be interned (JLS7 5.1.7)\n    assert IntegerCache.high >= 127;\n&#125;\n\nç¼–è¯‘å™¨ä¼šåœ¨è‡ªåŠ¨è£…ç®±è¿‡ç¨‹è°ƒç”¨ valueOf() æ–¹æ³•ï¼Œå› æ­¤å¤šä¸ªå€¼ç›¸åŒä¸”å€¼åœ¨ç¼“å­˜æ± èŒƒå›´å†…çš„ Integer å®ä¾‹ä½¿ç”¨è‡ªåŠ¨è£…ç®±æ¥åˆ›å»ºï¼Œé‚£ä¹ˆå°±ä¼šå¼•ç”¨ç›¸åŒçš„å¯¹è±¡ã€‚\nInteger m = 123;\nInteger n = 123;\nSystem.out.println(m == n); // true\n\nåŸºæœ¬ç±»å‹å¯¹åº”çš„ç¼“å†²æ± å¦‚ä¸‹ï¼š\n\nboolean values true and false\nall byte values\nshort values between -128 and 127\nint values between -128 and 127\nchar in the range \\u0000 to \\u007F\n\nåœ¨ä½¿ç”¨è¿™äº›åŸºæœ¬ç±»å‹å¯¹åº”çš„åŒ…è£…ç±»å‹æ—¶ï¼Œå¦‚æœè¯¥æ•°å€¼èŒƒå›´åœ¨ç¼“å†²æ± èŒƒå›´å†…ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ç¼“å†²æ± ä¸­çš„å¯¹è±¡ã€‚\nåœ¨ jdk 1.8 æ‰€æœ‰çš„æ•°å€¼ç±»ç¼“å†²æ± ä¸­ï¼ŒInteger çš„ç¼“å†²æ±  IntegerCache å¾ˆç‰¹æ®Šï¼Œè¿™ä¸ªç¼“å†²æ± çš„ä¸‹ç•Œæ˜¯ - 128ï¼Œä¸Šç•Œé»˜è®¤æ˜¯ 127ï¼Œä½†æ˜¯è¿™ä¸ªä¸Šç•Œæ˜¯å¯è°ƒçš„ï¼Œåœ¨å¯åŠ¨ jvm çš„æ—¶å€™ï¼Œé€šè¿‡ -XX:AutoBoxCacheMax&#x3D; æ¥æŒ‡å®šè¿™ä¸ªç¼“å†²æ± çš„å¤§å°ï¼Œè¯¥é€‰é¡¹åœ¨ JVM åˆå§‹åŒ–çš„æ—¶å€™ä¼šè®¾å®šä¸€ä¸ªåä¸º java.lang.IntegerCache.high ç³»ç»Ÿå±æ€§ï¼Œç„¶å IntegerCache åˆå§‹åŒ–çš„æ—¶å€™å°±ä¼šè¯»å–è¯¥ç³»ç»Ÿå±æ€§æ¥å†³å®šä¸Šç•Œã€‚\n[StackOverflow : Differences between new Integer(123), Integer.valueOf(123) and just 123\n](https://stackoverflow.com/questions/9030817/differences-between-new-integer123-integer-valueof123-and-just-123)\näºŒã€Stringæ¦‚è§ˆString è¢«å£°æ˜ä¸º finalï¼Œå› æ­¤å®ƒä¸å¯è¢«ç»§æ‰¿ã€‚(Integer ç­‰åŒ…è£…ç±»ä¹Ÿä¸èƒ½è¢«ç»§æ‰¿ï¼‰åœ¨ Java 8 ä¸­ï¼ŒString å†…éƒ¨ä½¿ç”¨ char æ•°ç»„å­˜å‚¨æ•°æ®ã€‚\npublic final class String\n    implements java.io.Serializable, Comparable&lt;String>, CharSequence &#123;\n    /** The value is used for character storage. */\n    private final char value[];\n&#125;\n\nåœ¨ Java 9 ä¹‹åï¼ŒString ç±»çš„å®ç°æ”¹ç”¨ byte æ•°ç»„å­˜å‚¨å­—ç¬¦ä¸²ï¼ŒåŒæ—¶ä½¿ç”¨ coder æ¥æ ‡è¯†ä½¿ç”¨äº†å“ªç§ç¼–ç ã€‚\npublic final class String\n    implements java.io.Serializable, Comparable&lt;String>, CharSequence &#123;\n    /** The value is used for character storage. */\n    private final byte[] value;\n\n    /** The identifier of the encoding used to encode the bytes in &#123;@code value&#125;. */\n    private final byte coder;\n&#125;\n\nvalue æ•°ç»„è¢«å£°æ˜ä¸º finalï¼Œè¿™æ„å‘³ç€ value æ•°ç»„åˆå§‹åŒ–ä¹‹åå°±ä¸èƒ½å†å¼•ç”¨å…¶å®ƒæ•°ç»„ã€‚å¹¶ä¸” String å†…éƒ¨æ²¡æœ‰æ”¹å˜ value æ•°ç»„çš„æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥ä¿è¯ String ä¸å¯å˜ã€‚\nä¸å¯å˜çš„å¥½å¤„1. å¯ä»¥ç¼“å­˜ hash å€¼å› ä¸º String çš„ hash å€¼ç»å¸¸è¢«ä½¿ç”¨ï¼Œä¾‹å¦‚ String ç”¨åš HashMap çš„ keyã€‚ä¸å¯å˜çš„ç‰¹æ€§å¯ä»¥ä½¿å¾— hash å€¼ä¹Ÿä¸å¯å˜ï¼Œå› æ­¤åªéœ€è¦è¿›è¡Œä¸€æ¬¡è®¡ç®—ã€‚\n2. String Pool çš„éœ€è¦å¦‚æœä¸€ä¸ª String å¯¹è±¡å·²ç»è¢«åˆ›å»ºè¿‡äº†ï¼Œé‚£ä¹ˆå°±ä¼šä» String Pool ä¸­å–å¾—å¼•ç”¨ã€‚åªæœ‰ String æ˜¯ä¸å¯å˜çš„ï¼Œæ‰å¯èƒ½ä½¿ç”¨ String Poolã€‚\n\n3. å®‰å…¨æ€§String ç»å¸¸ä½œä¸ºå‚æ•°ï¼ŒString ä¸å¯å˜æ€§å¯ä»¥ä¿è¯å‚æ•°ä¸å¯å˜ã€‚ä¾‹å¦‚åœ¨ä½œä¸ºç½‘ç»œè¿æ¥å‚æ•°çš„æƒ…å†µä¸‹å¦‚æœ String æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆåœ¨ç½‘ç»œè¿æ¥è¿‡ç¨‹ä¸­ï¼ŒString è¢«æ”¹å˜ï¼Œæ”¹å˜ String çš„é‚£ä¸€æ–¹ä»¥ä¸ºç°åœ¨è¿æ¥çš„æ˜¯å…¶å®ƒä¸»æœºï¼Œè€Œå®é™…æƒ…å†µå´ä¸ä¸€å®šæ˜¯ã€‚\n4. çº¿ç¨‹å®‰å…¨String ä¸å¯å˜æ€§å¤©ç”Ÿå…·å¤‡çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å®‰å…¨åœ°ä½¿ç”¨ã€‚\nProgram Creek : Why String is immutable in Java?\nString, StringBuffer and StringBuilder1. å¯å˜æ€§\nString ä¸å¯å˜\nStringBuffer å’Œ StringBuilder å¯å˜\n\n2. çº¿ç¨‹å®‰å…¨\nString ä¸å¯å˜ï¼Œå› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„\nStringBuilder ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„\nStringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå†…éƒ¨ä½¿ç”¨ synchronized è¿›è¡ŒåŒæ­¥\n\nStackOverflow : String, StringBuffer, and StringBuilder\nString Poolå­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Poolï¼‰ä¿å­˜ç€æ‰€æœ‰å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆliteral stringsï¼‰ï¼Œè¿™äº›å­—é¢é‡åœ¨ç¼–è¯‘æ—¶æœŸå°±ç¡®å®šã€‚ä¸ä»…å¦‚æ­¤ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ String çš„ intern() æ–¹æ³•åœ¨è¿è¡Œè¿‡ç¨‹å°†å­—ç¬¦ä¸²æ·»åŠ åˆ° String Pool ä¸­ã€‚\nå½“ä¸€ä¸ªå­—ç¬¦ä¸²è°ƒç”¨ intern() æ–¹æ³•æ—¶ï¼Œå¦‚æœ String Pool ä¸­å·²ç»å­˜åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²å’Œè¯¥å­—ç¬¦ä¸²å€¼ç›¸ç­‰ï¼ˆä½¿ç”¨ equals() æ–¹æ³•è¿›è¡Œç¡®å®šï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å› String Pool ä¸­å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼›å¦åˆ™ï¼Œå°±ä¼šåœ¨ String Pool ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›è¿™ä¸ªæ–°å­—ç¬¦ä¸²çš„å¼•ç”¨ã€‚\nä¸‹é¢ç¤ºä¾‹ä¸­ï¼Œs1 å’Œ s2 é‡‡ç”¨ new String() çš„æ–¹å¼æ–°å»ºäº†ä¸¤ä¸ªä¸åŒå­—ç¬¦ä¸²ï¼Œè€Œ s3 å’Œ s4 æ˜¯é€šè¿‡ s1.intern() å’Œ s2.intern() æ–¹æ³•å–å¾—åŒä¸€ä¸ªå­—ç¬¦ä¸²å¼•ç”¨ã€‚intern() é¦–å…ˆæŠŠ â€œaaaâ€ æ”¾åˆ° String Pool ä¸­ï¼Œç„¶åè¿”å›è¿™ä¸ªå­—ç¬¦ä¸²å¼•ç”¨ï¼Œå› æ­¤ s3 å’Œ s4 å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå­—ç¬¦ä¸²ã€‚\nString s1 = new String(\"aaa\");\nString s2 = new String(\"aaa\");\nSystem.out.println(s1 == s2);           // false\nString s3 = s1.intern();\nString s4 = s2.intern();\nSystem.out.println(s3 == s4);           // true\n\nå¦‚æœæ˜¯é‡‡ç”¨ â€œbbbâ€ è¿™ç§å­—é¢é‡çš„å½¢å¼åˆ›å»ºå­—ç¬¦ä¸²ï¼Œä¼šè‡ªåŠ¨åœ°å°†å­—ç¬¦ä¸²æ”¾å…¥ String Pool ä¸­ã€‚\nString s5 = \"bbb\";\nString s6 = \"bbb\";\nSystem.out.println(s5 == s6);  // true\n\nåœ¨ Java 7 ä¹‹å‰ï¼ŒString Pool è¢«æ”¾åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œå®ƒå±äºæ°¸ä¹…ä»£ã€‚è€Œåœ¨ Java 7ï¼ŒString Pool è¢«ç§»åˆ°å †ä¸­ã€‚è¿™æ˜¯å› ä¸ºæ°¸ä¹…ä»£çš„ç©ºé—´æœ‰é™ï¼Œåœ¨å¤§é‡ä½¿ç”¨å­—ç¬¦ä¸²çš„åœºæ™¯ä¸‹ä¼šå¯¼è‡´ OutOfMemoryError é”™è¯¯ã€‚\n\nStackOverflow : What is String interning?\næ·±å…¥è§£æ String#intern\n\nnew String(â€œabcâ€)ä½¿ç”¨è¿™ç§æ–¹å¼ä¸€å…±ä¼šåˆ›å»ºä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼ˆå‰ææ˜¯ String Pool ä¸­è¿˜æ²¡æœ‰ â€œabcâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼‰ã€‚\n\nâ€œabcâ€ å±äºå­—ç¬¦ä¸²å­—é¢é‡ï¼Œå› æ­¤ç¼–è¯‘æ—¶æœŸä¼šåœ¨ String Pool ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼ŒæŒ‡å‘è¿™ä¸ª â€œabcâ€ å­—ç¬¦ä¸²å­—é¢é‡ï¼›\nè€Œä½¿ç”¨ new çš„æ–¹å¼ä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ã€‚\n\nåˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œå…¶ main æ–¹æ³•ä¸­ä½¿ç”¨è¿™ç§æ–¹å¼æ¥åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ã€‚\npublic class NewStringTest &#123;\n    public static void main(String[] args) &#123;\n        String s = new String(\"abc\");\n    &#125;\n&#125;\n\nä½¿ç”¨ javap -verbose è¿›è¡Œåç¼–è¯‘ï¼Œå¾—åˆ°ä»¥ä¸‹å†…å®¹ï¼š\n// ...\nConstant pool:\n// ...\n   #2 = Class              #18            // java/lang/String\n   #3 = String             #19            // abc\n// ...\n  #18 = Utf8               java/lang/String\n  #19 = Utf8               abc\n// ...\n\n  public static void main(java.lang.String[]);\n    descriptor: ([Ljava/lang/String;)V\n    flags: ACC_PUBLIC, ACC_STATIC\n    Code:\n      stack=3, locals=2, args_size=1\n         0: new           #2                  // class java/lang/String\n         3: dup\n         4: ldc           #3                  // String abc\n         6: invokespecial #4                  // Method java/lang/String.\"&lt;init>\":(Ljava/lang/String;)V\n         9: astore_1\n// ...\n\nåœ¨ Constant Pool ä¸­ï¼Œ#19 å­˜å‚¨è¿™å­—ç¬¦ä¸²å­—é¢é‡ â€œabcâ€ï¼Œ#3 æ˜¯ String Pool çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå®ƒæŒ‡å‘ #19 è¿™ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ã€‚åœ¨ main æ–¹æ³•ä¸­ï¼Œ0: è¡Œä½¿ç”¨ new #2 åœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶ä¸”ä½¿ç”¨ ldc #3 å°† String Pool ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ä½œä¸º String æ„é€ å‡½æ•°çš„å‚æ•°ã€‚\nä»¥ä¸‹æ˜¯ String æ„é€ å‡½æ•°çš„æºç ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨å°†ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ä½œä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„æ„é€ å‡½æ•°å‚æ•°æ—¶ï¼Œå¹¶ä¸ä¼šå®Œå…¨å¤åˆ¶ value æ•°ç»„å†…å®¹ï¼Œè€Œæ˜¯éƒ½ä¼šæŒ‡å‘åŒä¸€ä¸ª value æ•°ç»„ã€‚\npublic String(String original) &#123;\n    this.value = original.value;\n    this.hash = original.hash;\n&#125;\n\nä¸‰ã€è¿ç®—å‚æ•°ä¼ é€’Java çš„å‚æ•°æ˜¯ä»¥å€¼ä¼ é€’çš„å½¢å¼ä¼ å…¥æ–¹æ³•ä¸­ï¼Œè€Œä¸æ˜¯å¼•ç”¨ä¼ é€’ã€‚ä»¥ä¸‹ä»£ç ä¸­ Dog dog çš„ dog æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå­˜å‚¨çš„æ˜¯å¯¹è±¡çš„åœ°å€ã€‚åœ¨å°†ä¸€ä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œæœ¬è´¨ä¸Šæ˜¯å°†å¯¹è±¡çš„åœ°å€ä»¥å€¼çš„æ–¹å¼ä¼ é€’åˆ°å½¢å‚ä¸­ã€‚\npublic class Dog &#123;\n\n    String name;\n\n    Dog(String name) &#123;\n        this.name = name;\n    &#125;\n\n    String getName() &#123;\n        return this.name;\n    &#125;\n\n    void setName(String name) &#123;\n        this.name = name;\n    &#125;\n\n    String getObjectAddress() &#123;\n        return super.toString();\n    &#125;\n&#125;\n\nåœ¨æ–¹æ³•ä¸­æ”¹å˜å¯¹è±¡çš„å­—æ®µå€¼ä¼šæ”¹å˜åŸå¯¹è±¡è¯¥å­—æ®µå€¼ï¼Œå› ä¸ºå¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚\nclass PassByValueExample &#123;\n    public static void main(String[] args) &#123;\n        Dog dog = new Dog(\"A\");\n        func(dog);\n        System.out.println(dog.getName());          // B\n    &#125;\n\n    private static void func(Dog dog) &#123;\n        dog.setName(\"B\");\n    &#125;\n&#125;\n\nä½†æ˜¯åœ¨æ–¹æ³•ä¸­å°†æŒ‡é’ˆå¼•ç”¨äº†å…¶å®ƒå¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤æ—¶æ–¹æ³•é‡Œå’Œæ–¹æ³•å¤–çš„ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘äº†ä¸åŒçš„å¯¹è±¡ï¼Œåœ¨ä¸€ä¸ªæŒ‡é’ˆæ”¹å˜å…¶æ‰€æŒ‡å‘å¯¹è±¡çš„å†…å®¹å¯¹å¦ä¸€ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„å¯¹è±¡æ²¡æœ‰å½±å“ã€‚\npublic class PassByValueExample &#123;\n    public static void main(String[] args) &#123;\n        Dog dog = new Dog(\"A\");\n        System.out.println(dog.getObjectAddress()); // Dog@4554617c\n        func(dog);\n        System.out.println(dog.getObjectAddress()); // Dog@4554617c\n        System.out.println(dog.getName());          // A\n    &#125;\n\n    private static void func(Dog dog) &#123;\n        System.out.println(dog.getObjectAddress()); // Dog@4554617c\n        dog = new Dog(\"B\");\n        System.out.println(dog.getObjectAddress()); // Dog@74a14482\n        System.out.println(dog.getName());          // B\n    &#125;\n&#125;\n\nStackOverflow: Is Java â€œpass-by-referenceâ€ or â€œpass-by-valueâ€?\nfloat ä¸ doubleJava ä¸èƒ½éšå¼æ‰§è¡Œå‘ä¸‹è½¬å‹ï¼Œå› ä¸ºè¿™ä¼šä½¿å¾—ç²¾åº¦é™ä½ã€‚1.1 å­—é¢é‡å±äº double ç±»å‹ï¼Œä¸èƒ½ç›´æ¥å°† 1.1 ç›´æ¥èµ‹å€¼ç»™ float å˜é‡ï¼Œå› ä¸ºè¿™æ˜¯å‘ä¸‹è½¬å‹ã€‚\n// float f = 1.1;\n\n1.1f å­—é¢é‡æ‰æ˜¯ float ç±»å‹ã€‚\nfloat f = 1.1f;\n\néšå¼ç±»å‹è½¬æ¢å› ä¸ºå­—é¢é‡ 1 æ˜¯ int ç±»å‹ï¼Œå®ƒæ¯” short ç±»å‹ç²¾åº¦è¦é«˜ï¼Œå› æ­¤ä¸èƒ½éšå¼åœ°å°† int ç±»å‹å‘ä¸‹è½¬å‹ä¸º short ç±»å‹ã€‚\nshort s1 = 1;\n// s1 = s1 + 1;\n\nä½†æ˜¯ä½¿ç”¨ +&#x3D; æˆ–è€… ++ è¿ç®—ç¬¦ä¼šæ‰§è¡Œéšå¼ç±»å‹è½¬æ¢ã€‚\ns1 += 1;\ns1++;\n\nä¸Šé¢çš„è¯­å¥ç›¸å½“äºå°† s1 + 1 çš„è®¡ç®—ç»“æœè¿›è¡Œäº†å‘ä¸‹è½¬å‹ï¼š\ns1 = (short) (s1 + 1);\n\nStackOverflow : Why donâ€™t Javaâ€™s +&#x3D;, -&#x3D;, *&#x3D;, &#x2F;&#x3D; compound assignment operators require casting?\nswitchä» Java 7 å¼€å§‹ï¼Œå¯ä»¥åœ¨ switch æ¡ä»¶åˆ¤æ–­è¯­å¥ä¸­ä½¿ç”¨ String å¯¹è±¡ã€‚\nString s = \"a\";\nswitch (s) &#123;\n    case \"a\":\n        System.out.println(\"aaa\");\n        break;\n    case \"b\":\n        System.out.println(\"bbb\");\n        break;\n&#125;\n\nswitch ä¸æ”¯æŒ longã€floatã€doubleï¼Œæ˜¯å› ä¸º switch çš„è®¾è®¡åˆè¡·æ˜¯å¯¹é‚£äº›åªæœ‰å°‘æ•°å‡ ä¸ªå€¼çš„ç±»å‹è¿›è¡Œç­‰å€¼åˆ¤æ–­ï¼Œå¦‚æœå€¼è¿‡äºå¤æ‚ï¼Œé‚£ä¹ˆè¿˜æ˜¯ç”¨ if æ¯”è¾ƒåˆé€‚ã€‚\n// long x = 111;\n// switch (x) &#123; // Incompatible types. Found: 'long', required: 'char, byte, short, int, Character, Byte, Short, Integer, String, or an enum'\n//     case 111:\n//         System.out.println(111);\n//         break;\n//     case 222:\n//         System.out.println(222);\n//         break;\n// &#125;\n\nStackOverflow : Why canâ€™t your switch statement data type be long, Java?\nå››ã€å…³é”®å­—final1. æ•°æ®å£°æ˜æ•°æ®ä¸ºå¸¸é‡ï¼Œå¯ä»¥æ˜¯ç¼–è¯‘æ—¶å¸¸é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨è¿è¡Œæ—¶è¢«åˆå§‹åŒ–åä¸èƒ½è¢«æ”¹å˜çš„å¸¸é‡ã€‚\n\nå¯¹äºåŸºæœ¬ç±»å‹ï¼Œfinal ä½¿æ•°å€¼ä¸å˜ï¼›\nå¯¹äºå¼•ç”¨ç±»å‹ï¼Œfinal ä½¿å¼•ç”¨ä¸å˜ï¼Œä¹Ÿå°±ä¸èƒ½å¼•ç”¨å…¶å®ƒå¯¹è±¡ï¼Œä½†æ˜¯è¢«å¼•ç”¨çš„å¯¹è±¡æœ¬èº«æ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚\n\nfinal int x = 1;\n// x = 2;  // cannot assign value to final variable 'x'\nfinal A y = new A();\ny.a = 1;\n\n2. æ–¹æ³•å£°æ˜æ–¹æ³•ä¸èƒ½è¢«å­ç±»é‡å†™ã€‚\nprivate æ–¹æ³•éšå¼åœ°è¢«æŒ‡å®šä¸º finalï¼Œå¦‚æœåœ¨å­ç±»ä¸­å®šä¹‰çš„æ–¹æ³•å’ŒåŸºç±»ä¸­çš„ä¸€ä¸ª private æ–¹æ³•ç­¾åç›¸åŒï¼Œæ­¤æ—¶å­ç±»çš„æ–¹æ³•ä¸æ˜¯é‡å†™åŸºç±»æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨å­ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•ã€‚\n3. ç±»å£°æ˜ç±»ä¸å…è®¸è¢«ç»§æ‰¿ã€‚\nstatic1. é™æ€å˜é‡\né™æ€å˜é‡ï¼šåˆç§°ä¸ºç±»å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå˜é‡å±äºç±»çš„ï¼Œç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å…±äº«é™æ€å˜é‡ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç±»åæ¥è®¿é—®å®ƒã€‚é™æ€å˜é‡åœ¨å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä»½ã€‚\nå®ä¾‹å˜é‡ï¼šæ¯åˆ›å»ºä¸€ä¸ªå®ä¾‹å°±ä¼šäº§ç”Ÿä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œå®ƒä¸è¯¥å®ä¾‹åŒç”Ÿå…±æ­»ã€‚\n\npublic class A &#123;\n\n    private int x;         // å®ä¾‹å˜é‡\n    private static int y;  // é™æ€å˜é‡\n\n    public static void main(String[] args) &#123;\n        // int x = A.x;  // Non-static field 'x' cannot be referenced from a static context\n        A a = new A();\n        int x = a.x;\n        int y = A.y;\n    &#125;\n&#125;\n\n2. é™æ€æ–¹æ³•é™æ€æ–¹æ³•åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å­˜åœ¨äº†ï¼Œå®ƒä¸ä¾èµ–äºä»»ä½•å®ä¾‹ã€‚æ‰€ä»¥é™æ€æ–¹æ³•å¿…é¡»æœ‰å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½æ˜¯æŠ½è±¡æ–¹æ³•ã€‚\npublic abstract class A &#123;\n    public static void func1()&#123;\n    &#125;\n    // public abstract static void func2();  // Illegal combination of modifiers: 'abstract' and 'static'\n&#125;\n\nåªèƒ½è®¿é—®æ‰€å±ç±»çš„é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•ï¼Œæ–¹æ³•ä¸­ä¸èƒ½æœ‰ this å’Œ super å…³é”®å­—ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå…³é”®å­—ä¸å…·ä½“å¯¹è±¡å…³è”ã€‚\npublic class A &#123;\n\n    private static int x;\n    private int y;\n\n    public static void func1()&#123;\n        int a = x;\n        // int b = y;  // Non-static field 'y' cannot be referenced from a static context\n        // int b = this.y;     // 'A.this' cannot be referenced from a static context\n    &#125;\n&#125;\n\n3. é™æ€è¯­å¥å—é™æ€è¯­å¥å—åœ¨ç±»åˆå§‹åŒ–æ—¶è¿è¡Œä¸€æ¬¡ã€‚\npublic class A &#123;\n    static &#123;\n        System.out.println(\"123\");\n    &#125;\n\n    public static void main(String[] args) &#123;\n        A a1 = new A();\n        A a2 = new A();\n    &#125;\n&#125;\n\n// åªä¼šæ‰“å°ä¸€æ¬¡\n123\n\n4. é™æ€å†…éƒ¨ç±»éé™æ€å†…éƒ¨ç±»ä¾èµ–äºå¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦å…ˆåˆ›å»ºå¤–éƒ¨ç±»å®ä¾‹ï¼Œæ‰èƒ½ç”¨è¿™ä¸ªå®ä¾‹å»åˆ›å»ºéé™æ€å†…éƒ¨ç±»ã€‚è€Œé™æ€å†…éƒ¨ç±»ä¸éœ€è¦ã€‚\npublic class OuterClass &#123;\n\n    class InnerClass &#123;\n    &#125;\n\n    static class StaticInnerClass &#123;\n    &#125;\n\n    public static void main(String[] args) &#123;\n        // InnerClass innerClass = new InnerClass(); // 'OuterClass.this' cannot be referenced from a static context\n        OuterClass outerClass = new OuterClass();\n        InnerClass innerClass = outerClass.new InnerClass();\n        StaticInnerClass staticInnerClass = new StaticInnerClass();\n    &#125;\n&#125;\n\né™æ€å†…éƒ¨ç±»ä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€çš„å˜é‡å’Œæ–¹æ³•ã€‚\n5. é™æ€å¯¼åŒ…åœ¨ä½¿ç”¨é™æ€å˜é‡å’Œæ–¹æ³•æ—¶ä¸ç”¨å†æŒ‡æ˜ ClassNameï¼Œä»è€Œç®€åŒ–ä»£ç ï¼Œä½†å¯è¯»æ€§å¤§å¤§é™ä½ã€‚\nimport static com.xxx.ClassName.*\n\n6. åˆå§‹åŒ–é¡ºåºé™æ€å˜é‡å’Œé™æ€è¯­å¥å—ä¼˜å…ˆäºå®ä¾‹å˜é‡å’Œæ™®é€šè¯­å¥å—ï¼Œé™æ€å˜é‡å’Œé™æ€è¯­å¥å—çš„åˆå§‹åŒ–é¡ºåºå–å†³äºå®ƒä»¬åœ¨ä»£ç ä¸­çš„é¡ºåºã€‚\npublic static String staticField = \"é™æ€å˜é‡\";\n\nstatic &#123;\n    System.out.println(\"é™æ€è¯­å¥å—\");\n&#125;\n\npublic String field = \"å®ä¾‹å˜é‡\";\n\n&#123;\n    System.out.println(\"æ™®é€šè¯­å¥å—\");\n&#125;\n\næœ€åæ‰æ˜¯æ„é€ å‡½æ•°çš„åˆå§‹åŒ–ã€‚\npublic InitialOrderTest() &#123;\n    System.out.println(\"æ„é€ å‡½æ•°\");\n&#125;\n\nå­˜åœ¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œåˆå§‹åŒ–é¡ºåºä¸ºï¼š\n\nçˆ¶ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰\nå­ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰\nçˆ¶ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰\nçˆ¶ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰\nå­ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰\nå­ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰\n\näº”ã€Object é€šç”¨æ–¹æ³•æ¦‚è§ˆpublic native int hashCode()\n\npublic boolean equals(Object obj)\n\nprotected native Object clone() throws CloneNotSupportedException\n\npublic String toString()\n\npublic final native Class&lt;?> getClass()\n\nprotected void finalize() throws Throwable &#123;&#125;\n\npublic final native void notify()\n\npublic final native void notifyAll()\n\npublic final native void wait(long timeout) throws InterruptedException\n\npublic final void wait(long timeout, int nanos) throws InterruptedException\n\npublic final void wait() throws InterruptedException\n\nequals()1. ç­‰ä»·å…³ç³»ä¸¤ä¸ªå¯¹è±¡å…·æœ‰ç­‰ä»·å…³ç³»ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹äº”ä¸ªæ¡ä»¶ï¼š\nâ…  è‡ªåæ€§x.equals(x); // true\n\nâ…¡ å¯¹ç§°æ€§x.equals(y) == y.equals(x); // true\n\nâ…¢ ä¼ é€’æ€§if (x.equals(y) &amp;&amp; y.equals(z))\n    x.equals(z); // true;\n\nâ…£ ä¸€è‡´æ€§å¤šæ¬¡è°ƒç”¨ equals() æ–¹æ³•ç»“æœä¸å˜\nx.equals(y) == x.equals(y); // true\n\nâ…¤ ä¸ null çš„æ¯”è¾ƒå¯¹ä»»ä½•ä¸æ˜¯ null çš„å¯¹è±¡ x è°ƒç”¨ x.equals(null) ç»“æœéƒ½ä¸º false\nx.equals(null); // false;\n\n2. ç­‰ä»·ä¸ç›¸ç­‰\nå¯¹äºåŸºæœ¬ç±»å‹ï¼Œ&#x3D;&#x3D; åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼ŒåŸºæœ¬ç±»å‹æ²¡æœ‰ equals() æ–¹æ³•ã€‚\nå¯¹äºå¼•ç”¨ç±»å‹ï¼Œ&#x3D;&#x3D; åˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ equals() åˆ¤æ–­å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦ç­‰ä»·ã€‚\n\nInteger x = new Integer(1);\nInteger y = new Integer(1);\nSystem.out.println(x.equals(y)); // true\nSystem.out.println(x == y);      // false\n\n3. å®ç°\næ£€æŸ¥æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå¦‚æœæ˜¯ç›´æ¥è¿”å› trueï¼›\næ£€æŸ¥æ˜¯å¦æ˜¯åŒä¸€ä¸ªç±»å‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œç›´æ¥è¿”å› falseï¼›\nå°† Object å¯¹è±¡è¿›è¡Œè½¬å‹ï¼›\nåˆ¤æ–­æ¯ä¸ªå…³é”®åŸŸæ˜¯å¦ç›¸ç­‰ã€‚\n\npublic class EqualExample &#123;\n\n    private int x;\n    private int y;\n    private int z;\n\n    public EqualExample(int x, int y, int z) &#123;\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    &#125;\n\n    @Override\n    public boolean equals(Object o) &#123;\n        if (this == o) return true;\n        if (o == null || getClass() != o.getClass()) return false;\n\n        EqualExample that = (EqualExample) o;\n\n        if (x != that.x) return false;\n        if (y != that.y) return false;\n        return z == that.z;\n    &#125;\n&#125;\n\nhashCode()hashCode() è¿”å›å“ˆå¸Œå€¼ï¼Œè€Œ equals() æ˜¯ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç­‰ä»·ã€‚ç­‰ä»·çš„ä¸¤ä¸ªå¯¹è±¡æ•£åˆ—å€¼ä¸€å®šç›¸åŒï¼Œä½†æ˜¯æ•£åˆ—å€¼ç›¸åŒçš„ä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šç­‰ä»·ï¼Œè¿™æ˜¯å› ä¸ºè®¡ç®—å“ˆå¸Œå€¼å…·æœ‰éšæœºæ€§ï¼Œä¸¤ä¸ªå€¼ä¸åŒçš„å¯¹è±¡å¯èƒ½è®¡ç®—å‡ºç›¸åŒçš„å“ˆå¸Œå€¼ã€‚\nåœ¨è¦†ç›– equals() æ–¹æ³•æ—¶åº”å½“æ€»æ˜¯è¦†ç›– hashCode() æ–¹æ³•ï¼Œä¿è¯ç­‰ä»·çš„ä¸¤ä¸ªå¯¹è±¡å“ˆå¸Œå€¼ä¹Ÿç›¸ç­‰ã€‚\nHashSet Â å’Œ HashMap ç­‰é›†åˆç±»ä½¿ç”¨äº† hashCode() Â æ–¹æ³•æ¥è®¡ç®—å¯¹è±¡åº”è¯¥å­˜å‚¨çš„ä½ç½®ï¼Œå› æ­¤è¦å°†å¯¹è±¡æ·»åŠ åˆ°è¿™äº›é›†åˆç±»ä¸­ï¼Œéœ€è¦è®©å¯¹åº”çš„ç±»å®ç° hashCode() Â æ–¹æ³•ã€‚\nä¸‹é¢çš„ä»£ç ä¸­ï¼Œæ–°å»ºäº†ä¸¤ä¸ªç­‰ä»·çš„å¯¹è±¡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ° HashSet ä¸­ã€‚æˆ‘ä»¬å¸Œæœ›å°†è¿™ä¸¤ä¸ªå¯¹è±¡å½“æˆä¸€æ ·çš„ï¼Œåªåœ¨é›†åˆä¸­æ·»åŠ ä¸€ä¸ªå¯¹è±¡ã€‚ä½†æ˜¯ EqualExample æ²¡æœ‰å®ç° hashCode() æ–¹æ³•ï¼Œå› æ­¤è¿™ä¸¤ä¸ªå¯¹è±¡çš„å“ˆå¸Œå€¼æ˜¯ä¸åŒçš„ï¼Œæœ€ç»ˆå¯¼è‡´é›†åˆæ·»åŠ äº†ä¸¤ä¸ªç­‰ä»·çš„å¯¹è±¡ã€‚\nEqualExample e1 = new EqualExample(1, 1, 1);\nEqualExample e2 = new EqualExample(1, 1, 1);\nSystem.out.println(e1.equals(e2)); // true\nHashSet&lt;EqualExample> set = new HashSet&lt;>();\nset.add(e1);\nset.add(e2);\nSystem.out.println(set.size());   // 2\n\nç†æƒ³çš„å“ˆå¸Œå‡½æ•°åº”å½“å…·æœ‰å‡åŒ€æ€§ï¼Œå³ä¸ç›¸ç­‰çš„å¯¹è±¡åº”å½“å‡åŒ€åˆ†å¸ƒåˆ°æ‰€æœ‰å¯èƒ½çš„å“ˆå¸Œå€¼ä¸Šã€‚è¿™å°±è¦æ±‚äº†å“ˆå¸Œå‡½æ•°è¦æŠŠæ‰€æœ‰åŸŸçš„å€¼éƒ½è€ƒè™‘è¿›æ¥ã€‚å¯ä»¥å°†æ¯ä¸ªåŸŸéƒ½å½“æˆ R è¿›åˆ¶çš„æŸä¸€ä½ï¼Œç„¶åç»„æˆä¸€ä¸ª R è¿›åˆ¶çš„æ•´æ•°ã€‚\nR ä¸€èˆ¬å– 31ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå¥‡ç´ æ•°ï¼Œå¦‚æœæ˜¯å¶æ•°çš„è¯ï¼Œå½“å‡ºç°ä¹˜æ³•æº¢å‡ºï¼Œä¿¡æ¯å°±ä¼šä¸¢å¤±ï¼Œå› ä¸ºä¸ 2 ç›¸ä¹˜ç›¸å½“äºå‘å·¦ç§»ä¸€ä½ï¼Œæœ€å·¦è¾¹çš„ä½ä¸¢å¤±ã€‚å¹¶ä¸”ä¸€ä¸ªæ•°ä¸ 31 ç›¸ä¹˜å¯ä»¥è½¬æ¢æˆç§»ä½å’Œå‡æ³•ï¼š31*x == (x&lt;&lt;5)-xï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œè¿™ä¸ªä¼˜åŒ–ã€‚\n@Override\npublic int hashCode() &#123;\n    int result = 17;\n    result = 31 * result + x;\n    result = 31 * result + y;\n    result = 31 * result + z;\n    return result;\n&#125;\n\ntoString()é»˜è®¤è¿”å› ToStringExample@4554617c  è¿™ç§å½¢å¼ï¼Œå…¶ä¸­ @ åé¢çš„æ•°å€¼ä¸ºæ•£åˆ—ç çš„æ— ç¬¦å·åå…­è¿›åˆ¶è¡¨ç¤ºã€‚ \npublic class ToStringExample &#123;\n\n    private int number;\n\n    public ToStringExample(int number) &#123;\n        this.number = number;\n    &#125;\n&#125;\n\nToStringExample example = new ToStringExample(123);\nSystem.out.println(example.toString());\n\nToStringExample@4554617c\n\nclone()1. cloneableclone() æ˜¯ Object çš„ protected æ–¹æ³•ï¼Œå®ƒä¸æ˜¯ publicï¼Œä¸€ä¸ªç±»ä¸æ˜¾å¼å»é‡å†™ clone()ï¼Œå…¶å®ƒç±»å°±ä¸èƒ½ç›´æ¥å»è°ƒç”¨è¯¥ç±»å®ä¾‹çš„ clone() æ–¹æ³•ã€‚\npublic class CloneExample &#123;\n    private int a;\n    private int b;\n&#125;\n\nCloneExample e1 = new CloneExample();\n// CloneExample e2 = e1.clone(); // 'clone()' has protected access in 'java.lang.Object'\n\né‡å†™ clone() å¾—åˆ°ä»¥ä¸‹å®ç°ï¼š\npublic class CloneExample &#123;\n    private int a;\n    private int b;\n\n    @Override\n    public CloneExample clone() throws CloneNotSupportedException &#123;\n        return (CloneExample)super.clone();\n    &#125;\n&#125;\n\nCloneExample e1 = new CloneExample();\ntry &#123;\n    CloneExample e2 = e1.clone();\n&#125; catch (CloneNotSupportedException e) &#123;\n    e.printStackTrace();\n&#125;\n\njava.lang.CloneNotSupportedException: CloneExample\n\nä»¥ä¸ŠæŠ›å‡ºäº† CloneNotSupportedExceptionï¼Œè¿™æ˜¯å› ä¸º CloneExample æ²¡æœ‰å®ç° Cloneable æ¥å£ã€‚\nåº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œclone() æ–¹æ³•å¹¶ä¸æ˜¯ Cloneable æ¥å£çš„æ–¹æ³•ï¼Œè€Œæ˜¯ Object çš„ä¸€ä¸ª protected æ–¹æ³•ã€‚Cloneable æ¥å£åªæ˜¯è§„å®šï¼Œå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç° Cloneable æ¥å£åˆè°ƒç”¨äº† clone() æ–¹æ³•ï¼Œå°±ä¼šæŠ›å‡º CloneNotSupportedExceptionã€‚\npublic class CloneExample implements Cloneable &#123;\n    private int a;\n    private int b;\n\n    @Override\n    public Object clone() throws CloneNotSupportedException &#123;\n        return super.clone();\n    &#125;\n&#125;\n\n2. æµ…æ‹·è´æ‹·è´å¯¹è±¡å’ŒåŸå§‹å¯¹è±¡çš„å¼•ç”¨ç±»å‹å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ã€‚\npublic class ShallowCloneExample implements Cloneable &#123;\n\n    private int[] arr;\n\n    public ShallowCloneExample() &#123;\n        arr = new int[10];\n        for (int i = 0; i &lt; arr.length; i++) &#123;\n            arr[i] = i;\n        &#125;\n    &#125;\n\n    public void set(int index, int value) &#123;\n        arr[index] = value;\n    &#125;\n\n    public int get(int index) &#123;\n        return arr[index];\n    &#125;\n\n    @Override\n    protected ShallowCloneExample clone() throws CloneNotSupportedException &#123;\n        return (ShallowCloneExample) super.clone();\n    &#125;\n&#125;\n\nShallowCloneExample e1 = new ShallowCloneExample();\nShallowCloneExample e2 = null;\ntry &#123;\n    e2 = e1.clone();\n&#125; catch (CloneNotSupportedException e) &#123;\n    e.printStackTrace();\n&#125;\ne1.set(2, 222);\nSystem.out.println(e2.get(2)); // 222\n\n3. æ·±æ‹·è´æ‹·è´å¯¹è±¡å’ŒåŸå§‹å¯¹è±¡çš„å¼•ç”¨ç±»å‹å¼•ç”¨ä¸åŒå¯¹è±¡ã€‚\npublic class DeepCloneExample implements Cloneable &#123;\n\n    private int[] arr;\n\n    public DeepCloneExample() &#123;\n        arr = new int[10];\n        for (int i = 0; i &lt; arr.length; i++) &#123;\n            arr[i] = i;\n        &#125;\n    &#125;\n\n    public void set(int index, int value) &#123;\n        arr[index] = value;\n    &#125;\n\n    public int get(int index) &#123;\n        return arr[index];\n    &#125;\n\n    @Override\n    protected DeepCloneExample clone() throws CloneNotSupportedException &#123;\n        DeepCloneExample result = (DeepCloneExample) super.clone();\n        result.arr = new int[arr.length];\n        for (int i = 0; i &lt; arr.length; i++) &#123;\n            result.arr[i] = arr[i];\n        &#125;\n        return result;\n    &#125;\n&#125;\n\nDeepCloneExample e1 = new DeepCloneExample();\nDeepCloneExample e2 = null;\ntry &#123;\n    e2 = e1.clone();\n&#125; catch (CloneNotSupportedException e) &#123;\n    e.printStackTrace();\n&#125;\ne1.set(2, 222);\nSystem.out.println(e2.get(2)); // 2\n\n4. clone() çš„æ›¿ä»£æ–¹æ¡ˆä½¿ç”¨ clone() æ–¹æ³•æ¥æ‹·è´ä¸€ä¸ªå¯¹è±¡å³å¤æ‚åˆæœ‰é£é™©ï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ä¸”è¿˜éœ€è¦ç±»å‹è½¬æ¢ã€‚Effective Java ä¹¦ä¸Šè®²åˆ°ï¼Œæœ€å¥½ä¸è¦å»ä½¿ç”¨ clone()ï¼Œå¯ä»¥ä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°æˆ–è€…æ‹·è´å·¥å‚æ¥æ‹·è´ä¸€ä¸ªå¯¹è±¡ã€‚\npublic class CloneConstructorExample &#123;\n\n    private int[] arr;\n\n    public CloneConstructorExample() &#123;\n        arr = new int[10];\n        for (int i = 0; i &lt; arr.length; i++) &#123;\n            arr[i] = i;\n        &#125;\n    &#125;\n\n    public CloneConstructorExample(CloneConstructorExample original) &#123;\n        arr = new int[original.arr.length];\n        for (int i = 0; i &lt; original.arr.length; i++) &#123;\n            arr[i] = original.arr[i];\n        &#125;\n    &#125;\n\n    public void set(int index, int value) &#123;\n        arr[index] = value;\n    &#125;\n\n    public int get(int index) &#123;\n        return arr[index];\n    &#125;\n&#125;\n\nCloneConstructorExample e1 = new CloneConstructorExample();\nCloneConstructorExample e2 = new CloneConstructorExample(e1);\ne1.set(2, 222);\nSystem.out.println(e2.get(2)); // 2\n\nå…­ã€ç»§æ‰¿è®¿é—®æƒé™Java ä¸­æœ‰ä¸‰ä¸ªè®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼šprivateã€protected ä»¥åŠ publicï¼Œå¦‚æœä¸åŠ è®¿é—®ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºåŒ…çº§å¯è§ã€‚\nå¯ä»¥å¯¹ç±»æˆ–ç±»ä¸­çš„æˆå‘˜ï¼ˆå­—æ®µå’Œæ–¹æ³•ï¼‰åŠ ä¸Šè®¿é—®ä¿®é¥°ç¬¦ã€‚\n\nç±»å¯è§è¡¨ç¤ºå…¶å®ƒç±»å¯ä»¥ç”¨è¿™ä¸ªç±»åˆ›å»ºå®ä¾‹å¯¹è±¡ã€‚\næˆå‘˜å¯è§è¡¨ç¤ºå…¶å®ƒç±»å¯ä»¥ç”¨è¿™ä¸ªç±»çš„å®ä¾‹å¯¹è±¡è®¿é—®åˆ°è¯¥æˆå‘˜ï¼›\n\nprotected ç”¨äºä¿®é¥°æˆå‘˜ï¼Œè¡¨ç¤ºåœ¨ç»§æ‰¿ä½“ç³»ä¸­æˆå‘˜å¯¹äºå­ç±»å¯è§ï¼Œä½†æ˜¯è¿™ä¸ªè®¿é—®ä¿®é¥°ç¬¦å¯¹äºç±»æ²¡æœ‰æ„ä¹‰ã€‚\nè®¾è®¡è‰¯å¥½çš„æ¨¡å—ä¼šéšè—æ‰€æœ‰çš„å®ç°ç»†èŠ‚ï¼ŒæŠŠå®ƒçš„ API ä¸å®ƒçš„å®ç°æ¸…æ™°åœ°éš”ç¦»å¼€æ¥ã€‚æ¨¡å—ä¹‹é—´åªé€šè¿‡å®ƒä»¬çš„ API è¿›è¡Œé€šä¿¡ï¼Œä¸€ä¸ªæ¨¡å—ä¸éœ€è¦çŸ¥é“å…¶ä»–æ¨¡å—çš„å†…éƒ¨å·¥ä½œæƒ…å†µï¼Œè¿™ä¸ªæ¦‚å¿µè¢«ç§°ä¸ºä¿¡æ¯éšè—æˆ–å°è£…ã€‚å› æ­¤è®¿é—®æƒé™åº”å½“å°½å¯èƒ½åœ°ä½¿æ¯ä¸ªç±»æˆ–è€…æˆå‘˜ä¸è¢«å¤–ç•Œè®¿é—®ã€‚\nå¦‚æœå­ç±»çš„æ–¹æ³•é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»ä¸­è¯¥æ–¹æ³•çš„è®¿é—®çº§åˆ«ä¸å…è®¸ä½äºçˆ¶ç±»çš„è®¿é—®çº§åˆ«ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿å¯ä»¥ä½¿ç”¨çˆ¶ç±»å®ä¾‹çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å­ç±»å®ä¾‹å»ä»£æ›¿ï¼Œä¹Ÿå°±æ˜¯ç¡®ä¿æ»¡è¶³é‡Œæ°æ›¿æ¢åŸåˆ™ã€‚\nå­—æ®µå†³ä¸èƒ½æ˜¯å…¬æœ‰çš„ï¼Œå› ä¸ºè¿™ä¹ˆåšçš„è¯å°±å¤±å»äº†å¯¹è¿™ä¸ªå­—æ®µä¿®æ”¹è¡Œä¸ºçš„æ§åˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥å¯¹å…¶éšæ„ä¿®æ”¹ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒAccessExample æ‹¥æœ‰ id å…¬æœ‰å­—æ®µï¼Œå¦‚æœåœ¨æŸä¸ªæ—¶åˆ»ï¼Œæˆ‘ä»¬æƒ³è¦ä½¿ç”¨ int å­˜å‚¨ id å­—æ®µï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿®æ”¹æ‰€æœ‰çš„å®¢æˆ·ç«¯ä»£ç ã€‚\npublic class AccessExample &#123;\n    public String id;\n&#125;\n\nå¯ä»¥ä½¿ç”¨å…¬æœ‰çš„ getter å’Œ setter æ–¹æ³•æ¥æ›¿æ¢å…¬æœ‰å­—æ®µï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥æ§åˆ¶å¯¹å­—æ®µçš„ä¿®æ”¹è¡Œä¸ºã€‚\npublic class AccessExample &#123;\n\n    private int id;\n\n    public String getId() &#123;\n        return id + \"\";\n    &#125;\n\n    public void setId(String id) &#123;\n        this.id = Integer.valueOf(id);\n    &#125;\n&#125;\n\nä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–ï¼Œå¦‚æœæ˜¯åŒ…çº§ç§æœ‰çš„ç±»æˆ–è€…ç§æœ‰çš„åµŒå¥—ç±»ï¼Œé‚£ä¹ˆç›´æ¥æš´éœ²æˆå‘˜ä¸ä¼šæœ‰ç‰¹åˆ«å¤§çš„å½±å“ã€‚\npublic class AccessWithInnerClassExample &#123;\n\n    private class InnerClass &#123;\n        int x;\n    &#125;\n\n    private InnerClass innerClass;\n\n    public AccessWithInnerClassExample() &#123;\n        innerClass = new InnerClass();\n    &#125;\n\n    public int getValue() &#123;\n        return innerClass.x;  // ç›´æ¥è®¿é—®\n    &#125;\n&#125;\n\næŠ½è±¡ç±»ä¸æ¥å£1. æŠ½è±¡ç±»æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•éƒ½ä½¿ç”¨ abstract å…³é”®å­—è¿›è¡Œå£°æ˜ã€‚å¦‚æœä¸€ä¸ªç±»ä¸­åŒ…å«æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å¿…é¡»å£°æ˜ä¸ºæŠ½è±¡ç±»ã€‚\næŠ½è±¡ç±»å’Œæ™®é€šç±»æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼ŒæŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œåªèƒ½è¢«ç»§æ‰¿ã€‚\npublic abstract class AbstractClassExample &#123;\n\n    protected int x;\n    private int y;\n\n    public abstract void func1();\n\n    public void func2() &#123;\n        System.out.println(\"func2\");\n    &#125;\n&#125;\n\npublic class AbstractExtendClassExample extends AbstractClassExample &#123;\n    @Override\n    public void func1() &#123;\n        System.out.println(\"func1\");\n    &#125;\n&#125;\n\n// AbstractClassExample ac1 = new AbstractClassExample(); // 'AbstractClassExample' is abstract; cannot be instantiated\nAbstractClassExample ac2 = new AbstractExtendClassExample();\nac2.func1();\n\n2. æ¥å£æ¥å£æ˜¯æŠ½è±¡ç±»çš„å»¶ä¼¸ï¼Œåœ¨ Java 8 ä¹‹å‰ï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå®Œå…¨æŠ½è±¡çš„ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½æœ‰ä»»ä½•çš„æ–¹æ³•å®ç°ã€‚\nä» Java 8 å¼€å§‹ï¼Œæ¥å£ä¹Ÿå¯ä»¥æ‹¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°ï¼Œè¿™æ˜¯å› ä¸ºä¸æ”¯æŒé»˜è®¤æ–¹æ³•çš„æ¥å£çš„ç»´æŠ¤æˆæœ¬å¤ªé«˜äº†ã€‚åœ¨ Java 8 ä¹‹å‰ï¼Œå¦‚æœä¸€ä¸ªæ¥å£æƒ³è¦æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¦ä¿®æ”¹æ‰€æœ‰å®ç°äº†è¯¥æ¥å£çš„ç±»ï¼Œè®©å®ƒä»¬éƒ½å®ç°æ–°å¢çš„æ–¹æ³•ã€‚\næ¥å£çš„æˆå‘˜ï¼ˆå­—æ®µ + æ–¹æ³•ï¼‰é»˜è®¤éƒ½æ˜¯ public çš„ï¼Œå¹¶ä¸”ä¸å…è®¸å®šä¹‰ä¸º private æˆ–è€… protectedã€‚ä» Java 9 å¼€å§‹ï¼Œå…è®¸å°†æ–¹æ³•å®šä¹‰ä¸º privateï¼Œè¿™æ ·å°±èƒ½å®šä¹‰æŸäº›å¤ç”¨çš„ä»£ç åˆä¸ä¼šæŠŠæ–¹æ³•æš´éœ²å‡ºå»ã€‚\næ¥å£çš„å­—æ®µé»˜è®¤éƒ½æ˜¯ static å’Œ final çš„ã€‚\npublic interface InterfaceExample &#123;\n\n    void func1();\n\n    default void func2()&#123;\n        System.out.println(\"func2\");\n    &#125;\n\n    int x = 123;\n    // int y;               // Variable 'y' might not have been initialized\n    public int z = 0;       // Modifier 'public' is redundant for interface fields\n    // private int k = 0;   // Modifier 'private' not allowed here\n    // protected int l = 0; // Modifier 'protected' not allowed here\n    // private void fun3(); // Modifier 'private' not allowed here\n&#125;\n\npublic class InterfaceImplementExample implements InterfaceExample &#123;\n    @Override\n    public void func1() &#123;\n        System.out.println(\"func1\");\n    &#125;\n&#125;\n\n// InterfaceExample ie1 = new InterfaceExample(); // 'InterfaceExample' is abstract; cannot be instantiated\nInterfaceExample ie2 = new InterfaceImplementExample();\nie2.func1();\nSystem.out.println(InterfaceExample.x);\n\n3. æ¯”è¾ƒ\nä»è®¾è®¡å±‚é¢ä¸Šçœ‹ï¼ŒæŠ½è±¡ç±»æä¾›äº†ä¸€ç§ IS-A å…³ç³»ï¼Œéœ€è¦æ»¡è¶³é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œå³å­ç±»å¯¹è±¡å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰æ‰€æœ‰çˆ¶ç±»å¯¹è±¡ã€‚è€Œæ¥å£æ›´åƒæ˜¯ä¸€ç§ LIKE-A å…³ç³»ï¼Œå®ƒåªæ˜¯æä¾›ä¸€ç§æ–¹æ³•å®ç°å¥‘çº¦ï¼Œå¹¶ä¸è¦æ±‚æ¥å£å’Œå®ç°æ¥å£çš„ç±»å…·æœ‰ IS-A å…³ç³»ã€‚\nä»ä½¿ç”¨ä¸Šæ¥çœ‹ï¼Œä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä½†æ˜¯ä¸èƒ½ç»§æ‰¿å¤šä¸ªæŠ½è±¡ç±»ã€‚\næ¥å£çš„å­—æ®µåªèƒ½æ˜¯ static å’Œ final ç±»å‹çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„å­—æ®µæ²¡æœ‰è¿™ç§é™åˆ¶ã€‚\næ¥å£çš„æˆå‘˜åªèƒ½æ˜¯ public çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„æˆå‘˜å¯ä»¥æœ‰å¤šç§è®¿é—®æƒé™ã€‚\n\n4. ä½¿ç”¨é€‰æ‹©ä½¿ç”¨æ¥å£ï¼š\n\néœ€è¦è®©ä¸ç›¸å…³çš„ç±»éƒ½å®ç°ä¸€ä¸ªæ–¹æ³•ï¼Œä¾‹å¦‚ä¸ç›¸å…³çš„ç±»éƒ½å¯ä»¥å®ç° Comparable æ¥å£ä¸­çš„ compareTo() æ–¹æ³•ï¼›\néœ€è¦ä½¿ç”¨å¤šé‡ç»§æ‰¿ã€‚\n\nä½¿ç”¨æŠ½è±¡ç±»ï¼š\n\néœ€è¦åœ¨å‡ ä¸ªç›¸å…³çš„ç±»ä¸­å…±äº«ä»£ç ã€‚\néœ€è¦èƒ½æ§åˆ¶ç»§æ‰¿æ¥çš„æˆå‘˜çš„è®¿é—®æƒé™ï¼Œè€Œä¸æ˜¯éƒ½ä¸º publicã€‚\néœ€è¦ç»§æ‰¿éé™æ€å’Œéå¸¸é‡å­—æ®µã€‚\n\nåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ¥å£ä¼˜å…ˆäºæŠ½è±¡ç±»ã€‚å› ä¸ºæ¥å£æ²¡æœ‰æŠ½è±¡ç±»ä¸¥æ ¼çš„ç±»å±‚æ¬¡ç»“æ„è¦æ±‚ï¼Œå¯ä»¥çµæ´»åœ°ä¸ºä¸€ä¸ªç±»æ·»åŠ è¡Œä¸ºã€‚å¹¶ä¸”ä» Java 8 å¼€å§‹ï¼Œæ¥å£ä¹Ÿå¯ä»¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°ï¼Œä½¿å¾—ä¿®æ”¹æ¥å£çš„æˆæœ¬ä¹Ÿå˜çš„å¾ˆä½ã€‚\n\nAbstract Methods and Classes\næ·±å…¥ç†è§£ abstract class å’Œ interface\nWhen to Use Abstract Class and Interface\nJava 9 Private Methods in Interfaces\n\nsuper\nè®¿é—®çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼šå¯ä»¥ä½¿ç”¨ super() å‡½æ•°è®¿é—®çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œä»è€Œå§”æ‰˜çˆ¶ç±»å®Œæˆä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œã€‚åº”è¯¥æ³¨æ„åˆ°ï¼Œå­ç±»ä¸€å®šä¼šè°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°æ¥å®Œæˆåˆå§‹åŒ–å·¥ä½œï¼Œä¸€èˆ¬æ˜¯è°ƒç”¨çˆ¶ç±»çš„é»˜è®¤æ„é€ å‡½æ•°ï¼Œå¦‚æœå­ç±»éœ€è¦è°ƒç”¨çˆ¶ç±»å…¶å®ƒæ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ super() å‡½æ•°ã€‚\nè®¿é—®çˆ¶ç±»çš„æˆå‘˜ï¼šå¦‚æœå­ç±»é‡å†™äº†çˆ¶ç±»çš„æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ super å…³é”®å­—æ¥å¼•ç”¨çˆ¶ç±»çš„æ–¹æ³•å®ç°ã€‚\n\npublic class SuperExample &#123;\n\n    protected int x;\n    protected int y;\n\n    public SuperExample(int x, int y) &#123;\n        this.x = x;\n        this.y = y;\n    &#125;\n\n    public void func() &#123;\n        System.out.println(\"SuperExample.func()\");\n    &#125;\n&#125;\n\npublic class SuperExtendExample extends SuperExample &#123;\n\n    private int z;\n\n    public SuperExtendExample(int x, int y, int z) &#123;\n        super(x, y);\n        this.z = z;\n    &#125;\n\n    @Override\n    public void func() &#123;\n        super.func();\n        System.out.println(\"SuperExtendExample.func()\");\n    &#125;\n&#125;\n\nSuperExample e = new SuperExtendExample(1, 2, 3);\ne.func();\n\nSuperExample.func()\nSuperExtendExample.func()\n\nUsing the Keyword super\né‡å†™ä¸é‡è½½1. é‡å†™ï¼ˆOverrideï¼‰å­˜åœ¨äºç»§æ‰¿ä½“ç³»ä¸­ï¼ŒæŒ‡å­ç±»å®ç°äº†ä¸€ä¸ªä¸çˆ¶ç±»åœ¨æ–¹æ³•å£°æ˜ä¸Šå®Œå…¨ç›¸åŒçš„ä¸€ä¸ªæ–¹æ³•ã€‚\nä¸ºäº†æ»¡è¶³é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œé‡å†™æœ‰ä»¥ä¸‹ä¸‰ä¸ªé™åˆ¶ï¼š\n\nå­ç±»æ–¹æ³•çš„è®¿é—®æƒé™å¿…é¡»å¤§äºç­‰äºçˆ¶ç±»æ–¹æ³•ï¼›\nå­ç±»æ–¹æ³•çš„è¿”å›ç±»å‹å¿…é¡»æ˜¯çˆ¶ç±»æ–¹æ³•è¿”å›ç±»å‹æˆ–ä¸ºå…¶å­ç±»å‹ã€‚\nå­ç±»æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹å¿…é¡»æ˜¯çˆ¶ç±»æŠ›å‡ºå¼‚å¸¸ç±»å‹æˆ–ä¸ºå…¶å­ç±»å‹ã€‚\n\nä½¿ç”¨ @Override  æ³¨è§£ï¼Œå¯ä»¥è®©ç¼–è¯‘å™¨å¸®å¿™æ£€æŸ¥æ˜¯å¦æ»¡è¶³ä¸Šé¢çš„ä¸‰ä¸ªé™åˆ¶æ¡ä»¶ã€‚ \nä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼ŒSubClass ä¸º SuperClass çš„å­ç±»ï¼ŒSubClass é‡å†™äº† SuperClass çš„ func() æ–¹æ³•ã€‚å…¶ä¸­ï¼š\n\nå­ç±»æ–¹æ³•è®¿é—®æƒé™ä¸º publicï¼Œå¤§äºçˆ¶ç±»çš„ protectedã€‚\nå­ç±»çš„è¿”å›ç±»å‹ä¸º ArrayListï¼Œæ˜¯çˆ¶ç±»è¿”å›ç±»å‹ List çš„å­ç±»ã€‚\nå­ç±»æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ä¸º Exceptionï¼Œæ˜¯çˆ¶ç±»æŠ›å‡ºå¼‚å¸¸ Throwable çš„å­ç±»ã€‚\nå­ç±»é‡å†™æ–¹æ³•ä½¿ç”¨ @Override  æ³¨è§£ï¼Œä»è€Œè®©ç¼–è¯‘å™¨è‡ªåŠ¨æ£€æŸ¥æ˜¯å¦æ»¡è¶³é™åˆ¶æ¡ä»¶ã€‚\n\nclass SuperClass &#123;\n    protected List&lt;Integer> func() throws Throwable &#123;\n        return new ArrayList&lt;>();\n    &#125;\n&#125;\n\nclass SubClass extends SuperClass &#123;\n    @Override\n    public ArrayList&lt;Integer> func() throws Exception &#123;\n        return new ArrayList&lt;>();\n    &#125;\n&#125;\n\nåœ¨è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå…ˆä»æœ¬ç±»ä¸­æŸ¥æ‰¾çœ‹æ˜¯å¦æœ‰å¯¹åº”çš„æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰å†åˆ°çˆ¶ç±»ä¸­æŸ¥çœ‹ï¼Œçœ‹æ˜¯å¦ä»çˆ¶ç±»ç»§æ‰¿æ¥ã€‚å¦åˆ™å°±è¦å¯¹å‚æ•°è¿›è¡Œè½¬å‹ï¼Œè½¬æˆçˆ¶ç±»ä¹‹åçœ‹æ˜¯å¦æœ‰å¯¹åº”çš„æ–¹æ³•ã€‚æ€»çš„æ¥è¯´ï¼Œæ–¹æ³•è°ƒç”¨çš„ä¼˜å…ˆçº§ä¸ºï¼š\n\nthis.func(this)\nsuper.func(this)\nthis.func(super)\nsuper.func(super)\n\n/*\n    A\n    |\n    B\n    |\n    C\n    |\n    D\n */\n\n\nclass A &#123;\n\n    public void show(A obj) &#123;\n        System.out.println(\"A.show(A)\");\n    &#125;\n\n    public void show(C obj) &#123;\n        System.out.println(\"A.show(C)\");\n    &#125;\n&#125;\n\nclass B extends A &#123;\n\n    @Override\n    public void show(A obj) &#123;\n        System.out.println(\"B.show(A)\");\n    &#125;\n&#125;\n\nclass C extends B &#123;\n&#125;\n\nclass D extends C &#123;\n&#125;\n\npublic static void main(String[] args) &#123;\n\n    A a = new A();\n    B b = new B();\n    C c = new C();\n    D d = new D();\n\n    // åœ¨ A ä¸­å­˜åœ¨ show(A obj)ï¼Œç›´æ¥è°ƒç”¨\n    a.show(a); // A.show(A)\n    // åœ¨ A ä¸­ä¸å­˜åœ¨ show(B obj)ï¼Œå°† B è½¬å‹æˆå…¶çˆ¶ç±» A\n    a.show(b); // A.show(A)\n    // åœ¨ B ä¸­å­˜åœ¨ä» A ç»§æ‰¿æ¥çš„ show(C obj)ï¼Œç›´æ¥è°ƒç”¨\n    b.show(c); // A.show(C)\n    // åœ¨ B ä¸­ä¸å­˜åœ¨ show(D obj)ï¼Œä½†æ˜¯å­˜åœ¨ä» A ç»§æ‰¿æ¥çš„ show(C obj)ï¼Œå°† D è½¬å‹æˆå…¶çˆ¶ç±» C\n    b.show(d); // A.show(C)\n\n    // å¼•ç”¨çš„è¿˜æ˜¯ B å¯¹è±¡ï¼Œæ‰€ä»¥ ba å’Œ b çš„è°ƒç”¨ç»“æœä¸€æ ·\n    A ba = new B();\n    ba.show(c); // A.show(C)\n    ba.show(d); // A.show(C)\n&#125;\n\n2. é‡è½½ï¼ˆOverloadï¼‰å­˜åœ¨äºåŒä¸€ä¸ªç±»ä¸­ï¼ŒæŒ‡ä¸€ä¸ªæ–¹æ³•ä¸å·²ç»å­˜åœ¨çš„æ–¹æ³•åç§°ä¸Šç›¸åŒï¼Œä½†æ˜¯å‚æ•°ç±»å‹ã€ä¸ªæ•°ã€é¡ºåºè‡³å°‘æœ‰ä¸€ä¸ªä¸åŒã€‚\nåº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œè¿”å›å€¼ä¸åŒï¼Œå…¶å®ƒéƒ½ç›¸åŒä¸ç®—æ˜¯é‡è½½ã€‚\nclass OverloadingExample &#123;\n    public void show(int x) &#123;\n        System.out.println(x);\n    &#125;\n\n    public void show(int x, String y) &#123;\n        System.out.println(x + \" \" + y);\n    &#125;\n&#125;\n\npublic static void main(String[] args) &#123;\n    OverloadingExample example = new OverloadingExample();\n    example.show(1);\n    example.show(1, \"2\");\n&#125;\n\nä¸ƒã€åå°„æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ª Â  Class Â  å¯¹è±¡ï¼ŒåŒ…å«äº†ä¸ç±»æœ‰å…³çš„ä¿¡æ¯ã€‚å½“ç¼–è¯‘ä¸€ä¸ªæ–°ç±»æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªåŒåçš„ .class æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å†…å®¹ä¿å­˜ç€ Class å¯¹è±¡ã€‚\nç±»åŠ è½½ç›¸å½“äº Class å¯¹è±¡çš„åŠ è½½ï¼Œç±»åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰åŠ¨æ€åŠ è½½åˆ° JVM ä¸­ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ Class.forName(&quot;com.mysql.jdbc.Driver&quot;) è¿™ç§æ–¹å¼æ¥æ§åˆ¶ç±»çš„åŠ è½½ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª Class å¯¹è±¡ã€‚\nåå°„å¯ä»¥æä¾›è¿è¡Œæ—¶çš„ç±»ä¿¡æ¯ï¼Œå¹¶ä¸”è¿™ä¸ªç±»å¯ä»¥åœ¨è¿è¡Œæ—¶æ‰åŠ è½½è¿›æ¥ï¼Œç”šè‡³åœ¨ç¼–è¯‘æ—¶æœŸè¯¥ç±»çš„ .class ä¸å­˜åœ¨ä¹Ÿå¯ä»¥åŠ è½½è¿›æ¥ã€‚\nClass å’Œ java.lang.reflect ä¸€èµ·å¯¹åå°„æä¾›äº†æ”¯æŒï¼Œjava.lang.reflect ç±»åº“ä¸»è¦åŒ…å«äº†ä»¥ä¸‹ä¸‰ä¸ªç±»ï¼š\n\nField Â ï¼šå¯ä»¥ä½¿ç”¨ get() å’Œ set() æ–¹æ³•è¯»å–å’Œä¿®æ”¹ Field å¯¹è±¡å…³è”çš„å­—æ®µï¼›\nMethod Â ï¼šå¯ä»¥ä½¿ç”¨ invoke() æ–¹æ³•è°ƒç”¨ä¸ Method å¯¹è±¡å…³è”çš„æ–¹æ³•ï¼›\nConstructor Â ï¼šå¯ä»¥ç”¨ Constructor çš„ newInstance() åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚\n\nåå°„çš„ä¼˜ç‚¹ï¼š\nå¯æ‰©å±•æ€§ Â  ï¼šåº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨å…¨é™å®šååˆ›å»ºå¯æ‰©å±•å¯¹è±¡çš„å®ä¾‹ï¼Œæ¥ä½¿ç”¨æ¥è‡ªå¤–éƒ¨çš„ç”¨æˆ·è‡ªå®šä¹‰ç±»ã€‚\nç±»æµè§ˆå™¨å’Œå¯è§†åŒ–å¼€å‘ç¯å¢ƒ Â  ï¼šä¸€ä¸ªç±»æµè§ˆå™¨éœ€è¦å¯ä»¥æšä¸¾ç±»çš„æˆå‘˜ã€‚å¯è§†åŒ–å¼€å‘ç¯å¢ƒï¼ˆå¦‚ IDEï¼‰å¯ä»¥ä»åˆ©ç”¨åå°„ä¸­å¯ç”¨çš„ç±»å‹ä¿¡æ¯ä¸­å—ç›Šï¼Œä»¥å¸®åŠ©ç¨‹åºå‘˜ç¼–å†™æ­£ç¡®çš„ä»£ç ã€‚\nè°ƒè¯•å™¨å’Œæµ‹è¯•å·¥å…· Â  ï¼š è°ƒè¯•å™¨éœ€è¦èƒ½å¤Ÿæ£€æŸ¥ä¸€ä¸ªç±»é‡Œçš„ç§æœ‰æˆå‘˜ã€‚æµ‹è¯•å·¥å…·å¯ä»¥åˆ©ç”¨åå°„æ¥è‡ªåŠ¨åœ°è°ƒç”¨ç±»é‡Œå®šä¹‰çš„å¯è¢«å‘ç°çš„ API å®šä¹‰ï¼Œä»¥ç¡®ä¿ä¸€ç»„æµ‹è¯•ä¸­æœ‰è¾ƒé«˜çš„ä»£ç è¦†ç›–ç‡ã€‚\n\nåå°„çš„ç¼ºç‚¹ï¼šå°½ç®¡åå°„éå¸¸å¼ºå¤§ï¼Œä½†ä¹Ÿä¸èƒ½æ»¥ç”¨ã€‚å¦‚æœä¸€ä¸ªåŠŸèƒ½å¯ä»¥ä¸ç”¨åå°„å®Œæˆï¼Œé‚£ä¹ˆæœ€å¥½å°±ä¸ç”¨ã€‚åœ¨æˆ‘ä»¬ä½¿ç”¨åå°„æŠ€æœ¯æ—¶ï¼Œä¸‹é¢å‡ æ¡å†…å®¹åº”è¯¥ç‰¢è®°äºå¿ƒã€‚\n\næ€§èƒ½å¼€é”€ Â  ï¼šåå°„æ¶‰åŠäº†åŠ¨æ€ç±»å‹çš„è§£æï¼Œæ‰€ä»¥ JVM æ— æ³•å¯¹è¿™äº›ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚å› æ­¤ï¼Œåå°„æ“ä½œçš„æ•ˆç‡è¦æ¯”é‚£äº›éåå°„æ“ä½œä½å¾—å¤šã€‚æˆ‘ä»¬åº”è¯¥é¿å…åœ¨ç»å¸¸è¢«æ‰§è¡Œçš„ä»£ç æˆ–å¯¹æ€§èƒ½è¦æ±‚å¾ˆé«˜çš„ç¨‹åºä¸­ä½¿ç”¨åå°„ã€‚ \nå®‰å…¨é™åˆ¶ Â  ï¼šä½¿ç”¨åå°„æŠ€æœ¯è¦æ±‚ç¨‹åºå¿…é¡»åœ¨ä¸€ä¸ªæ²¡æœ‰å®‰å…¨é™åˆ¶çš„ç¯å¢ƒä¸­è¿è¡Œã€‚å¦‚æœä¸€ä¸ªç¨‹åºå¿…é¡»åœ¨æœ‰å®‰å…¨é™åˆ¶çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œå¦‚ Appletï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä¸ªé—®é¢˜äº†ã€‚ \nå†…éƒ¨æš´éœ² Â  ï¼šç”±äºåå°„å…è®¸ä»£ç æ‰§è¡Œä¸€äº›åœ¨æ­£å¸¸æƒ…å†µä¸‹ä¸è¢«å…è®¸çš„æ“ä½œï¼ˆæ¯”å¦‚è®¿é—®ç§æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨åå°„å¯èƒ½ä¼šå¯¼è‡´æ„æ–™ä¹‹å¤–çš„å‰¯ä½œç”¨ï¼Œè¿™å¯èƒ½å¯¼è‡´ä»£ç åŠŸèƒ½å¤±è°ƒå¹¶ç ´åå¯ç§»æ¤æ€§ã€‚åå°„ä»£ç ç ´åäº†æŠ½è±¡æ€§ï¼Œå› æ­¤å½“å¹³å°å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œä»£ç çš„è¡Œä¸ºå°±æœ‰å¯èƒ½ä¹Ÿéšç€å˜åŒ–ã€‚ \nTrail: The Reflection API \næ·±å…¥è§£æ Java åå°„ï¼ˆ1ï¼‰- åŸºç¡€\n\nå…«ã€å¼‚å¸¸Throwable å¯ä»¥ç”¨æ¥è¡¨ç¤ºä»»ä½•å¯ä»¥ä½œä¸ºå¼‚å¸¸æŠ›å‡ºçš„ç±»ï¼Œåˆ†ä¸ºä¸¤ç§ï¼š Â Error Â  å’Œ Exceptionã€‚å…¶ä¸­ Error ç”¨æ¥è¡¨ç¤º JVM æ— æ³•å¤„ç†çš„é”™è¯¯ï¼ŒException åˆ†ä¸ºä¸¤ç§ï¼š\n\nå—æ£€å¼‚å¸¸ Â ï¼šéœ€è¦ç”¨ tryâ€¦catchâ€¦ è¯­å¥æ•è·å¹¶è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å¯ä»¥ä»å¼‚å¸¸ä¸­æ¢å¤ï¼›\néå—æ£€å¼‚å¸¸ Â ï¼šæ˜¯ç¨‹åºè¿è¡Œæ—¶é”™è¯¯ï¼Œä¾‹å¦‚é™¤ 0 ä¼šå¼•å‘ Arithmetic Exceptionï¼Œæ­¤æ—¶ç¨‹åºå´©æºƒå¹¶ä¸”æ— æ³•æ¢å¤ã€‚\n\n\n\nJava Exception Interview Questions and Answers \nJavaæé«˜ç¯‡â€”â€”Java å¼‚å¸¸å¤„ç†\n\nä¹ã€æ³›å‹public class Box&lt;T> &#123;\n    // T stands for \"Type\"\n    private T t;\n    public void set(T t) &#123; this.t = t; &#125;\n    public T get() &#123; return t; &#125;\n&#125;\n\n\nJava æ³›å‹è¯¦è§£\n10 é“ Java æ³›å‹é¢è¯•é¢˜\n\nåã€æ³¨è§£Java æ³¨è§£æ˜¯é™„åŠ åœ¨ä»£ç ä¸­çš„ä¸€äº›å…ƒä¿¡æ¯ï¼Œç”¨äºä¸€äº›å·¥å…·åœ¨ç¼–è¯‘ã€è¿è¡Œæ—¶è¿›è¡Œè§£æå’Œä½¿ç”¨ï¼Œèµ·åˆ°è¯´æ˜ã€é…ç½®çš„åŠŸèƒ½ã€‚æ³¨è§£ä¸ä¼šä¹Ÿä¸èƒ½å½±å“ä»£ç çš„å®é™…é€»è¾‘ï¼Œä»…ä»…èµ·åˆ°è¾…åŠ©æ€§çš„ä½œç”¨ã€‚\næ³¨è§£ Annotation å®ç°åŸç†ä¸è‡ªå®šä¹‰æ³¨è§£ä¾‹å­\nåä¸€ã€ç‰¹æ€§Java å„ç‰ˆæœ¬çš„æ–°ç‰¹æ€§New highlights in Java SE 8\nLambda Expressions\nPipelines and Streams\nDate and Time API\nDefault Methods\nType Annotations\nNashhorn JavaScript Engine\nConcurrent Accumulators\nParallel operations\nPermGen Error Removed\n\nNew highlights in Java SE 7\nStrings in Switch Statement\nType Inference for Generic Instance Creation\nMultiple Exception Handling\nSupport for Dynamic Languages\nTry with Resources\nJava nio Package\nBinary Literals, Underscore in literals\nDiamond Syntax\n\n\nDifference between Java 1.8 and Java 1.7?\nJava 8 ç‰¹æ€§\n\nJava ä¸ C++ çš„åŒºåˆ«\nJava æ˜¯çº¯ç²¹çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½ç»§æ‰¿è‡ª java.lang.Objectï¼ŒC++ ä¸ºäº†å…¼å®¹ C å³æ”¯æŒé¢å‘å¯¹è±¡ä¹Ÿæ”¯æŒé¢å‘è¿‡ç¨‹ã€‚\nJava é€šè¿‡è™šæ‹Ÿæœºä»è€Œå®ç°è·¨å¹³å°ç‰¹æ€§ï¼Œä½†æ˜¯ C++ ä¾èµ–äºç‰¹å®šçš„å¹³å°ã€‚\nJava æ²¡æœ‰æŒ‡é’ˆï¼Œå®ƒçš„å¼•ç”¨å¯ä»¥ç†è§£ä¸ºå®‰å…¨æŒ‡é’ˆï¼Œè€Œ C++ å…·æœ‰å’Œ C ä¸€æ ·çš„æŒ‡é’ˆã€‚\nJava æ”¯æŒè‡ªåŠ¨åƒåœ¾å›æ”¶ï¼Œè€Œ C++ éœ€è¦æ‰‹åŠ¨å›æ”¶ã€‚\nJava ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œåªèƒ½é€šè¿‡å®ç°å¤šä¸ªæ¥å£æ¥è¾¾åˆ°ç›¸åŒç›®çš„ï¼Œè€Œ C++ æ”¯æŒå¤šé‡ç»§æ‰¿ã€‚\nJava ä¸æ”¯æŒæ“ä½œç¬¦é‡è½½ï¼Œè™½ç„¶å¯ä»¥å¯¹ä¸¤ä¸ª String å¯¹è±¡æ‰§è¡ŒåŠ æ³•è¿ç®—ï¼Œä½†æ˜¯è¿™æ˜¯è¯­è¨€å†…ç½®æ”¯æŒçš„æ“ä½œï¼Œä¸å±äºæ“ä½œç¬¦é‡è½½ï¼Œè€Œ C++ å¯ä»¥ã€‚\nJava çš„ goto æ˜¯ä¿ç•™å­—ï¼Œä½†æ˜¯ä¸å¯ç”¨ï¼ŒC++ å¯ä»¥ä½¿ç”¨ gotoã€‚\n\nWhat are the main differences between Java and C++?\nJRE or JDK\nJREï¼šJava Runtime Environmentï¼ŒJava è¿è¡Œç¯å¢ƒçš„ç®€ç§°ï¼Œä¸º Java çš„è¿è¡Œæä¾›äº†æ‰€éœ€çš„ç¯å¢ƒã€‚å®ƒæ˜¯ä¸€ä¸ª JVM ç¨‹åºï¼Œä¸»è¦åŒ…æ‹¬äº† JVM çš„æ ‡å‡†å®ç°å’Œä¸€äº› Java åŸºæœ¬ç±»åº“ã€‚\nJDKï¼šJava Development Kitï¼ŒJava å¼€å‘å·¥å…·åŒ…ï¼Œæä¾›äº† Java çš„å¼€å‘åŠè¿è¡Œç¯å¢ƒã€‚JDK æ˜¯ Java å¼€å‘çš„æ ¸å¿ƒï¼Œé›†æˆäº† JRE ä»¥åŠä¸€äº›å…¶å®ƒçš„å·¥å…·ï¼Œæ¯”å¦‚ç¼–è¯‘ Java æºç çš„ç¼–è¯‘å™¨ javac ç­‰ã€‚\n\n","slug":"Java/JAVAåŸºç¡€","date":"2022-02-22T05:32:16.000Z","categories_index":"JAVA","tags_index":"JAVA,JavaåŸºç¡€,Spring","author_index":"Anchor"},{"id":"ad849fabb64e7ddec346e0f489d0c75c","title":"KafkaåŒç»„ä¸‹å¤šæ¶ˆè´¹è€…ä»…ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹çš„æƒ…å†µå¤„ç†","content":"1ã€é—®é¢˜æè¿°çº¿ä¸ŠæŸä¸ªæœåŠ¡æœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ Kafka æ¶ˆæ¯ï¼ŒæŸ¥çœ‹æ—¥å¿—å‘ç°ä»…æœ‰ä¸€ä¸ªæœåŠ¡çš„æ¶ˆè´¹è€…åœ¨æ­£å¸¸è¿è¡Œï¼Œå…¶ä»–å…¨éƒ¨ç½¢å·¥ä¸­\n2ã€é—®é¢˜å®šä½åŒç»„ä¸‹ç›‘å¬åŒä¸€ topic ä¸­æœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œä¸€èˆ¬æƒ…å†µæ˜¯å› ä¸º Kafka è®¾ç½®çš„partitionçš„æ•°é‡ä¸º 1,æœ¬åœ°éªŒè¯ä¿®æ”¹partitionæ•°é‡ï¼Œé—®é¢˜æ¶ˆå¤±ã€‚\n3ã€è§£å†³åŠæ³•åœ¨ kafka æœåŠ¡å™¨ä¸‹è¿è¡Œå¦‚ä¸‹å‘½ä»¤ä¿®æ”¹ kafka çš„partition\n./kafka-topics.sh --zookeeper localhost:2181 --alter --topic topicåç§° --partitions 10\n\nå¤‡æ³¨ï¼štopic åç§°ä¸ºæ­£åœ¨ä½¿ç”¨çš„ topic åç§°ï¼Œåé¢é‚£ä¸ªæ•°é‡ä¸ºéœ€è¦è®¾ç½®çš„ partition çš„æ•°é‡ï¼Œè¿™é‡Œè®¾ç½®ä¸º 10\n4ã€æ€»ç»“ä¸æ‰©å±•åˆæŸ¥é˜…äº†ç›¸å…³èµ„æ–™ï¼Œæ€»ç»“äº†ä¸€ä¸‹ kafka ä¸­ partition å’Œæ¶ˆè´¹è€…çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š\n\næ¶ˆè´¹è€…å¤šäº partitionåŒä¸€ä¸ª partition å†…çš„æ¶ˆæ¯åªèƒ½è¢«åŒä¸€ä¸ªç»„ä¸­çš„ä¸€ä¸ª consumer æ¶ˆè´¹ã€‚å½“æ¶ˆè´¹è€…æ•°é‡å¤šäº partition çš„æ•°é‡æ—¶ï¼Œå¤šä½™çš„æ¶ˆè´¹è€…ç©ºé—²ã€‚\nä¾‹å­ï¼š\næœ‰æ¶ˆæ¯ 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8ï¼Œ9 ï¼Œpartition æ•°é‡ä¸º 1ï¼Œæ¶ˆè´¹è€…æ•°é‡ä¸º 2\nc1 æ¶ˆè´¹ï¼š1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8ï¼Œ9\nc2 æ¶ˆè´¹ï¼š\n\næ¶ˆè´¹è€…å°äº partition\nï¼ˆ1ï¼‰.partition ä¸æ˜¯æ¶ˆè´¹è€…å€æ•°\n  ä¼šæœ‰å¤šä¸ªpartitionå¯¹åº”ä¸€ä¸ªæ¶ˆè´¹è€…\n\n  ä¾‹å­ï¼š\n\n  æœ‰æ¶ˆæ¯1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8ï¼Œ9      partitionæ•°é‡ä¸º3ï¼Œæ¶ˆè´¹è€…æ•°é‡ä¸º2\n\n  c1æ¶ˆè´¹ï¼š1ï¼Œ3ï¼Œ4ï¼Œ6ï¼Œ7ï¼Œ9\n\n  c2æ¶ˆè´¹ï¼š2ï¼Œ5ï¼Œ8\n\nï¼ˆ2ï¼‰.partition æ˜¯æ¶ˆè´¹è€…å€æ•°\n  æ¶ˆæ¯åœ¨åŒä¸€ä¸ªç»„ä¹‹é—´çš„æ¶ˆè´¹è€…ä¹‹é—´å‡åˆ†\n\n  ä¾‹å­ï¼š\n\n  æœ‰æ¶ˆæ¯1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8ï¼Œ9      partitionæ•°é‡ä¸º3ï¼Œæ¶ˆè´¹è€…æ•°é‡ä¸º3\n\n  c1æ¶ˆè´¹ï¼š2ï¼Œ5ï¼Œ8\n\n  c2æ¶ˆè´¹ï¼š3ï¼Œ6ï¼Œ9\n\n  c3æ¶ˆè´¹ï¼š1ï¼Œ4ï¼Œ7\n\n\nå¤šç»„åŒ topic æƒ…å†µ\næ¯ä¸ªç»„éƒ½ä¼šæ¶ˆè´¹åŒæ ·çš„æ¶ˆæ¯ï¼ŒåŒä¸€æ¶ˆæ¯ä¼šè¢«å¤šç»„æ¶ˆæ¯\n  ä¾‹å­ï¼š\n\n  æ¶ˆæ¯ 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8ï¼Œ9 `partition` æ•°é‡ä¸º 3ï¼Œg1 ç»„æ¶ˆè´¹è€…æ•°é‡ä¸º 3ï¼Œg2 ç»„æ¶ˆè´¹è€…æ•°é‡ä¸º 1\n\n  g1 ç»„ï¼š\n\n  c1 æ¶ˆè´¹ï¼š2ï¼Œ5ï¼Œ8\n\n  c2 æ¶ˆè´¹ï¼š3ï¼Œ6ï¼Œ9\n\n  c3 æ¶ˆè´¹ï¼š1ï¼Œ4ï¼Œ7\n\n  g2 ç»„ï¼š\n\n  c1 æ¶ˆè´¹ï¼š1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8ï¼Œ9\n\n\n\n","slug":"Kafka/KafkaåŒç»„ä¸‹å¤šæ¶ˆè´¹è€…ä»…ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹çš„æƒ…å†µå¤„ç†","date":"2019-04-10T12:42:52.000Z","categories_index":"JAVA","tags_index":"Kafka","author_index":"Anchor"}]