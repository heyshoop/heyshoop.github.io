{"title":"Kafka同组下多消费者仅一个消费者消费的情况处理","uid":"ad849fabb64e7ddec346e0f489d0c75c","slug":"Kafka/Kafka同组下多消费者仅一个消费者消费的情况处理","date":"2019-04-10T12:42:52.000Z","updated":"2022-12-29T02:31:48.702Z","comments":true,"path":"api/articles/Kafka/Kafka同组下多消费者仅一个消费者消费的情况处理.json","keywords":"阿里孩舞,五月西恩,Anchor,阁楼麻雀,码农,程序猿,JAVA","cover":"/medias/guns.jpg","content":"<h1 id=\"1、问题描述\"><a href=\"#1、问题描述\" class=\"headerlink\" title=\"1、问题描述\"></a>1、问题描述</h1><p>线上某个服务有多个节点，每个节点都有一个消费者消费 Kafka 消息，查看日志发现仅有一个服务的消费者在正常运行，其他全部罢工中</p>\n<h1 id=\"2、问题定位\"><a href=\"#2、问题定位\" class=\"headerlink\" title=\"2、问题定位\"></a>2、问题定位</h1><p>同组下监听同一 topic 中有多个消费者，但是只有一个消费者消费，一般情况是因为 Kafka 设置的<code>partition</code>的数量为 1,本地验证修改<code>partition</code>数量，问题消失。</p>\n<h1 id=\"3、解决办法\"><a href=\"#3、解决办法\" class=\"headerlink\" title=\"3、解决办法\"></a>3、解决办法</h1><p>在 kafka 服务器下运行如下命令修改 kafka 的<code>partition</code></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">./kafka-topics.sh <span class=\"token parameter variable\">--zookeeper</span> localhost:2181 <span class=\"token parameter variable\">--alter</span> <span class=\"token parameter variable\">--topic</span> topic名称 <span class=\"token parameter variable\">--partitions</span> <span class=\"token number\">10</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>备注：topic 名称为正在使用的 topic 名称，后面那个数量为需要设置的 <code>partition</code> 的数量，这里设置为 10</p>\n<h1 id=\"4、总结与扩展\"><a href=\"#4、总结与扩展\" class=\"headerlink\" title=\"4、总结与扩展\"></a>4、总结与扩展</h1><p>又查阅了相关资料，总结了一下 kafka 中 partition 和消费者的对应关系如下：</p>\n<ul>\n<li><p>消费者多于 partition<br>同一个 <code>partition</code> 内的消息只能被同一个组中的一个 <code>consumer</code> 消费。当消费者数量多于 <code>partition</code> 的数量时，多余的消费者空闲。</p>\n<p>例子：</p>\n<p>有消息 1，2，3，4，5，6，7，8，9 ，<code>partition</code> 数量为 1，消费者数量为 2</p>\n<p>c1 消费：1，2，3，4，5，6，7，8，9</p>\n<p>c2 消费：</p>\n</li>\n<li><p>消费者小于 partition</p>\n<p>（1）.partition 不是消费者倍数</p>\n<pre><code>  会有多个partition对应一个消费者\n\n  例子：\n\n  有消息1，2，3，4，5，6，7，8，9      partition数量为3，消费者数量为2\n\n  c1消费：1，3，4，6，7，9\n\n  c2消费：2，5，8\n</code></pre>\n<p>（2）.partition 是消费者倍数</p>\n<pre><code>  消息在同一个组之间的消费者之间均分\n\n  例子：\n\n  有消息1，2，3，4，5，6，7，8，9      partition数量为3，消费者数量为3\n\n  c1消费：2，5，8\n\n  c2消费：3，6，9\n\n  c3消费：1，4，7\n</code></pre>\n</li>\n<li><p>多组同 topic 情况</p>\n<p>每个组都会消费同样的消息，同一消息会被多组消息</p>\n<pre><code>  例子：\n\n  消息 1，2，3，4，5，6，7，8，9 `partition` 数量为 3，g1 组消费者数量为 3，g2 组消费者数量为 1\n\n  g1 组：\n\n  c1 消费：2，5，8\n\n  c2 消费：3，6，9\n\n  c3 消费：1，4，7\n\n  g2 组：\n\n  c1 消费：1，2，3，4，5，6，7，8，9\n</code></pre>\n</li>\n</ul>\n","text":"1、问题描述线上某个服务有多个节点，每个节点都有一个消费者消费 Kafka 消息，查看日志发现仅有一个服务的消费者在正常运行，其他全部罢工中 2、问题定位同组下监听同一 topic 中有多个消费者，但是只有一个消费者消费，一般情况是因为 Kafka 设置的partition的数量...","link":"","photos":[],"count_time":{"symbolsCount":"1.1k","symbolsTime":"1 mins."},"categories":[{"name":"JAVA","slug":"JAVA","count":7,"path":"api/categories/JAVA.json"}],"tags":[{"name":"Kafka","slug":"Kafka","count":1,"path":"api/tags/Kafka.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#1%E3%80%81%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0\"><span class=\"toc-text\">1、问题描述</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#2%E3%80%81%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D\"><span class=\"toc-text\">2、问题定位</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#3%E3%80%81%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95\"><span class=\"toc-text\">3、解决办法</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#4%E3%80%81%E6%80%BB%E7%BB%93%E4%B8%8E%E6%89%A9%E5%B1%95\"><span class=\"toc-text\">4、总结与扩展</span></a></li></ol>","author":{"name":"Anchor","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/heyshoop/imageRepository@master/images/202212281657361.png","link":"/","description":"新生代农民工 <br /> 技术无产阶级 <br /> @ <b>微信：Alihai5</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"SpringMVC项目实现Session共享","uid":"49c4631107889bc801e70cd25dbb2b0a","slug":"Java/SpringMVC项目实现Session共享","date":"2019-12-11T12:22:12.000Z","updated":"2022-12-29T03:22:23.167Z","comments":true,"path":"api/articles/Java/SpringMVC项目实现Session共享.json","keywords":"阿里孩舞,五月西恩,Anchor,阁楼麻雀,码农,程序猿,JAVA","cover":"/medias/darkness.jpg","text":" 近期接到一个老项目的改造工作，需要将其由单商户单节点应用 SAAS 化，由于老项目基于 SpringMVC 构建，未做前后端分离，无法直接接入现有平台 JWT，综合考虑继续沿用 Session 机制，使用 Spring Session 实现集群 Session 共享。事情不复杂...","link":"","photos":[],"count_time":{"symbolsCount":"2.1k","symbolsTime":"2 mins."},"categories":[{"name":"JAVA","slug":"JAVA","count":7,"path":"api/categories/JAVA.json"}],"tags":[{"name":"Session","slug":"Session","count":1,"path":"api/tags/Session.json"},{"name":"SpringMVC","slug":"SpringMVC","count":1,"path":"api/tags/SpringMVC.json"}],"author":{"name":"Anchor","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/heyshoop/imageRepository@master/images/202212281657361.png","link":"/","description":"新生代农民工 <br /> 技术无产阶级 <br /> @ <b>微信：Alihai5</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{}}